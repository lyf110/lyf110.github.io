<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.66" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://github.com/lyf110/middleware/mq/rocketmq/RocketMQ-01.html"><meta property="og:site_name" content="lyf blog"><meta property="og:title" content="一、RocketMQ入门第一天"><meta property="og:description" content="1. MQ介绍 1.1 为什么要用MQ 消息队列是一种“先进先出”的数据结构 其应用场景主要包含以下3个方面 应用解耦 系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。"><meta property="og:type" content="article"><meta property="og:image" content="https://github.com/lyf110/"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="一、RocketMQ入门第一天"><meta property="article:author" content="liuyangfang"><meta property="article:tag" content="中间件"><meta property="article:tag" content="mq"><meta property="article:tag" content="阿里"><meta property="article:tag" content="RocketMQ"><meta property="article:published_time" content="2023-04-06T09:49:10.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"一、RocketMQ入门第一天","image":["https://github.com/lyf110/"],"datePublished":"2023-04-06T09:49:10.000Z","dateModified":null,"author":[{"@type":"Person","name":"liuyangfang","link":"https://github.com/lyf110"}]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link rel="icon" href="/favicon.ico"><title>一、RocketMQ入门第一天 | lyf blog</title><meta name="description" content="1. MQ介绍 1.1 为什么要用MQ 消息队列是一种“先进先出”的数据结构 其应用场景主要包含以下3个方面 应用解耦 系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-0f2239c3.css" as="style"><link rel="stylesheet" href="/assets/style-0f2239c3.css">
    <link rel="modulepreload" href="/assets/app-5f6064b2.js"><link rel="modulepreload" href="/assets/RocketMQ-01.html-9c4d7576.js"><link rel="modulepreload" href="/assets/RocketMQ-01.html-50940b90.js"><link rel="modulepreload" href="/assets/RocketMQ角色-af9c6e95.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/blog.html-2201ce83.js" as="script"><link rel="prefetch" href="/assets/index.html-8d072788.js" as="script"><link rel="prefetch" href="/assets/tools.html-7a68a8b6.js" as="script"><link rel="prefetch" href="/assets/ajax-json(2.0).html-f05f38d7.js" as="script"><link rel="prefetch" href="/assets/ajax-json.html-68f2006c.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-01.html-0da34296.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-02.html-17907d72.js" as="script"><link rel="prefetch" href="/assets/jquery3基础.html-d6e2e65e.js" as="script"><link rel="prefetch" href="/assets/jquery3高级.html-5e490845.js" as="script"><link rel="prefetch" href="/assets/Vue.html-f6e985c9.js" as="script"><link rel="prefetch" href="/assets/day01-MyBatis2.0.html-1546f02f.js" as="script"><link rel="prefetch" href="/assets/day02-MyBatis2.0.html-3349b832.js" as="script"><link rel="prefetch" href="/assets/day03-MyBatis2.0.html-5e123e34.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第一天.html-8dc970bd.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第二天.html-3113cead.js" as="script"><link rel="prefetch" href="/assets/MyBatisPlus.html-6c9f4a2e.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-b844eff7.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇01.html-822acc19.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html-98094f0f.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（一）.html-e4e9a1a3.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（二）.html-9f513f56.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第一天2.0.html-156d27fd.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第三天2.0.html-fbdd0855.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第二天2.0.html-c439d69f.js" as="script"><link rel="prefetch" href="/assets/Nacos源码分析.html-c966ca07.js" as="script"><link rel="prefetch" href="/assets/Sentinel源码分析.html-cb76e968.js" as="script"><link rel="prefetch" href="/assets/微服务常见面试题.html-ce1f705b.js" as="script"><link rel="prefetch" href="/assets/项目场景题收集.html-b126d705.js" as="script"><link rel="prefetch" href="/assets/项目工具类收集.html-374221e5.js" as="script"><link rel="prefetch" href="/assets/Windows杀进程资料.html-50d2cb36.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-d99b3771.js" as="script"><link rel="prefetch" href="/assets/01.Nacos 配置中心.html-0e919fdf.js" as="script"><link rel="prefetch" href="/assets/02.Nacos 服务发现.html-241f685e.js" as="script"><link rel="prefetch" href="/assets/03.Nacos 服务发现源码分析.html-aec81761.js" as="script"><link rel="prefetch" href="/assets/04.Nacos 配置中心源码解读.html-b05c3b63.js" as="script"><link rel="prefetch" href="/assets/微服务保护.html-317c7b5d.js" as="script"><link rel="prefetch" href="/assets/Seata Saga模式.html-84628cb5.js" as="script"><link rel="prefetch" href="/assets/seata的部署和集成.html-5b825f8a.js" as="script"><link rel="prefetch" href="/assets/分布式事务Seata.html-a3887688.js" as="script"><link rel="prefetch" href="/assets/Centos7安装Docker.html-be7cb59a.js" as="script"><link rel="prefetch" href="/assets/Docker-2022-实用篇.html-01b1b4e9.js" as="script"><link rel="prefetch" href="/assets/docker-linux-安装.html-a934c2c5.js" as="script"><link rel="prefetch" href="/assets/docker-v1-01.html-f5c77d89.js" as="script"><link rel="prefetch" href="/assets/docker-v2-01.html-b4ecd705.js" as="script"><link rel="prefetch" href="/assets/docker-v2-02.html-82c79693.js" as="script"><link rel="prefetch" href="/assets/Docker安装私人镜像仓库.html-2f6a20c8.js" as="script"><link rel="prefetch" href="/assets/Docker常见问题记录.html-58bd1cc2.js" as="script"><link rel="prefetch" href="/assets/Idea设置大全.html-84b2b11d.js" as="script"><link rel="prefetch" href="/assets/Maven高级2.0.html-121e915a.js" as="script"><link rel="prefetch" href="/assets/Redis7-基础篇.html-e205fee3.js" as="script"><link rel="prefetch" href="/assets/Redis7-高级篇.html-552af52d.js" as="script"><link rel="prefetch" href="/assets/01.Redis-入门篇.html-38e818c6.js" as="script"><link rel="prefetch" href="/assets/02.Redis-实战篇.html-4fed8eb2.js" as="script"><link rel="prefetch" href="/assets/03.Redis高级篇-分布式缓存.html-7bcfa6a8.js" as="script"><link rel="prefetch" href="/assets/04.Redis高级篇-多级缓存.html-6749e5fe.js" as="script"><link rel="prefetch" href="/assets/05.Redis高级篇-最佳实践.html-0703c0f4.js" as="script"><link rel="prefetch" href="/assets/06.Redis-原理篇.html-07e94bb0.js" as="script"><link rel="prefetch" href="/assets/01_Spring高级49讲-容器与bean.html-23165f6b.js" as="script"><link rel="prefetch" href="/assets/02_Spring-高级49讲-AOP.html-eafa692b.js" as="script"><link rel="prefetch" href="/assets/03_Spring高级49讲-WEB.html-af8e72ad.js" as="script"><link rel="prefetch" href="/assets/04_Spring高级49讲-SpringBoot相关.html-6a56b12c.js" as="script"><link rel="prefetch" href="/assets/05_Spring高级49讲-其它.html-5b0c3c6a.js" as="script"><link rel="prefetch" href="/assets/spring5第一天2.0.html-9ae3f4c0.js" as="script"><link rel="prefetch" href="/assets/spring5第三天2.0.html-7fd5f4d2.js" as="script"><link rel="prefetch" href="/assets/spring5第二天2.0.html-8a47fe3e.js" as="script"><link rel="prefetch" href="/assets/spring5第四天2.0.html-f55bc485.js" as="script"><link rel="prefetch" href="/assets/附录(切入点表达式规则).html-686bdc1e.js" as="script"><link rel="prefetch" href="/assets/MVCC个人理解.html-d38548e4.js" as="script"><link rel="prefetch" href="/assets/MySQL安装教程.html-bcc88bcd.js" as="script"><link rel="prefetch" href="/assets/数据库死锁.html-bd1ffe92.js" as="script"><link rel="prefetch" href="/assets/recursion.html-aaea187f.js" as="script"><link rel="prefetch" href="/assets/Ffmpeg使用说明.html-0afcf120.js" as="script"><link rel="prefetch" href="/assets/Centos7常见问题记录.html-50305cea.js" as="script"><link rel="prefetch" href="/assets/Centos7新机开荒.html-1d547664.js" as="script"><link rel="prefetch" href="/assets/Centos8新机常见问题.html-4b9983f1.js" as="script"><link rel="prefetch" href="/assets/Https加密原理.html-9975080f.js" as="script"><link rel="prefetch" href="/assets/Java基础.html-c1ca39c8.js" as="script"><link rel="prefetch" href="/assets/大厂面试第一季.html-d44bfcea.js" as="script"><link rel="prefetch" href="/assets/大厂面试第三季.html-bc7e1ac2.js" as="script"><link rel="prefetch" href="/assets/大厂面试第二季.html-4f8ed9af.js" as="script"><link rel="prefetch" href="/assets/集合常用面试题.html-7d8a7a20.js" as="script"><link rel="prefetch" href="/assets/让线程顺序运行的11种方法.html-94ada2cb.js" as="script"><link rel="prefetch" href="/assets/1 怎么解决Java8 stream操作toMap的key重复问题.html-3aaa77a1.js" as="script"><link rel="prefetch" href="/assets/JDK8新特性.html-41c37b1d.js" as="script"><link rel="prefetch" href="/assets/Netty01-nio.html-d9bc5670.js" as="script"><link rel="prefetch" href="/assets/Netty02-入门.html-85f1df9b.js" as="script"><link rel="prefetch" href="/assets/Netty03-进阶.html-b93e742f.js" as="script"><link rel="prefetch" href="/assets/Netty04-优化与源码.html-c60f5b6f.js" as="script"><link rel="prefetch" href="/assets/SpringAop的失效及解决方案.html-66cfa0ae.js" as="script"><link rel="prefetch" href="/assets/SpringBoot配置项目支持多数据库.html-3bcdd281.js" as="script"><link rel="prefetch" href="/assets/Spring的生命周期.html-258b0ba8.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎01.html-2e814715.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎02.html-9c367f68.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎03.html-4c7f79a1.js" as="script"><link rel="prefetch" href="/assets/笔记.html-13c8f1c0.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（一）.html-b90de095.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（二）.html-a6da360f.js" as="script"><link rel="prefetch" href="/assets/Lucene入门.html-80a64aae.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-基础篇.html-fbc77927.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html-d6d6f6c8.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-02.html-f3f22777.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-03.html-e6a95cb3.js" as="script"><link rel="prefetch" href="/assets/00-Vue3_TS.html-04a6c9b8.js" as="script"><link rel="prefetch" href="/assets/day01-基础数据开发-服务管理.html-9a6bb1a8.js" as="script"><link rel="prefetch" href="/assets/day02-基础数据开发-服务管理-前端.html-40c5ef32.js" as="script"><link rel="prefetch" href="/assets/day03-基础数据开发-预约管理.html-9b3cb682.js" as="script"><link rel="prefetch" href="/assets/day04-权限认证-基础.html-b133fdc3.js" as="script"><link rel="prefetch" href="/assets/day05-权限认证-SpringSecurity认证授权.html-523d0212.js" as="script"><link rel="prefetch" href="/assets/day06-权限认证-项目集成.html-bb86031f.js" as="script"><link rel="prefetch" href="/assets/day07-工作流-Activiti7基础.html-db18e234.js" as="script"><link rel="prefetch" href="/assets/day08-入退管理-入住-1.html-fac762f0.js" as="script"><link rel="prefetch" href="/assets/day09-入退管理-入住-2.html-7a7d9a0d.js" as="script"><link rel="prefetch" href="/assets/day10-入退管理-入住-3.html-8958367c.js" as="script"><link rel="prefetch" href="/assets/day11-入退管理-退住.html-0d39474a.js" as="script"><link rel="prefetch" href="/assets/day12-物联网智能监测-IOT产品设备管理.html-304fa70c.js" as="script"><link rel="prefetch" href="/assets/day13-物联网智能监测-IOT消息处理.html-ffbc6318.js" as="script"><link rel="prefetch" href="/assets/day14-物联网智能监测-报警及优化.html-55496938.js" as="script"><link rel="prefetch" href="/assets/day01-初识项目.html-4386bc6e.js" as="script"><link rel="prefetch" href="/assets/day02-我的课表.html-bec1821f.js" as="script"><link rel="prefetch" href="/assets/day03-学习计划和进度.html-20d6e2bf.js" as="script"><link rel="prefetch" href="/assets/day04-高并发优化.html-16636dca.js" as="script"><link rel="prefetch" href="/assets/day05-问答系统.html-97191c25.js" as="script"><link rel="prefetch" href="/assets/day06-点赞系统.html-d28a8566.js" as="script"><link rel="prefetch" href="/assets/day07-积分系统.html-6a32fd70.js" as="script"><link rel="prefetch" href="/assets/day08-排行榜功能.html-ad69b04e.js" as="script"><link rel="prefetch" href="/assets/day09-优惠券管理.html-5e7f0247.js" as="script"><link rel="prefetch" href="/assets/day10-领取优惠券.html-d15cd1b7.js" as="script"><link rel="prefetch" href="/assets/day11-领取优惠券的优化.html-5547c96b.js" as="script"><link rel="prefetch" href="/assets/day12-优惠券使用.html-44b28eab.js" as="script"><link rel="prefetch" href="/assets/day13~14-分组实战.html-9a490227.js" as="script"><link rel="prefetch" href="/assets/内网穿透说明.html-fc1100d1.js" as="script"><link rel="prefetch" href="/assets/自定义部署.html-beb61036.js" as="script"><link rel="prefetch" href="/assets/虚拟机导入说明.html-85501d8b.js" as="script"><link rel="prefetch" href="/assets/hutool使用手册.html-9692ac9d.js" as="script"><link rel="prefetch" href="/assets/Jenkins使用手册.html-7287210b.js" as="script"><link rel="prefetch" href="/assets/前端部署文档.html-bff69647.js" as="script"><link rel="prefetch" href="/assets/学习目标.html-780953cf.js" as="script"><link rel="prefetch" href="/assets/常见问题手册.html-60164748.js" as="script"><link rel="prefetch" href="/assets/权限管家使用说明.html-8d92d119.js" as="script"><link rel="prefetch" href="/assets/虚拟机导入手册.html-39101ace.js" as="script"><link rel="prefetch" href="/assets/day01-项目概述.html-31095a8e.js" as="script"><link rel="prefetch" href="/assets/day02-网关与支付.html-9e473423.js" as="script"><link rel="prefetch" href="/assets/day03-支付微服务.html-5bd5db85.js" as="script"><link rel="prefetch" href="/assets/day04-运费微服务.html-42060ef2.js" as="script"><link rel="prefetch" href="/assets/day05-路线规划之Neo4j入门.html-68a293d8.js" as="script"><link rel="prefetch" href="/assets/day06-路线规划之微服务.html-467ac34c.js" as="script"><link rel="prefetch" href="/assets/day07-智能调度之调度任务.html-d7e2f15e.js" as="script"><link rel="prefetch" href="/assets/day08-智能调度之运输任务.html-a4efc40a.js" as="script"><link rel="prefetch" href="/assets/day09-智能调度之作业范围.html-4a7ed474.js" as="script"><link rel="prefetch" href="/assets/day10-智能调度之取派件调度.html-6b16b684.js" as="script"><link rel="prefetch" href="/assets/day11-物流信息微服务.html-6bf97755.js" as="script"><link rel="prefetch" href="/assets/day12-分布式日志与链路追踪.html-6a0b4f8a.js" as="script"><link rel="prefetch" href="/assets/day13_14 项目分组实战.html-1c551ac1.js" as="script"><link rel="prefetch" href="/assets/01 MySQL概述.html-799702be.js" as="script"><link rel="prefetch" href="/assets/02 MySQL分类.html-229a4bd8.js" as="script"><link rel="prefetch" href="/assets/03 MySQL函数.html-6b7bd3f5.js" as="script"><link rel="prefetch" href="/assets/04 MySQL约束.html-4205190f.js" as="script"><link rel="prefetch" href="/assets/05 MySQL多表查询.html-e27ae908.js" as="script"><link rel="prefetch" href="/assets/06 MySQL事务.html-58ade7ad.js" as="script"><link rel="prefetch" href="/assets/1 日志.html-b151f398.js" as="script"><link rel="prefetch" href="/assets/2 主从复制.html-c4d5dcce.js" as="script"><link rel="prefetch" href="/assets/3 分库分表.html-51928657.js" as="script"><link rel="prefetch" href="/assets/4 MyCat.html-ddbe99fb.js" as="script"><link rel="prefetch" href="/assets/5 读写分离.html-71c378af.js" as="script"><link rel="prefetch" href="/assets/01 存储引擎.html-90bb6c83.js" as="script"><link rel="prefetch" href="/assets/02 索引.html-11fe3227.js" as="script"><link rel="prefetch" href="/assets/03 MySQL优化.html-f70d2e70.js" as="script"><link rel="prefetch" href="/assets/04 视图、存储过程、触发器.html-22ead05b.js" as="script"><link rel="prefetch" href="/assets/05 锁.html-af866a6c.js" as="script"><link rel="prefetch" href="/assets/06 事务.html-37af86ec.js" as="script"><link rel="prefetch" href="/assets/07 MySQL管理.html-9e048fdd.js" as="script"><link rel="prefetch" href="/assets/404.html-e8024d5f.js" as="script"><link rel="prefetch" href="/assets/index.html-782d52ec.js" as="script"><link rel="prefetch" href="/assets/index.html-8bd5db5d.js" as="script"><link rel="prefetch" href="/assets/index.html-827604a5.js" as="script"><link rel="prefetch" href="/assets/index.html-0e8929dd.js" as="script"><link rel="prefetch" href="/assets/index.html-58c0f336.js" as="script"><link rel="prefetch" href="/assets/index.html-eebb1b3e.js" as="script"><link rel="prefetch" href="/assets/index.html-25d9148b.js" as="script"><link rel="prefetch" href="/assets/index.html-80bbe142.js" as="script"><link rel="prefetch" href="/assets/index.html-e1d3dc36.js" as="script"><link rel="prefetch" href="/assets/index.html-9b593ec4.js" as="script"><link rel="prefetch" href="/assets/index.html-6367a551.js" as="script"><link rel="prefetch" href="/assets/index.html-38ccca08.js" as="script"><link rel="prefetch" href="/assets/index.html-e34477b4.js" as="script"><link rel="prefetch" href="/assets/index.html-38f86759.js" as="script"><link rel="prefetch" href="/assets/index.html-5b173b12.js" as="script"><link rel="prefetch" href="/assets/index.html-724011a3.js" as="script"><link rel="prefetch" href="/assets/index.html-235dec34.js" as="script"><link rel="prefetch" href="/assets/index.html-08273174.js" as="script"><link rel="prefetch" href="/assets/index.html-15be2039.js" as="script"><link rel="prefetch" href="/assets/index.html-bac7155d.js" as="script"><link rel="prefetch" href="/assets/index.html-cd7444c8.js" as="script"><link rel="prefetch" href="/assets/index.html-f1e179b2.js" as="script"><link rel="prefetch" href="/assets/index.html-070754c2.js" as="script"><link rel="prefetch" href="/assets/index.html-f25840df.js" as="script"><link rel="prefetch" href="/assets/index.html-e338fe2d.js" as="script"><link rel="prefetch" href="/assets/index.html-030b9d95.js" as="script"><link rel="prefetch" href="/assets/index.html-a24d7a94.js" as="script"><link rel="prefetch" href="/assets/index.html-c20eb20a.js" as="script"><link rel="prefetch" href="/assets/index.html-0ea5a7ae.js" as="script"><link rel="prefetch" href="/assets/index.html-bb024a59.js" as="script"><link rel="prefetch" href="/assets/index.html-c3e11b71.js" as="script"><link rel="prefetch" href="/assets/index.html-230bc37b.js" as="script"><link rel="prefetch" href="/assets/index.html-cc6db1dc.js" as="script"><link rel="prefetch" href="/assets/index.html-fe2347f4.js" as="script"><link rel="prefetch" href="/assets/index.html-f96bbb7e.js" as="script"><link rel="prefetch" href="/assets/index.html-5d59179d.js" as="script"><link rel="prefetch" href="/assets/index.html-fb917a8e.js" as="script"><link rel="prefetch" href="/assets/index.html-ee963a08.js" as="script"><link rel="prefetch" href="/assets/index.html-3a03dfd0.js" as="script"><link rel="prefetch" href="/assets/index.html-f0096791.js" as="script"><link rel="prefetch" href="/assets/index.html-5ce6ddcc.js" as="script"><link rel="prefetch" href="/assets/index.html-80331feb.js" as="script"><link rel="prefetch" href="/assets/index.html-fbe5bc7c.js" as="script"><link rel="prefetch" href="/assets/index.html-508a7e0f.js" as="script"><link rel="prefetch" href="/assets/index.html-22cdd89a.js" as="script"><link rel="prefetch" href="/assets/index.html-fe225e84.js" as="script"><link rel="prefetch" href="/assets/index.html-f1838d02.js" as="script"><link rel="prefetch" href="/assets/index.html-1bb9e511.js" as="script"><link rel="prefetch" href="/assets/index.html-d5df89fa.js" as="script"><link rel="prefetch" href="/assets/index.html-c00442df.js" as="script"><link rel="prefetch" href="/assets/index.html-fe98f25b.js" as="script"><link rel="prefetch" href="/assets/index.html-57295239.js" as="script"><link rel="prefetch" href="/assets/index.html-6ce291e6.js" as="script"><link rel="prefetch" href="/assets/index.html-2788eab8.js" as="script"><link rel="prefetch" href="/assets/index.html-acc64bde.js" as="script"><link rel="prefetch" href="/assets/index.html-0ae94979.js" as="script"><link rel="prefetch" href="/assets/index.html-399adf39.js" as="script"><link rel="prefetch" href="/assets/index.html-1fa11d7e.js" as="script"><link rel="prefetch" href="/assets/index.html-9a683ddb.js" as="script"><link rel="prefetch" href="/assets/index.html-de7b81b1.js" as="script"><link rel="prefetch" href="/assets/index.html-23b448b1.js" as="script"><link rel="prefetch" href="/assets/index.html-19ed71b3.js" as="script"><link rel="prefetch" href="/assets/index.html-594fca25.js" as="script"><link rel="prefetch" href="/assets/index.html-3bcffb42.js" as="script"><link rel="prefetch" href="/assets/index.html-ade903d5.js" as="script"><link rel="prefetch" href="/assets/index.html-a81c1b78.js" as="script"><link rel="prefetch" href="/assets/index.html-2a3ab6b3.js" as="script"><link rel="prefetch" href="/assets/index.html-bfb3beb1.js" as="script"><link rel="prefetch" href="/assets/index.html-df5898ed.js" as="script"><link rel="prefetch" href="/assets/index.html-3d305237.js" as="script"><link rel="prefetch" href="/assets/index.html-852ba65c.js" as="script"><link rel="prefetch" href="/assets/index.html-638dfd96.js" as="script"><link rel="prefetch" href="/assets/index.html-fdac15c3.js" as="script"><link rel="prefetch" href="/assets/index.html-8713c955.js" as="script"><link rel="prefetch" href="/assets/index.html-f5f9139f.js" as="script"><link rel="prefetch" href="/assets/index.html-c8c226f7.js" as="script"><link rel="prefetch" href="/assets/index.html-c05c3307.js" as="script"><link rel="prefetch" href="/assets/index.html-decaa76b.js" as="script"><link rel="prefetch" href="/assets/index.html-21ad3441.js" as="script"><link rel="prefetch" href="/assets/index.html-45365186.js" as="script"><link rel="prefetch" href="/assets/index.html-4131fb00.js" as="script"><link rel="prefetch" href="/assets/index.html-af916a37.js" as="script"><link rel="prefetch" href="/assets/index.html-f50e4145.js" as="script"><link rel="prefetch" href="/assets/index.html-4a3fef4f.js" as="script"><link rel="prefetch" href="/assets/index.html-d0d90ade.js" as="script"><link rel="prefetch" href="/assets/index.html-fa026106.js" as="script"><link rel="prefetch" href="/assets/index.html-d325c67e.js" as="script"><link rel="prefetch" href="/assets/index.html-26c8024d.js" as="script"><link rel="prefetch" href="/assets/index.html-b484c0b7.js" as="script"><link rel="prefetch" href="/assets/index.html-defb8317.js" as="script"><link rel="prefetch" href="/assets/index.html-b40f75b6.js" as="script"><link rel="prefetch" href="/assets/index.html-5afc7542.js" as="script"><link rel="prefetch" href="/assets/index.html-4cd32a3f.js" as="script"><link rel="prefetch" href="/assets/index.html-78cab93c.js" as="script"><link rel="prefetch" href="/assets/index.html-7badab2e.js" as="script"><link rel="prefetch" href="/assets/index.html-4d0fc423.js" as="script"><link rel="prefetch" href="/assets/index.html-ae77f5d5.js" as="script"><link rel="prefetch" href="/assets/index.html-84106193.js" as="script"><link rel="prefetch" href="/assets/index.html-dd2a2bb1.js" as="script"><link rel="prefetch" href="/assets/index.html-5d82d96e.js" as="script"><link rel="prefetch" href="/assets/index.html-6d0beac1.js" as="script"><link rel="prefetch" href="/assets/index.html-5a9dbdf5.js" as="script"><link rel="prefetch" href="/assets/index.html-ea1a0194.js" as="script"><link rel="prefetch" href="/assets/index.html-2344e5f6.js" as="script"><link rel="prefetch" href="/assets/index.html-25e4d01a.js" as="script"><link rel="prefetch" href="/assets/index.html-5e6afd97.js" as="script"><link rel="prefetch" href="/assets/index.html-d0f2982b.js" as="script"><link rel="prefetch" href="/assets/index.html-67a7b7aa.js" as="script"><link rel="prefetch" href="/assets/index.html-3433ea91.js" as="script"><link rel="prefetch" href="/assets/index.html-171aab2a.js" as="script"><link rel="prefetch" href="/assets/index.html-762a6fda.js" as="script"><link rel="prefetch" href="/assets/index.html-3df69650.js" as="script"><link rel="prefetch" href="/assets/index.html-8c9d90ae.js" as="script"><link rel="prefetch" href="/assets/index.html-10927daa.js" as="script"><link rel="prefetch" href="/assets/index.html-8b7eaab5.js" as="script"><link rel="prefetch" href="/assets/index.html-b25be002.js" as="script"><link rel="prefetch" href="/assets/index.html-7a5542eb.js" as="script"><link rel="prefetch" href="/assets/index.html-e5212720.js" as="script"><link rel="prefetch" href="/assets/index.html-0332fc12.js" as="script"><link rel="prefetch" href="/assets/index.html-32760d69.js" as="script"><link rel="prefetch" href="/assets/index.html-dc567ac8.js" as="script"><link rel="prefetch" href="/assets/index.html-66bf150b.js" as="script"><link rel="prefetch" href="/assets/index.html-52b0f899.js" as="script"><link rel="prefetch" href="/assets/index.html-f5196792.js" as="script"><link rel="prefetch" href="/assets/index.html-6700d60c.js" as="script"><link rel="prefetch" href="/assets/index.html-4450de50.js" as="script"><link rel="prefetch" href="/assets/index.html-0ff62890.js" as="script"><link rel="prefetch" href="/assets/index.html-8f927c06.js" as="script"><link rel="prefetch" href="/assets/index.html-0495f0ea.js" as="script"><link rel="prefetch" href="/assets/index.html-62de0d79.js" as="script"><link rel="prefetch" href="/assets/index.html-4a4929c6.js" as="script"><link rel="prefetch" href="/assets/index.html-243bd994.js" as="script"><link rel="prefetch" href="/assets/index.html-8cfefd06.js" as="script"><link rel="prefetch" href="/assets/index.html-853451bd.js" as="script"><link rel="prefetch" href="/assets/index.html-df46e9e1.js" as="script"><link rel="prefetch" href="/assets/index.html-36e75b44.js" as="script"><link rel="prefetch" href="/assets/index.html-77a31cb5.js" as="script"><link rel="prefetch" href="/assets/index.html-4f777587.js" as="script"><link rel="prefetch" href="/assets/index.html-6d92bb7e.js" as="script"><link rel="prefetch" href="/assets/index.html-159bb7f5.js" as="script"><link rel="prefetch" href="/assets/index.html-d3240a2c.js" as="script"><link rel="prefetch" href="/assets/index.html-0f5a3d62.js" as="script"><link rel="prefetch" href="/assets/index.html-156aea82.js" as="script"><link rel="prefetch" href="/assets/index.html-7b6e2b2f.js" as="script"><link rel="prefetch" href="/assets/index.html-f1592975.js" as="script"><link rel="prefetch" href="/assets/index.html-36321173.js" as="script"><link rel="prefetch" href="/assets/index.html-10e77cf0.js" as="script"><link rel="prefetch" href="/assets/index.html-9ec2d432.js" as="script"><link rel="prefetch" href="/assets/index.html-a1c1a974.js" as="script"><link rel="prefetch" href="/assets/index.html-a34dcb96.js" as="script"><link rel="prefetch" href="/assets/index.html-f3e8dace.js" as="script"><link rel="prefetch" href="/assets/index.html-cc37f049.js" as="script"><link rel="prefetch" href="/assets/index.html-7559d092.js" as="script"><link rel="prefetch" href="/assets/index.html-5c4328b0.js" as="script"><link rel="prefetch" href="/assets/index.html-d89d414b.js" as="script"><link rel="prefetch" href="/assets/index.html-bf8bcb7a.js" as="script"><link rel="prefetch" href="/assets/index.html-d77af8fb.js" as="script"><link rel="prefetch" href="/assets/index.html-a7e76c3f.js" as="script"><link rel="prefetch" href="/assets/index.html-b337b08f.js" as="script"><link rel="prefetch" href="/assets/index.html-6abb44ce.js" as="script"><link rel="prefetch" href="/assets/index.html-b2ef023e.js" as="script"><link rel="prefetch" href="/assets/index.html-d8cee85c.js" as="script"><link rel="prefetch" href="/assets/index.html-7969f4ff.js" as="script"><link rel="prefetch" href="/assets/index.html-f56f2b58.js" as="script"><link rel="prefetch" href="/assets/index.html-7c150558.js" as="script"><link rel="prefetch" href="/assets/index.html-3df95363.js" as="script"><link rel="prefetch" href="/assets/index.html-1042d98e.js" as="script"><link rel="prefetch" href="/assets/index.html-4db3153d.js" as="script"><link rel="prefetch" href="/assets/index.html-ee0064db.js" as="script"><link rel="prefetch" href="/assets/index.html-9de672a8.js" as="script"><link rel="prefetch" href="/assets/index.html-03867d0b.js" as="script"><link rel="prefetch" href="/assets/index.html-ecc96178.js" as="script"><link rel="prefetch" href="/assets/index.html-3a31b343.js" as="script"><link rel="prefetch" href="/assets/index.html-cfbfefce.js" as="script"><link rel="prefetch" href="/assets/index.html-7e6dcbc2.js" as="script"><link rel="prefetch" href="/assets/index.html-80074f26.js" as="script"><link rel="prefetch" href="/assets/index.html-73c2e7f0.js" as="script"><link rel="prefetch" href="/assets/index.html-67c058db.js" as="script"><link rel="prefetch" href="/assets/index.html-e45c3fc1.js" as="script"><link rel="prefetch" href="/assets/index.html-519b6d99.js" as="script"><link rel="prefetch" href="/assets/index.html-09b99e33.js" as="script"><link rel="prefetch" href="/assets/index.html-483b074f.js" as="script"><link rel="prefetch" href="/assets/index.html-21ab5f25.js" as="script"><link rel="prefetch" href="/assets/index.html-e58540fb.js" as="script"><link rel="prefetch" href="/assets/index.html-e4102cd1.js" as="script"><link rel="prefetch" href="/assets/index.html-c8558f23.js" as="script"><link rel="prefetch" href="/assets/index.html-73245147.js" as="script"><link rel="prefetch" href="/assets/index.html-3b1a9402.js" as="script"><link rel="prefetch" href="/assets/index.html-1435c8b8.js" as="script"><link rel="prefetch" href="/assets/index.html-737a3d3d.js" as="script"><link rel="prefetch" href="/assets/index.html-f8b455f8.js" as="script"><link rel="prefetch" href="/assets/index.html-e1249db0.js" as="script"><link rel="prefetch" href="/assets/index.html-1aca9f55.js" as="script"><link rel="prefetch" href="/assets/index.html-f66bf627.js" as="script"><link rel="prefetch" href="/assets/index.html-95d81a4a.js" as="script"><link rel="prefetch" href="/assets/index.html-18f4623a.js" as="script"><link rel="prefetch" href="/assets/index.html-2be9379f.js" as="script"><link rel="prefetch" href="/assets/index.html-8587f15a.js" as="script"><link rel="prefetch" href="/assets/index.html-d6aa4bf3.js" as="script"><link rel="prefetch" href="/assets/index.html-e0b7a7f7.js" as="script"><link rel="prefetch" href="/assets/index.html-9b13a5ea.js" as="script"><link rel="prefetch" href="/assets/index.html-b4eece7e.js" as="script"><link rel="prefetch" href="/assets/index.html-2bd7f557.js" as="script"><link rel="prefetch" href="/assets/index.html-381914ea.js" as="script"><link rel="prefetch" href="/assets/index.html-09e43c1f.js" as="script"><link rel="prefetch" href="/assets/index.html-488713e7.js" as="script"><link rel="prefetch" href="/assets/index.html-1a282c0b.js" as="script"><link rel="prefetch" href="/assets/index.html-741f724e.js" as="script"><link rel="prefetch" href="/assets/index.html-435f5d90.js" as="script"><link rel="prefetch" href="/assets/index.html-ab08bd5a.js" as="script"><link rel="prefetch" href="/assets/index.html-466d8a97.js" as="script"><link rel="prefetch" href="/assets/index.html-7197d186.js" as="script"><link rel="prefetch" href="/assets/index.html-b5a6574c.js" as="script"><link rel="prefetch" href="/assets/index.html-39e48b45.js" as="script"><link rel="prefetch" href="/assets/index.html-6e190e97.js" as="script"><link rel="prefetch" href="/assets/index.html-817bed92.js" as="script"><link rel="prefetch" href="/assets/index.html-ab7c2026.js" as="script"><link rel="prefetch" href="/assets/index.html-47da3e02.js" as="script"><link rel="prefetch" href="/assets/index.html-3e9d05bd.js" as="script"><link rel="prefetch" href="/assets/index.html-5e1f3bf2.js" as="script"><link rel="prefetch" href="/assets/index.html-14ee19de.js" as="script"><link rel="prefetch" href="/assets/index.html-fb9c2b7a.js" as="script"><link rel="prefetch" href="/assets/index.html-b66a90dd.js" as="script"><link rel="prefetch" href="/assets/index.html-77a0b721.js" as="script"><link rel="prefetch" href="/assets/index.html-bcbd2857.js" as="script"><link rel="prefetch" href="/assets/index.html-3de13a9e.js" as="script"><link rel="prefetch" href="/assets/index.html-8d8c7d87.js" as="script"><link rel="prefetch" href="/assets/index.html-82ba06c1.js" as="script"><link rel="prefetch" href="/assets/index.html-9e3d0e9d.js" as="script"><link rel="prefetch" href="/assets/index.html-c3dbc460.js" as="script"><link rel="prefetch" href="/assets/index.html-805c3814.js" as="script"><link rel="prefetch" href="/assets/index.html-fb242327.js" as="script"><link rel="prefetch" href="/assets/index.html-037308af.js" as="script"><link rel="prefetch" href="/assets/index.html-c4c7af65.js" as="script"><link rel="prefetch" href="/assets/index.html-7f7be207.js" as="script"><link rel="prefetch" href="/assets/index.html-47fd98df.js" as="script"><link rel="prefetch" href="/assets/index.html-97732f73.js" as="script"><link rel="prefetch" href="/assets/index.html-c5910f99.js" as="script"><link rel="prefetch" href="/assets/index.html-eaf8ee56.js" as="script"><link rel="prefetch" href="/assets/index.html-cbcaddd7.js" as="script"><link rel="prefetch" href="/assets/index.html-34ed621c.js" as="script"><link rel="prefetch" href="/assets/index.html-a5577a4a.js" as="script"><link rel="prefetch" href="/assets/index.html-f9bb3253.js" as="script"><link rel="prefetch" href="/assets/index.html-560eef84.js" as="script"><link rel="prefetch" href="/assets/index.html-8e0e23db.js" as="script"><link rel="prefetch" href="/assets/index.html-d29fbae0.js" as="script"><link rel="prefetch" href="/assets/index.html-72e5310b.js" as="script"><link rel="prefetch" href="/assets/index.html-043d0be1.js" as="script"><link rel="prefetch" href="/assets/index.html-d4161c0b.js" as="script"><link rel="prefetch" href="/assets/index.html-7782d4e4.js" as="script"><link rel="prefetch" href="/assets/index.html-d972f211.js" as="script"><link rel="prefetch" href="/assets/index.html-962a5fdc.js" as="script"><link rel="prefetch" href="/assets/index.html-5f6ca3d7.js" as="script"><link rel="prefetch" href="/assets/index.html-4838ec66.js" as="script"><link rel="prefetch" href="/assets/index.html-8c01ace5.js" as="script"><link rel="prefetch" href="/assets/index.html-83e3a504.js" as="script"><link rel="prefetch" href="/assets/index.html-759d0dfd.js" as="script"><link rel="prefetch" href="/assets/index.html-33b45f5c.js" as="script"><link rel="prefetch" href="/assets/index.html-fdb09a52.js" as="script"><link rel="prefetch" href="/assets/index.html-c6faa28b.js" as="script"><link rel="prefetch" href="/assets/index.html-3ed93370.js" as="script"><link rel="prefetch" href="/assets/index.html-2d5f8051.js" as="script"><link rel="prefetch" href="/assets/index.html-a21af313.js" as="script"><link rel="prefetch" href="/assets/index.html-c0ecf076.js" as="script"><link rel="prefetch" href="/assets/index.html-565b5210.js" as="script"><link rel="prefetch" href="/assets/index.html-4f4f5e7f.js" as="script"><link rel="prefetch" href="/assets/index.html-4ff81c92.js" as="script"><link rel="prefetch" href="/assets/index.html-3a45dae4.js" as="script"><link rel="prefetch" href="/assets/index.html-e62ef013.js" as="script"><link rel="prefetch" href="/assets/index.html-a85157a4.js" as="script"><link rel="prefetch" href="/assets/index.html-3f607e66.js" as="script"><link rel="prefetch" href="/assets/index.html-5207c6fc.js" as="script"><link rel="prefetch" href="/assets/index.html-41570950.js" as="script"><link rel="prefetch" href="/assets/index.html-a56bd8fc.js" as="script"><link rel="prefetch" href="/assets/index.html-608fef74.js" as="script"><link rel="prefetch" href="/assets/index.html-ffb0bb74.js" as="script"><link rel="prefetch" href="/assets/index.html-6f3cdd42.js" as="script"><link rel="prefetch" href="/assets/index.html-f1437efe.js" as="script"><link rel="prefetch" href="/assets/index.html-a22533b4.js" as="script"><link rel="prefetch" href="/assets/index.html-29159879.js" as="script"><link rel="prefetch" href="/assets/index.html-19de3d6b.js" as="script"><link rel="prefetch" href="/assets/index.html-3e39d769.js" as="script"><link rel="prefetch" href="/assets/index.html-300c0786.js" as="script"><link rel="prefetch" href="/assets/index.html-b005fa4d.js" as="script"><link rel="prefetch" href="/assets/index.html-e6e92ab5.js" as="script"><link rel="prefetch" href="/assets/index.html-22d8b7b0.js" as="script"><link rel="prefetch" href="/assets/index.html-e82d72d2.js" as="script"><link rel="prefetch" href="/assets/index.html-aa33234b.js" as="script"><link rel="prefetch" href="/assets/index.html-4746ea10.js" as="script"><link rel="prefetch" href="/assets/index.html-b9192b25.js" as="script"><link rel="prefetch" href="/assets/index.html-b9c843bc.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f18980.js" as="script"><link rel="prefetch" href="/assets/index.html-7564c7a3.js" as="script"><link rel="prefetch" href="/assets/index.html-109ff98e.js" as="script"><link rel="prefetch" href="/assets/index.html-32343dff.js" as="script"><link rel="prefetch" href="/assets/index.html-990ccec1.js" as="script"><link rel="prefetch" href="/assets/index.html-a211ff92.js" as="script"><link rel="prefetch" href="/assets/index.html-5a493f88.js" as="script"><link rel="prefetch" href="/assets/index.html-439fff61.js" as="script"><link rel="prefetch" href="/assets/index.html-9f2560ca.js" as="script"><link rel="prefetch" href="/assets/index.html-4c5e9495.js" as="script"><link rel="prefetch" href="/assets/index.html-bd6c4f06.js" as="script"><link rel="prefetch" href="/assets/index.html-e36718b2.js" as="script"><link rel="prefetch" href="/assets/index.html-116b1720.js" as="script"><link rel="prefetch" href="/assets/index.html-28b7ce66.js" as="script"><link rel="prefetch" href="/assets/index.html-fe434380.js" as="script"><link rel="prefetch" href="/assets/index.html-6195a394.js" as="script"><link rel="prefetch" href="/assets/index.html-bc8c3f4b.js" as="script"><link rel="prefetch" href="/assets/index.html-f44da3ee.js" as="script"><link rel="prefetch" href="/assets/index.html-a9a2eb88.js" as="script"><link rel="prefetch" href="/assets/index.html-c7a22110.js" as="script"><link rel="prefetch" href="/assets/index.html-35d97455.js" as="script"><link rel="prefetch" href="/assets/index.html-5b16cc2b.js" as="script"><link rel="prefetch" href="/assets/index.html-94e24351.js" as="script"><link rel="prefetch" href="/assets/index.html-00e308cb.js" as="script"><link rel="prefetch" href="/assets/index.html-dd2a5ada.js" as="script"><link rel="prefetch" href="/assets/index.html-92f4aca0.js" as="script"><link rel="prefetch" href="/assets/index.html-77efb8d1.js" as="script"><link rel="prefetch" href="/assets/index.html-618cd7dc.js" as="script"><link rel="prefetch" href="/assets/index.html-65c25de9.js" as="script"><link rel="prefetch" href="/assets/index.html-1ce997b4.js" as="script"><link rel="prefetch" href="/assets/index.html-947a7106.js" as="script"><link rel="prefetch" href="/assets/index.html-f73e954e.js" as="script"><link rel="prefetch" href="/assets/index.html-ce7fe732.js" as="script"><link rel="prefetch" href="/assets/index.html-df312744.js" as="script"><link rel="prefetch" href="/assets/index.html-03f5d2d1.js" as="script"><link rel="prefetch" href="/assets/index.html-6339c6ac.js" as="script"><link rel="prefetch" href="/assets/index.html-ef646f4c.js" as="script"><link rel="prefetch" href="/assets/index.html-64e479a9.js" as="script"><link rel="prefetch" href="/assets/index.html-b0287b39.js" as="script"><link rel="prefetch" href="/assets/index.html-3d8b7505.js" as="script"><link rel="prefetch" href="/assets/index.html-c6e03850.js" as="script"><link rel="prefetch" href="/assets/index.html-017c4ca6.js" as="script"><link rel="prefetch" href="/assets/blog.html-ed6e864e.js" as="script"><link rel="prefetch" href="/assets/index.html-c71c75d4.js" as="script"><link rel="prefetch" href="/assets/tools.html-88fd7982.js" as="script"><link rel="prefetch" href="/assets/ajax-json(2.0).html-447b34cd.js" as="script"><link rel="prefetch" href="/assets/ajax-json.html-75467770.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-01.html-40519caa.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-02.html-14de6e43.js" as="script"><link rel="prefetch" href="/assets/jquery3基础.html-41f89174.js" as="script"><link rel="prefetch" href="/assets/jquery3高级.html-666e4c17.js" as="script"><link rel="prefetch" href="/assets/Vue.html-dea633ac.js" as="script"><link rel="prefetch" href="/assets/day01-MyBatis2.0.html-af136772.js" as="script"><link rel="prefetch" href="/assets/day02-MyBatis2.0.html-1f4147bd.js" as="script"><link rel="prefetch" href="/assets/day03-MyBatis2.0.html-a17652fe.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第一天.html-5f53da98.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第二天.html-b680eaed.js" as="script"><link rel="prefetch" href="/assets/MyBatisPlus.html-82e309a1.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-890c1c64.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇01.html-b4a20edd.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html-5aa2c449.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（一）.html-d4546e17.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（二）.html-73bd3ad7.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第一天2.0.html-c1764397.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第三天2.0.html-58df3753.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第二天2.0.html-9b776e81.js" as="script"><link rel="prefetch" href="/assets/Nacos源码分析.html-dfcab74e.js" as="script"><link rel="prefetch" href="/assets/Sentinel源码分析.html-30d35f50.js" as="script"><link rel="prefetch" href="/assets/微服务常见面试题.html-af8de6ae.js" as="script"><link rel="prefetch" href="/assets/项目场景题收集.html-b11ca3b9.js" as="script"><link rel="prefetch" href="/assets/项目工具类收集.html-650482cb.js" as="script"><link rel="prefetch" href="/assets/Windows杀进程资料.html-0f92fc98.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-2ddef7e2.js" as="script"><link rel="prefetch" href="/assets/01.Nacos 配置中心.html-87774ac5.js" as="script"><link rel="prefetch" href="/assets/02.Nacos 服务发现.html-31123597.js" as="script"><link rel="prefetch" href="/assets/03.Nacos 服务发现源码分析.html-fd658d38.js" as="script"><link rel="prefetch" href="/assets/04.Nacos 配置中心源码解读.html-e024c0f3.js" as="script"><link rel="prefetch" href="/assets/微服务保护.html-15001cf4.js" as="script"><link rel="prefetch" href="/assets/Seata Saga模式.html-87a98cd6.js" as="script"><link rel="prefetch" href="/assets/seata的部署和集成.html-8030d918.js" as="script"><link rel="prefetch" href="/assets/分布式事务Seata.html-8a2e16e9.js" as="script"><link rel="prefetch" href="/assets/Centos7安装Docker.html-cf28f5e1.js" as="script"><link rel="prefetch" href="/assets/Docker-2022-实用篇.html-bdc31c22.js" as="script"><link rel="prefetch" href="/assets/docker-linux-安装.html-c94c881a.js" as="script"><link rel="prefetch" href="/assets/docker-v1-01.html-35e97582.js" as="script"><link rel="prefetch" href="/assets/docker-v2-01.html-84f0d91d.js" as="script"><link rel="prefetch" href="/assets/docker-v2-02.html-b98768e0.js" as="script"><link rel="prefetch" href="/assets/Docker安装私人镜像仓库.html-a7b5e482.js" as="script"><link rel="prefetch" href="/assets/Docker常见问题记录.html-11a4c36c.js" as="script"><link rel="prefetch" href="/assets/Idea设置大全.html-5561f30c.js" as="script"><link rel="prefetch" href="/assets/Maven高级2.0.html-411aa364.js" as="script"><link rel="prefetch" href="/assets/Redis7-基础篇.html-b88f07e2.js" as="script"><link rel="prefetch" href="/assets/Redis7-高级篇.html-79df4575.js" as="script"><link rel="prefetch" href="/assets/01.Redis-入门篇.html-3bc65489.js" as="script"><link rel="prefetch" href="/assets/02.Redis-实战篇.html-fe2ec2d6.js" as="script"><link rel="prefetch" href="/assets/03.Redis高级篇-分布式缓存.html-dff81740.js" as="script"><link rel="prefetch" href="/assets/04.Redis高级篇-多级缓存.html-4d58208e.js" as="script"><link rel="prefetch" href="/assets/05.Redis高级篇-最佳实践.html-b6f9acc6.js" as="script"><link rel="prefetch" href="/assets/06.Redis-原理篇.html-2643611f.js" as="script"><link rel="prefetch" href="/assets/01_Spring高级49讲-容器与bean.html-b2701e40.js" as="script"><link rel="prefetch" href="/assets/02_Spring-高级49讲-AOP.html-3e771589.js" as="script"><link rel="prefetch" href="/assets/03_Spring高级49讲-WEB.html-fee8d879.js" as="script"><link rel="prefetch" href="/assets/04_Spring高级49讲-SpringBoot相关.html-da04c866.js" as="script"><link rel="prefetch" href="/assets/05_Spring高级49讲-其它.html-ce57bbac.js" as="script"><link rel="prefetch" href="/assets/spring5第一天2.0.html-55576369.js" as="script"><link rel="prefetch" href="/assets/spring5第三天2.0.html-e9243794.js" as="script"><link rel="prefetch" href="/assets/spring5第二天2.0.html-af44f104.js" as="script"><link rel="prefetch" href="/assets/spring5第四天2.0.html-acec4031.js" as="script"><link rel="prefetch" href="/assets/附录(切入点表达式规则).html-dcab157c.js" as="script"><link rel="prefetch" href="/assets/MVCC个人理解.html-bc488c14.js" as="script"><link rel="prefetch" href="/assets/MySQL安装教程.html-966b45a3.js" as="script"><link rel="prefetch" href="/assets/数据库死锁.html-a523b068.js" as="script"><link rel="prefetch" href="/assets/recursion.html-915f7926.js" as="script"><link rel="prefetch" href="/assets/Ffmpeg使用说明.html-c838cf68.js" as="script"><link rel="prefetch" href="/assets/Centos7常见问题记录.html-d14a9f38.js" as="script"><link rel="prefetch" href="/assets/Centos7新机开荒.html-363509cc.js" as="script"><link rel="prefetch" href="/assets/Centos8新机常见问题.html-a5f209fe.js" as="script"><link rel="prefetch" href="/assets/Https加密原理.html-1ab7a424.js" as="script"><link rel="prefetch" href="/assets/Java基础.html-af88ac59.js" as="script"><link rel="prefetch" href="/assets/大厂面试第一季.html-c90cb109.js" as="script"><link rel="prefetch" href="/assets/大厂面试第三季.html-d5426201.js" as="script"><link rel="prefetch" href="/assets/大厂面试第二季.html-8f455c99.js" as="script"><link rel="prefetch" href="/assets/集合常用面试题.html-ca338cd9.js" as="script"><link rel="prefetch" href="/assets/让线程顺序运行的11种方法.html-c5ff7927.js" as="script"><link rel="prefetch" href="/assets/1 怎么解决Java8 stream操作toMap的key重复问题.html-8a90dc25.js" as="script"><link rel="prefetch" href="/assets/JDK8新特性.html-d2ef356f.js" as="script"><link rel="prefetch" href="/assets/Netty01-nio.html-4116cbd9.js" as="script"><link rel="prefetch" href="/assets/Netty02-入门.html-ffdcde77.js" as="script"><link rel="prefetch" href="/assets/Netty03-进阶.html-8134f292.js" as="script"><link rel="prefetch" href="/assets/Netty04-优化与源码.html-9ad671fd.js" as="script"><link rel="prefetch" href="/assets/SpringAop的失效及解决方案.html-33d9b0bf.js" as="script"><link rel="prefetch" href="/assets/SpringBoot配置项目支持多数据库.html-138f4da8.js" as="script"><link rel="prefetch" href="/assets/Spring的生命周期.html-83fb67c4.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎01.html-8703d613.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎02.html-4bc4ace4.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎03.html-f950c967.js" as="script"><link rel="prefetch" href="/assets/笔记.html-8ffd9a18.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（一）.html-aa4477eb.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（二）.html-9bcea9f3.js" as="script"><link rel="prefetch" href="/assets/Lucene入门.html-b0d07149.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-基础篇.html-a3bc4fad.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html-81cec0f9.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-02.html-5fc7a254.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-03.html-7e5fd505.js" as="script"><link rel="prefetch" href="/assets/00-Vue3_TS.html-98745540.js" as="script"><link rel="prefetch" href="/assets/day01-基础数据开发-服务管理.html-32154fcb.js" as="script"><link rel="prefetch" href="/assets/day02-基础数据开发-服务管理-前端.html-b059902b.js" as="script"><link rel="prefetch" href="/assets/day03-基础数据开发-预约管理.html-a1bdd7ed.js" as="script"><link rel="prefetch" href="/assets/day04-权限认证-基础.html-7d31fe3b.js" as="script"><link rel="prefetch" href="/assets/day05-权限认证-SpringSecurity认证授权.html-0f237719.js" as="script"><link rel="prefetch" href="/assets/day06-权限认证-项目集成.html-a5d9a905.js" as="script"><link rel="prefetch" href="/assets/day07-工作流-Activiti7基础.html-112549e7.js" as="script"><link rel="prefetch" href="/assets/day08-入退管理-入住-1.html-6c5bc457.js" as="script"><link rel="prefetch" href="/assets/day09-入退管理-入住-2.html-713382ba.js" as="script"><link rel="prefetch" href="/assets/day10-入退管理-入住-3.html-bdc37c14.js" as="script"><link rel="prefetch" href="/assets/day11-入退管理-退住.html-254f7376.js" as="script"><link rel="prefetch" href="/assets/day12-物联网智能监测-IOT产品设备管理.html-d55bbdc1.js" as="script"><link rel="prefetch" href="/assets/day13-物联网智能监测-IOT消息处理.html-3aa20c58.js" as="script"><link rel="prefetch" href="/assets/day14-物联网智能监测-报警及优化.html-c0dcf931.js" as="script"><link rel="prefetch" href="/assets/day01-初识项目.html-42792403.js" as="script"><link rel="prefetch" href="/assets/day02-我的课表.html-c2890f67.js" as="script"><link rel="prefetch" href="/assets/day03-学习计划和进度.html-6b97bcb6.js" as="script"><link rel="prefetch" href="/assets/day04-高并发优化.html-41810cd8.js" as="script"><link rel="prefetch" href="/assets/day05-问答系统.html-17ecd944.js" as="script"><link rel="prefetch" href="/assets/day06-点赞系统.html-deceb29f.js" as="script"><link rel="prefetch" href="/assets/day07-积分系统.html-f26d24a1.js" as="script"><link rel="prefetch" href="/assets/day08-排行榜功能.html-6f221915.js" as="script"><link rel="prefetch" href="/assets/day09-优惠券管理.html-36a1f249.js" as="script"><link rel="prefetch" href="/assets/day10-领取优惠券.html-05a5078d.js" as="script"><link rel="prefetch" href="/assets/day11-领取优惠券的优化.html-08416abc.js" as="script"><link rel="prefetch" href="/assets/day12-优惠券使用.html-52688612.js" as="script"><link rel="prefetch" href="/assets/day13~14-分组实战.html-9c6db439.js" as="script"><link rel="prefetch" href="/assets/内网穿透说明.html-7b3eb5af.js" as="script"><link rel="prefetch" href="/assets/自定义部署.html-e652a414.js" as="script"><link rel="prefetch" href="/assets/虚拟机导入说明.html-2dc96ec1.js" as="script"><link rel="prefetch" href="/assets/hutool使用手册.html-3e235db9.js" as="script"><link rel="prefetch" href="/assets/Jenkins使用手册.html-3863f83e.js" as="script"><link rel="prefetch" href="/assets/前端部署文档.html-d0e52161.js" as="script"><link rel="prefetch" href="/assets/学习目标.html-f75f61a4.js" as="script"><link rel="prefetch" href="/assets/常见问题手册.html-74ae623d.js" as="script"><link rel="prefetch" href="/assets/权限管家使用说明.html-27793288.js" as="script"><link rel="prefetch" href="/assets/虚拟机导入手册.html-bc4c6084.js" as="script"><link rel="prefetch" href="/assets/day01-项目概述.html-6c4e7a6c.js" as="script"><link rel="prefetch" href="/assets/day02-网关与支付.html-fb6f6517.js" as="script"><link rel="prefetch" href="/assets/day03-支付微服务.html-90eb6027.js" as="script"><link rel="prefetch" href="/assets/day04-运费微服务.html-6a761581.js" as="script"><link rel="prefetch" href="/assets/day05-路线规划之Neo4j入门.html-121dece3.js" as="script"><link rel="prefetch" href="/assets/day06-路线规划之微服务.html-433c5ed5.js" as="script"><link rel="prefetch" href="/assets/day07-智能调度之调度任务.html-e500ccf0.js" as="script"><link rel="prefetch" href="/assets/day08-智能调度之运输任务.html-57665e34.js" as="script"><link rel="prefetch" href="/assets/day09-智能调度之作业范围.html-7b8b2836.js" as="script"><link rel="prefetch" href="/assets/day10-智能调度之取派件调度.html-742f2334.js" as="script"><link rel="prefetch" href="/assets/day11-物流信息微服务.html-20b58c26.js" as="script"><link rel="prefetch" href="/assets/day12-分布式日志与链路追踪.html-bb5af07c.js" as="script"><link rel="prefetch" href="/assets/day13_14 项目分组实战.html-fe21391b.js" as="script"><link rel="prefetch" href="/assets/01 MySQL概述.html-228f764f.js" as="script"><link rel="prefetch" href="/assets/02 MySQL分类.html-845d5c68.js" as="script"><link rel="prefetch" href="/assets/03 MySQL函数.html-c9b38f03.js" as="script"><link rel="prefetch" href="/assets/04 MySQL约束.html-622d37e5.js" as="script"><link rel="prefetch" href="/assets/05 MySQL多表查询.html-42dc25dd.js" as="script"><link rel="prefetch" href="/assets/06 MySQL事务.html-1061b2b6.js" as="script"><link rel="prefetch" href="/assets/1 日志.html-927285e4.js" as="script"><link rel="prefetch" href="/assets/2 主从复制.html-56514823.js" as="script"><link rel="prefetch" href="/assets/3 分库分表.html-80cde87d.js" as="script"><link rel="prefetch" href="/assets/4 MyCat.html-67453d6d.js" as="script"><link rel="prefetch" href="/assets/5 读写分离.html-bc72deaa.js" as="script"><link rel="prefetch" href="/assets/01 存储引擎.html-c4d5d987.js" as="script"><link rel="prefetch" href="/assets/02 索引.html-6490a781.js" as="script"><link rel="prefetch" href="/assets/03 MySQL优化.html-d9bfcfe5.js" as="script"><link rel="prefetch" href="/assets/04 视图、存储过程、触发器.html-feae5a7e.js" as="script"><link rel="prefetch" href="/assets/05 锁.html-65cd1ed3.js" as="script"><link rel="prefetch" href="/assets/06 事务.html-e5632863.js" as="script"><link rel="prefetch" href="/assets/07 MySQL管理.html-f1bfc7ae.js" as="script"><link rel="prefetch" href="/assets/404.html-672e822f.js" as="script"><link rel="prefetch" href="/assets/index.html-4ef23e01.js" as="script"><link rel="prefetch" href="/assets/index.html-8a766d14.js" as="script"><link rel="prefetch" href="/assets/index.html-8e4b9257.js" as="script"><link rel="prefetch" href="/assets/index.html-7b48c52a.js" as="script"><link rel="prefetch" href="/assets/index.html-ebd5d746.js" as="script"><link rel="prefetch" href="/assets/index.html-dc4d71bf.js" as="script"><link rel="prefetch" href="/assets/index.html-995ea5c3.js" as="script"><link rel="prefetch" href="/assets/index.html-ad50852a.js" as="script"><link rel="prefetch" href="/assets/index.html-a430b559.js" as="script"><link rel="prefetch" href="/assets/index.html-6f69a3cb.js" as="script"><link rel="prefetch" href="/assets/index.html-1ff07e87.js" as="script"><link rel="prefetch" href="/assets/index.html-d4929fe8.js" as="script"><link rel="prefetch" href="/assets/index.html-88fa183c.js" as="script"><link rel="prefetch" href="/assets/index.html-cd751dab.js" as="script"><link rel="prefetch" href="/assets/index.html-ba9d2333.js" as="script"><link rel="prefetch" href="/assets/index.html-70d4bee0.js" as="script"><link rel="prefetch" href="/assets/index.html-3cad4791.js" as="script"><link rel="prefetch" href="/assets/index.html-22838b8a.js" as="script"><link rel="prefetch" href="/assets/index.html-dea186a7.js" as="script"><link rel="prefetch" href="/assets/index.html-757f1f74.js" as="script"><link rel="prefetch" href="/assets/index.html-8181eb3f.js" as="script"><link rel="prefetch" href="/assets/index.html-86902fa7.js" as="script"><link rel="prefetch" href="/assets/index.html-00850d00.js" as="script"><link rel="prefetch" href="/assets/index.html-f6aad417.js" as="script"><link rel="prefetch" href="/assets/index.html-cdb11813.js" as="script"><link rel="prefetch" href="/assets/index.html-2c0d5e33.js" as="script"><link rel="prefetch" href="/assets/index.html-2965111e.js" as="script"><link rel="prefetch" href="/assets/index.html-dfc39893.js" as="script"><link rel="prefetch" href="/assets/index.html-2953f344.js" as="script"><link rel="prefetch" href="/assets/index.html-91ed422c.js" as="script"><link rel="prefetch" href="/assets/index.html-6efbb4c1.js" as="script"><link rel="prefetch" href="/assets/index.html-14c946c5.js" as="script"><link rel="prefetch" href="/assets/index.html-2f475201.js" as="script"><link rel="prefetch" href="/assets/index.html-f41eeaed.js" as="script"><link rel="prefetch" href="/assets/index.html-23da4273.js" as="script"><link rel="prefetch" href="/assets/index.html-fb97c365.js" as="script"><link rel="prefetch" href="/assets/index.html-73fd6e8f.js" as="script"><link rel="prefetch" href="/assets/index.html-fdf3599e.js" as="script"><link rel="prefetch" href="/assets/index.html-79515456.js" as="script"><link rel="prefetch" href="/assets/index.html-ccc42aa3.js" as="script"><link rel="prefetch" href="/assets/index.html-9d3ed00d.js" as="script"><link rel="prefetch" href="/assets/index.html-050c3924.js" as="script"><link rel="prefetch" href="/assets/index.html-7aa164a6.js" as="script"><link rel="prefetch" href="/assets/index.html-39cc2e3a.js" as="script"><link rel="prefetch" href="/assets/index.html-f5f9e169.js" as="script"><link rel="prefetch" href="/assets/index.html-62c81062.js" as="script"><link rel="prefetch" href="/assets/index.html-2e171ea6.js" as="script"><link rel="prefetch" href="/assets/index.html-12d84144.js" as="script"><link rel="prefetch" href="/assets/index.html-9f8cf0ac.js" as="script"><link rel="prefetch" href="/assets/index.html-9fcdfa5f.js" as="script"><link rel="prefetch" href="/assets/index.html-1e2a74f3.js" as="script"><link rel="prefetch" href="/assets/index.html-02461c85.js" as="script"><link rel="prefetch" href="/assets/index.html-dc74597e.js" as="script"><link rel="prefetch" href="/assets/index.html-6536cc17.js" as="script"><link rel="prefetch" href="/assets/index.html-1fbe5d99.js" as="script"><link rel="prefetch" href="/assets/index.html-1c7772aa.js" as="script"><link rel="prefetch" href="/assets/index.html-3cd6aa1e.js" as="script"><link rel="prefetch" href="/assets/index.html-60d39b16.js" as="script"><link rel="prefetch" href="/assets/index.html-d464285d.js" as="script"><link rel="prefetch" href="/assets/index.html-148f39b9.js" as="script"><link rel="prefetch" href="/assets/index.html-b19daf41.js" as="script"><link rel="prefetch" href="/assets/index.html-98ba68c5.js" as="script"><link rel="prefetch" href="/assets/index.html-207e1401.js" as="script"><link rel="prefetch" href="/assets/index.html-7bec3db5.js" as="script"><link rel="prefetch" href="/assets/index.html-fdcbc05d.js" as="script"><link rel="prefetch" href="/assets/index.html-4aff40b9.js" as="script"><link rel="prefetch" href="/assets/index.html-48871186.js" as="script"><link rel="prefetch" href="/assets/index.html-c420eb5a.js" as="script"><link rel="prefetch" href="/assets/index.html-2ae08489.js" as="script"><link rel="prefetch" href="/assets/index.html-9d207fe9.js" as="script"><link rel="prefetch" href="/assets/index.html-1f449643.js" as="script"><link rel="prefetch" href="/assets/index.html-dd51053d.js" as="script"><link rel="prefetch" href="/assets/index.html-83dad442.js" as="script"><link rel="prefetch" href="/assets/index.html-c79db7fe.js" as="script"><link rel="prefetch" href="/assets/index.html-dec20722.js" as="script"><link rel="prefetch" href="/assets/index.html-8fba0e94.js" as="script"><link rel="prefetch" href="/assets/index.html-cf66b2b8.js" as="script"><link rel="prefetch" href="/assets/index.html-2f7aa6b2.js" as="script"><link rel="prefetch" href="/assets/index.html-bc16aa70.js" as="script"><link rel="prefetch" href="/assets/index.html-afcd6709.js" as="script"><link rel="prefetch" href="/assets/index.html-87d6f9d7.js" as="script"><link rel="prefetch" href="/assets/index.html-57ab3cc1.js" as="script"><link rel="prefetch" href="/assets/index.html-8260b18a.js" as="script"><link rel="prefetch" href="/assets/index.html-d4928698.js" as="script"><link rel="prefetch" href="/assets/index.html-ec3f77f5.js" as="script"><link rel="prefetch" href="/assets/index.html-5d4b720b.js" as="script"><link rel="prefetch" href="/assets/index.html-ae445867.js" as="script"><link rel="prefetch" href="/assets/index.html-1f66a25c.js" as="script"><link rel="prefetch" href="/assets/index.html-38c0366f.js" as="script"><link rel="prefetch" href="/assets/index.html-659c2c75.js" as="script"><link rel="prefetch" href="/assets/index.html-97767dd6.js" as="script"><link rel="prefetch" href="/assets/index.html-af0b2530.js" as="script"><link rel="prefetch" href="/assets/index.html-2ec7ed31.js" as="script"><link rel="prefetch" href="/assets/index.html-1ea9c14b.js" as="script"><link rel="prefetch" href="/assets/index.html-d86d9920.js" as="script"><link rel="prefetch" href="/assets/index.html-63868ee7.js" as="script"><link rel="prefetch" href="/assets/index.html-d24010a0.js" as="script"><link rel="prefetch" href="/assets/index.html-695da3ca.js" as="script"><link rel="prefetch" href="/assets/index.html-dd10c875.js" as="script"><link rel="prefetch" href="/assets/index.html-34b80565.js" as="script"><link rel="prefetch" href="/assets/index.html-a4fe7db4.js" as="script"><link rel="prefetch" href="/assets/index.html-682cb7b2.js" as="script"><link rel="prefetch" href="/assets/index.html-1cfd8a7d.js" as="script"><link rel="prefetch" href="/assets/index.html-67ef2d93.js" as="script"><link rel="prefetch" href="/assets/index.html-7151a4a7.js" as="script"><link rel="prefetch" href="/assets/index.html-55dddab7.js" as="script"><link rel="prefetch" href="/assets/index.html-1cf5accf.js" as="script"><link rel="prefetch" href="/assets/index.html-1a12c152.js" as="script"><link rel="prefetch" href="/assets/index.html-6af06aff.js" as="script"><link rel="prefetch" href="/assets/index.html-8336f6d7.js" as="script"><link rel="prefetch" href="/assets/index.html-3fc6f6d8.js" as="script"><link rel="prefetch" href="/assets/index.html-9e88a2fa.js" as="script"><link rel="prefetch" href="/assets/index.html-a3727da4.js" as="script"><link rel="prefetch" href="/assets/index.html-8bf81fbe.js" as="script"><link rel="prefetch" href="/assets/index.html-0f247ecb.js" as="script"><link rel="prefetch" href="/assets/index.html-4495698e.js" as="script"><link rel="prefetch" href="/assets/index.html-2a20b70a.js" as="script"><link rel="prefetch" href="/assets/index.html-35342cc6.js" as="script"><link rel="prefetch" href="/assets/index.html-21bea1cf.js" as="script"><link rel="prefetch" href="/assets/index.html-a881d916.js" as="script"><link rel="prefetch" href="/assets/index.html-e165674b.js" as="script"><link rel="prefetch" href="/assets/index.html-87520932.js" as="script"><link rel="prefetch" href="/assets/index.html-592553a8.js" as="script"><link rel="prefetch" href="/assets/index.html-ddc93a6a.js" as="script"><link rel="prefetch" href="/assets/index.html-c574e908.js" as="script"><link rel="prefetch" href="/assets/index.html-c62921cd.js" as="script"><link rel="prefetch" href="/assets/index.html-93f32ce6.js" as="script"><link rel="prefetch" href="/assets/index.html-e8e6b9d0.js" as="script"><link rel="prefetch" href="/assets/index.html-a10af057.js" as="script"><link rel="prefetch" href="/assets/index.html-4cda6753.js" as="script"><link rel="prefetch" href="/assets/index.html-41e5be32.js" as="script"><link rel="prefetch" href="/assets/index.html-4eefbb59.js" as="script"><link rel="prefetch" href="/assets/index.html-1ba2033b.js" as="script"><link rel="prefetch" href="/assets/index.html-fc5428e1.js" as="script"><link rel="prefetch" href="/assets/index.html-48a300a6.js" as="script"><link rel="prefetch" href="/assets/index.html-b70088d4.js" as="script"><link rel="prefetch" href="/assets/index.html-2c50a34a.js" as="script"><link rel="prefetch" href="/assets/index.html-c6c1024f.js" as="script"><link rel="prefetch" href="/assets/index.html-939f1d55.js" as="script"><link rel="prefetch" href="/assets/index.html-872814dc.js" as="script"><link rel="prefetch" href="/assets/index.html-f7b269ee.js" as="script"><link rel="prefetch" href="/assets/index.html-df855031.js" as="script"><link rel="prefetch" href="/assets/index.html-5b0313da.js" as="script"><link rel="prefetch" href="/assets/index.html-4e8efecb.js" as="script"><link rel="prefetch" href="/assets/index.html-cbc2eb2e.js" as="script"><link rel="prefetch" href="/assets/index.html-839cd2b3.js" as="script"><link rel="prefetch" href="/assets/index.html-1a24f0a1.js" as="script"><link rel="prefetch" href="/assets/index.html-970f3d99.js" as="script"><link rel="prefetch" href="/assets/index.html-7e5051b7.js" as="script"><link rel="prefetch" href="/assets/index.html-94b2c989.js" as="script"><link rel="prefetch" href="/assets/index.html-4f86f2c0.js" as="script"><link rel="prefetch" href="/assets/index.html-8d1484be.js" as="script"><link rel="prefetch" href="/assets/index.html-7eaf78d2.js" as="script"><link rel="prefetch" href="/assets/index.html-0101a776.js" as="script"><link rel="prefetch" href="/assets/index.html-9a4ed3e0.js" as="script"><link rel="prefetch" href="/assets/index.html-9c9f91fa.js" as="script"><link rel="prefetch" href="/assets/index.html-0cc7373d.js" as="script"><link rel="prefetch" href="/assets/index.html-500efc2c.js" as="script"><link rel="prefetch" href="/assets/index.html-566433b8.js" as="script"><link rel="prefetch" href="/assets/index.html-ac25caf4.js" as="script"><link rel="prefetch" href="/assets/index.html-5f962fb0.js" as="script"><link rel="prefetch" href="/assets/index.html-73bc48d7.js" as="script"><link rel="prefetch" href="/assets/index.html-ce9697fe.js" as="script"><link rel="prefetch" href="/assets/index.html-d290ed6a.js" as="script"><link rel="prefetch" href="/assets/index.html-72fb68d8.js" as="script"><link rel="prefetch" href="/assets/index.html-31c342f1.js" as="script"><link rel="prefetch" href="/assets/index.html-c87ee953.js" as="script"><link rel="prefetch" href="/assets/index.html-0abecc99.js" as="script"><link rel="prefetch" href="/assets/index.html-b9523071.js" as="script"><link rel="prefetch" href="/assets/index.html-a85ea6f2.js" as="script"><link rel="prefetch" href="/assets/index.html-fa58dc44.js" as="script"><link rel="prefetch" href="/assets/index.html-bceaa0bb.js" as="script"><link rel="prefetch" href="/assets/index.html-d6272c3b.js" as="script"><link rel="prefetch" href="/assets/index.html-9c32f8bd.js" as="script"><link rel="prefetch" href="/assets/index.html-942d2b1c.js" as="script"><link rel="prefetch" href="/assets/index.html-5e251be2.js" as="script"><link rel="prefetch" href="/assets/index.html-10a1f6dc.js" as="script"><link rel="prefetch" href="/assets/index.html-f0ba67e9.js" as="script"><link rel="prefetch" href="/assets/index.html-f08f00fe.js" as="script"><link rel="prefetch" href="/assets/index.html-d4f656ce.js" as="script"><link rel="prefetch" href="/assets/index.html-c47df085.js" as="script"><link rel="prefetch" href="/assets/index.html-e94fbe88.js" as="script"><link rel="prefetch" href="/assets/index.html-a7d23c94.js" as="script"><link rel="prefetch" href="/assets/index.html-72c70b35.js" as="script"><link rel="prefetch" href="/assets/index.html-5fc200bd.js" as="script"><link rel="prefetch" href="/assets/index.html-41423985.js" as="script"><link rel="prefetch" href="/assets/index.html-dc182f65.js" as="script"><link rel="prefetch" href="/assets/index.html-70835395.js" as="script"><link rel="prefetch" href="/assets/index.html-07330ff3.js" as="script"><link rel="prefetch" href="/assets/index.html-0ff5d01a.js" as="script"><link rel="prefetch" href="/assets/index.html-084b272c.js" as="script"><link rel="prefetch" href="/assets/index.html-ffbac4b2.js" as="script"><link rel="prefetch" href="/assets/index.html-7aa06b1c.js" as="script"><link rel="prefetch" href="/assets/index.html-9f1bb8ba.js" as="script"><link rel="prefetch" href="/assets/index.html-37d868f9.js" as="script"><link rel="prefetch" href="/assets/index.html-bbf06b46.js" as="script"><link rel="prefetch" href="/assets/index.html-3436e70b.js" as="script"><link rel="prefetch" href="/assets/index.html-99a82500.js" as="script"><link rel="prefetch" href="/assets/index.html-9e2a2561.js" as="script"><link rel="prefetch" href="/assets/index.html-4a0b57e4.js" as="script"><link rel="prefetch" href="/assets/index.html-c89dbd90.js" as="script"><link rel="prefetch" href="/assets/index.html-3152fb2a.js" as="script"><link rel="prefetch" href="/assets/index.html-9465aa05.js" as="script"><link rel="prefetch" href="/assets/index.html-2f1d2919.js" as="script"><link rel="prefetch" href="/assets/index.html-df801bd9.js" as="script"><link rel="prefetch" href="/assets/index.html-804ea6b4.js" as="script"><link rel="prefetch" href="/assets/index.html-dae00c88.js" as="script"><link rel="prefetch" href="/assets/index.html-f0da22f0.js" as="script"><link rel="prefetch" href="/assets/index.html-d8141028.js" as="script"><link rel="prefetch" href="/assets/index.html-fda84e1f.js" as="script"><link rel="prefetch" href="/assets/index.html-e8b63ca8.js" as="script"><link rel="prefetch" href="/assets/index.html-cf459cc3.js" as="script"><link rel="prefetch" href="/assets/index.html-db114f42.js" as="script"><link rel="prefetch" href="/assets/index.html-b2274d5d.js" as="script"><link rel="prefetch" href="/assets/index.html-5f4df9f9.js" as="script"><link rel="prefetch" href="/assets/index.html-400ae36d.js" as="script"><link rel="prefetch" href="/assets/index.html-17a2e5a0.js" as="script"><link rel="prefetch" href="/assets/index.html-8bfdb8c0.js" as="script"><link rel="prefetch" href="/assets/index.html-e487a93f.js" as="script"><link rel="prefetch" href="/assets/index.html-95c44869.js" as="script"><link rel="prefetch" href="/assets/index.html-e1012864.js" as="script"><link rel="prefetch" href="/assets/index.html-7858b8e7.js" as="script"><link rel="prefetch" href="/assets/index.html-9b43139c.js" as="script"><link rel="prefetch" href="/assets/index.html-c005ced5.js" as="script"><link rel="prefetch" href="/assets/index.html-cdd5d83d.js" as="script"><link rel="prefetch" href="/assets/index.html-661c4603.js" as="script"><link rel="prefetch" href="/assets/index.html-f68feae2.js" as="script"><link rel="prefetch" href="/assets/index.html-97afeeef.js" as="script"><link rel="prefetch" href="/assets/index.html-5505df29.js" as="script"><link rel="prefetch" href="/assets/index.html-0a738bac.js" as="script"><link rel="prefetch" href="/assets/index.html-81cc787f.js" as="script"><link rel="prefetch" href="/assets/index.html-dce6d882.js" as="script"><link rel="prefetch" href="/assets/index.html-657df70e.js" as="script"><link rel="prefetch" href="/assets/index.html-c2660d50.js" as="script"><link rel="prefetch" href="/assets/index.html-236d1acb.js" as="script"><link rel="prefetch" href="/assets/index.html-552995e9.js" as="script"><link rel="prefetch" href="/assets/index.html-86425d4e.js" as="script"><link rel="prefetch" href="/assets/index.html-d67c4ee9.js" as="script"><link rel="prefetch" href="/assets/index.html-7391b89f.js" as="script"><link rel="prefetch" href="/assets/index.html-1d1e3000.js" as="script"><link rel="prefetch" href="/assets/index.html-377a0fe7.js" as="script"><link rel="prefetch" href="/assets/index.html-562a666a.js" as="script"><link rel="prefetch" href="/assets/index.html-4d076b8b.js" as="script"><link rel="prefetch" href="/assets/index.html-9f9b8e51.js" as="script"><link rel="prefetch" href="/assets/index.html-7565ff98.js" as="script"><link rel="prefetch" href="/assets/index.html-623339af.js" as="script"><link rel="prefetch" href="/assets/index.html-e59ee12d.js" as="script"><link rel="prefetch" href="/assets/index.html-97a9a43f.js" as="script"><link rel="prefetch" href="/assets/index.html-20ad6d5e.js" as="script"><link rel="prefetch" href="/assets/index.html-7543b3b1.js" as="script"><link rel="prefetch" href="/assets/index.html-3c3485d8.js" as="script"><link rel="prefetch" href="/assets/index.html-39aa39eb.js" as="script"><link rel="prefetch" href="/assets/index.html-0a25e35d.js" as="script"><link rel="prefetch" href="/assets/index.html-4f713dc5.js" as="script"><link rel="prefetch" href="/assets/index.html-e69951d8.js" as="script"><link rel="prefetch" href="/assets/index.html-83b77a94.js" as="script"><link rel="prefetch" href="/assets/index.html-19f5dda9.js" as="script"><link rel="prefetch" href="/assets/index.html-3793eb99.js" as="script"><link rel="prefetch" href="/assets/index.html-c6e66ae5.js" as="script"><link rel="prefetch" href="/assets/index.html-556c9614.js" as="script"><link rel="prefetch" href="/assets/index.html-204eaa2d.js" as="script"><link rel="prefetch" href="/assets/index.html-ccc7885f.js" as="script"><link rel="prefetch" href="/assets/index.html-dc09372a.js" as="script"><link rel="prefetch" href="/assets/index.html-b92d8dfc.js" as="script"><link rel="prefetch" href="/assets/index.html-81b273d4.js" as="script"><link rel="prefetch" href="/assets/index.html-9a419070.js" as="script"><link rel="prefetch" href="/assets/index.html-4bc96a3f.js" as="script"><link rel="prefetch" href="/assets/index.html-77112acb.js" as="script"><link rel="prefetch" href="/assets/index.html-7f0ecb0e.js" as="script"><link rel="prefetch" href="/assets/index.html-892db43a.js" as="script"><link rel="prefetch" href="/assets/index.html-c11793e9.js" as="script"><link rel="prefetch" href="/assets/index.html-a279cdc4.js" as="script"><link rel="prefetch" href="/assets/index.html-5e9fe671.js" as="script"><link rel="prefetch" href="/assets/index.html-1a1e920c.js" as="script"><link rel="prefetch" href="/assets/index.html-1e330778.js" as="script"><link rel="prefetch" href="/assets/index.html-322ec98b.js" as="script"><link rel="prefetch" href="/assets/index.html-8abb472f.js" as="script"><link rel="prefetch" href="/assets/index.html-176bca49.js" as="script"><link rel="prefetch" href="/assets/index.html-0861b1a5.js" as="script"><link rel="prefetch" href="/assets/index.html-2b159dcb.js" as="script"><link rel="prefetch" href="/assets/index.html-8e548d45.js" as="script"><link rel="prefetch" href="/assets/index.html-6500f692.js" as="script"><link rel="prefetch" href="/assets/index.html-483f2522.js" as="script"><link rel="prefetch" href="/assets/index.html-f802da12.js" as="script"><link rel="prefetch" href="/assets/index.html-58f6ff70.js" as="script"><link rel="prefetch" href="/assets/index.html-65e20726.js" as="script"><link rel="prefetch" href="/assets/index.html-8a9ac54c.js" as="script"><link rel="prefetch" href="/assets/index.html-11d884e7.js" as="script"><link rel="prefetch" href="/assets/index.html-ef488e7b.js" as="script"><link rel="prefetch" href="/assets/index.html-4f3416fa.js" as="script"><link rel="prefetch" href="/assets/index.html-9d277497.js" as="script"><link rel="prefetch" href="/assets/index.html-98a2352b.js" as="script"><link rel="prefetch" href="/assets/index.html-ff4186f1.js" as="script"><link rel="prefetch" href="/assets/index.html-af96e99c.js" as="script"><link rel="prefetch" href="/assets/index.html-d505c29e.js" as="script"><link rel="prefetch" href="/assets/index.html-40a0449e.js" as="script"><link rel="prefetch" href="/assets/index.html-bd3c7981.js" as="script"><link rel="prefetch" href="/assets/index.html-6c628076.js" as="script"><link rel="prefetch" href="/assets/index.html-860e678a.js" as="script"><link rel="prefetch" href="/assets/index.html-2d153758.js" as="script"><link rel="prefetch" href="/assets/index.html-9d8f84a0.js" as="script"><link rel="prefetch" href="/assets/index.html-96d3df7d.js" as="script"><link rel="prefetch" href="/assets/index.html-563d3ee3.js" as="script"><link rel="prefetch" href="/assets/index.html-8417cc60.js" as="script"><link rel="prefetch" href="/assets/index.html-47db330d.js" as="script"><link rel="prefetch" href="/assets/index.html-8c9bddc7.js" as="script"><link rel="prefetch" href="/assets/index.html-93e5e243.js" as="script"><link rel="prefetch" href="/assets/index.html-2d2ec844.js" as="script"><link rel="prefetch" href="/assets/index.html-fc55696f.js" as="script"><link rel="prefetch" href="/assets/index.html-2b01c543.js" as="script"><link rel="prefetch" href="/assets/index.html-234291de.js" as="script"><link rel="prefetch" href="/assets/index.html-169097e5.js" as="script"><link rel="prefetch" href="/assets/index.html-77717730.js" as="script"><link rel="prefetch" href="/assets/index.html-7561378f.js" as="script"><link rel="prefetch" href="/assets/index.html-51b558fd.js" as="script"><link rel="prefetch" href="/assets/index.html-0d421803.js" as="script"><link rel="prefetch" href="/assets/index.html-6c93524c.js" as="script"><link rel="prefetch" href="/assets/index.html-8b845191.js" as="script"><link rel="prefetch" href="/assets/index.html-8ae7a65e.js" as="script"><link rel="prefetch" href="/assets/index.html-3303c616.js" as="script"><link rel="prefetch" href="/assets/index.html-8319554e.js" as="script"><link rel="prefetch" href="/assets/index.html-889b8cd0.js" as="script"><link rel="prefetch" href="/assets/index.html-acd6e65b.js" as="script"><link rel="prefetch" href="/assets/index.html-09a0cf94.js" as="script"><link rel="prefetch" href="/assets/index.html-f163203e.js" as="script"><link rel="prefetch" href="/assets/index.html-4b080c4c.js" as="script"><link rel="prefetch" href="/assets/index.html-4bdb057f.js" as="script"><link rel="prefetch" href="/assets/index.html-904d55b9.js" as="script"><link rel="prefetch" href="/assets/index.html-828fc214.js" as="script"><link rel="prefetch" href="/assets/index.html-5373e90f.js" as="script"><link rel="prefetch" href="/assets/index.html-2ea6c527.js" as="script"><link rel="prefetch" href="/assets/index.html-5a6b44e9.js" as="script"><link rel="prefetch" href="/assets/index.html-bb44f534.js" as="script"><link rel="prefetch" href="/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/assets/index-a7d1ee58.js" as="script"><link rel="prefetch" href="/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-cf14c681.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-abe06b83.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-9d3ef433.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script"><link rel="prefetch" href="/assets/SearchResult-39de7c35.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt="lyf blog"><!----><span class="vp-site-name hide-in-pad">lyf blog</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/"><!---->首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java/socket/"><span class="font-icon icon iconfont icon-network" style=""></span>网络编程<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="数据库"><span class="title"><span class="font-icon icon iconfont icon-mysql" style=""></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/database/mysql/"><span class="font-icon icon iconfont icon-mysql" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/database/redis/"><span class="font-icon icon iconfont icon-redis" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/database/mongo/"><span class="font-icon icon iconfont icon-mongo" style=""></span>MongoDB<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="框架"><span class="title"><span class="font-icon icon iconfont icon-framework" style=""></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/framework/spring/"><span class="font-icon icon iconfont icon-spring" style=""></span>Spring<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/framework/springmvc/"><span class="font-icon icon iconfont icon-mvc" style=""></span>SpringMVC<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/framework/mybatis/"><span class="font-icon icon iconfont icon-mybatis" style=""></span>Mybatis<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/framework/mybatis-plus/"><span class="font-icon icon iconfont icon-mybatisplus" style=""></span>MybatisPlus<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/framework/springboot/"><span class="font-icon icon iconfont icon-springboot" style=""></span>SpringBoot<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/framework/springcloud/"><span class="font-icon icon iconfont icon-springcloud" style=""></span>SpringCloud<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="中间件"><span class="title"><span class="font-icon icon iconfont icon-middleware" style=""></span>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>消息中间件</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/middleware/mq/rabbitmq/"><span class="font-icon icon iconfont icon-rabbitmq" style=""></span>RabbitMQ<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link active" href="/middleware/mq/rocketmq/"><span class="font-icon icon iconfont icon-rocketmq" style=""></span>RocketMQ<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/middleware/mq/kafka/"><span class="font-icon icon iconfont icon-kafka" style=""></span>Kafka<!----></a></li></ul></li><li class="dropdown-item"><a class="vp-link nav-link" href="/middleware/elasticsearch/"><span class="font-icon icon iconfont icon-es" style=""></span>分布式搜索<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/middleware/nacos/"><span class="font-icon icon iconfont icon-nacos" style=""></span>nacos<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/middleware/seata/"><span class="font-icon icon iconfont icon-seata" style=""></span>seata<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/middleware/sentinel/"><span class="font-icon icon iconfont icon-sentinel" style=""></span>sentinel<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/middleware/dubbo/"><span class="font-icon icon iconfont icon-dubbo" style=""></span>dubbo<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/middleware/zookeeper/"><span class="font-icon icon iconfont icon-zookeeper" style=""></span>zookeeper<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="分布式"><span class="title"><span class="font-icon icon iconfont icon-distributed" style=""></span>分布式</span><span class="arrow"></span><ul class="nav-dropdown"></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="容器与开发工具"><span class="title"><span class="font-icon icon iconfont icon-tool" style=""></span>容器与开发工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/tools/idea/"><span class="font-icon icon iconfont icon-idea" style=""></span>IDEA<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/tools/maven/"><span class="font-icon icon iconfont icon-maven" style=""></span>Maven<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/tools/docker/"><span class="font-icon icon iconfont icon-docker" style=""></span>docker<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/tools/k8s/"><span class="font-icon icon iconfont icon-k8s" style=""></span>k8s<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="项目"><span class="title"><span class="font-icon icon iconfont icon-project" style=""></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/project/slwl/"><span class="font-icon icon iconfont icon-project" style=""></span>神领物流<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/project/tjxt/"><span class="font-icon icon iconfont icon-project" style=""></span>天机学堂<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/project/hmtt/"><span class="font-icon icon iconfont icon-project" style=""></span>黑马头条<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/project/zzyl/"><span class="font-icon icon iconfont icon-project" style=""></span>中州养老<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/project/j2oto/"><span class="font-icon icon iconfont icon-project" style=""></span>云岚到家<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="前端"><span class="title"><span class="font-icon icon iconfont icon-front" style=""></span>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/frontajax/"><span class="font-icon icon iconfont icon-ajax" style=""></span>ajax<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/frontbootstrap/"><span class="font-icon icon iconfont icon-bootstrap" style=""></span>bootstrap<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/frontjquery/"><span class="font-icon icon iconfont icon-jquery" style=""></span>jquery<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/frontvue/"><span class="font-icon icon iconfont icon-vue" style=""></span>vue<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="面试"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>面试</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/javabase/"><span class="font-icon icon iconfont icon-java" style=""></span>Java基础<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/database/"><span class="font-icon icon iconfont icon-mysql" style=""></span>数据库<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/ssm/"><span class="font-icon icon iconfont icon-java" style=""></span>常用框架<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/cloud/"><span class="font-icon icon iconfont icon-es6" style=""></span>微服务<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/computer/"><span class="font-icon icon iconfont icon-computer" style=""></span>计算机原理<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/windows/"><span class="font-icon icon iconfont icon-computer" style=""></span>windows相关<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/interview/project/"><span class="font-icon icon iconfont icon-workingDirectory" style=""></span>项目<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="其它"><span class="title"><span class="font-icon icon iconfont icon-others" style=""></span>其它</span><span class="arrow"></span><ul class="nav-dropdown"></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="书签"><span class="title"><span class="font-icon icon iconfont icon-tool" style=""></span>书签</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="http://localhost:12345/index.html" rel="noopener noreferrer" target="_blank" aria-label="常用书签" class="nav-link"><!---->常用书签<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="http://localhost:12345/program/index.html" rel="noopener noreferrer" target="_blank" aria-label="编程书签" class="nav-link"><!---->编程书签<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/lyf110/lyf110.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-database" style=""></span><span class="vp-sidebar-title">数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-framework" style=""></span><span class="vp-sidebar-title">框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-middleware" style=""></span><span class="vp-sidebar-title">中间件</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-mq" style=""></span><span class="vp-sidebar-title">消息中间件</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-mq" style=""></span><span class="vp-sidebar-title">RabbitMQ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-mq" style=""></span><span class="vp-sidebar-title">RocketMq</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/middleware/mq/rocketmq/RocketMQ-01.html"><!---->一、RocketMQ入门第一天<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_1-1-为什么要用mq"><!---->1.1 为什么要用MQ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_1-2-mq的优点和缺点"><!---->1.2 MQ的优点和缺点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_1-3-各种mq产品的比较"><!---->1.3 各种MQ产品的比较<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-1-准备工作"><!---->2.1 准备工作<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-1-1-下载rocketmq"><!---->2.1.1 下载RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-2-2-环境要求"><!---->2.2.2 环境要求<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-2-安装rocketmq"><!---->2.2 安装RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-2-1-安装步骤"><!---->2.2.1 安装步骤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-2-2-目录介绍"><!---->2.2.2 目录介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-3-启动rocketmq"><!---->2.3 启动RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-4-测试rocketmq"><!---->2.4 测试RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-4-1-发送消息"><!---->2.4.1 发送消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-4-2-接收消息"><!---->2.4.2 接收消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-5-关闭rocketmq"><!---->2.5 关闭RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-6-基于docker方式搭建rocketmq"><!---->2.6 基于Docker方式搭建RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-6-1-去https-hub-docker-com-搜索docker镜像"><!---->2.6.1 去https://hub.docker.com 搜索Docker镜像<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_2-6-2-基于5-1-0版本构建"><!---->2.6.2 基于5.1.0版本构建<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3、创建topic"><!---->3、创建Topic<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4、安装rocketmq-console"><!---->4、安装rocketmq-console<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-1-各角色介绍"><!---->3.1 各角色介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-2-集群搭建方式"><!---->3.2 集群搭建方式<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-2-1-集群特点"><!---->3.2.1 集群特点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-2-3-集群模式"><!---->3.2.3 集群模式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-双主双从集群搭建"><!---->3.3 双主双从集群搭建<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-1-总体架构"><!---->3.3.1 总体架构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-2-集群工作流程"><!---->3.3.2 集群工作流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-3-服务器环境"><!---->3.3.3 服务器环境<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-4-host添加信息"><!---->3.3.4 Host添加信息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-5-防火墙配置"><!---->3.3.5 防火墙配置<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-6-环境变量配置"><!---->3.3.6 环境变量配置<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-7-创建消息存储路径"><!---->3.3.7 创建消息存储路径<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-8-broker配置文件"><!---->3.3.8 broker配置文件<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-9-修改启动脚本文件"><!---->3.3.9 修改启动脚本文件<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-10-服务启动"><!---->3.3.10 服务启动<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-11-查看进程状态"><!---->3.3.11 查看进程状态<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-3-12-查看日志"><!---->3.3.12 查看日志<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-4-mqadmin管理工具"><!---->3.4 mqadmin管理工具<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-4-1-使用方式"><!---->3.4.1 使用方式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-4-2-命令介绍"><!---->3.4.2 命令介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-4-3-注意事项"><!---->3.4.3 注意事项<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-5-集群监控平台搭建"><!---->3.5 集群监控平台搭建<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-5-1-概述"><!---->3.5.1 概述<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_3-5-2-下载并编译打包"><!---->3.5.2 下载并编译打包<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-1-基本样例"><!---->4.1 基本样例<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-1-1-消息发送"><!---->4.1.1 消息发送<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-1-2-消费消息"><!---->4.1.2 消费消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-1-3-工具类的封装"><!---->4.1.3 工具类的封装<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-2-顺序消息"><!---->4.2 顺序消息<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-2-1-顺序消息生产"><!---->4.2.1 顺序消息生产<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-2-2-顺序消费消息"><!---->4.2.2 顺序消费消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-3-延时消息"><!---->4.3 延时消息<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-3-1-启动消息消费者"><!---->4.3.1 启动消息消费者<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-3-2-发送延时消息"><!---->4.3.2 发送延时消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-3-3-验证"><!---->4.3.3 验证<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-3-4-使用限制"><!---->4.3.4 使用限制<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-4-批量消息"><!---->4.4 批量消息<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-4-1-发送批量消息"><!---->4.4.1 发送批量消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-5-过滤消息"><!---->4.5 过滤消息<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-5-1-sql基本语法"><!---->4.5.1 SQL基本语法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-5-2-消息生产者"><!---->4.5.2 消息生产者<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-5-3-消息消费者"><!---->4.5.3 消息消费者<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-6-事务消息"><!---->4.6 事务消息<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-6-1-流程分析"><!---->4.6.1 流程分析<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-6-2-发送事务消息"><!---->4.6.2 发送事务消息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/middleware/mq/rocketmq/RocketMQ-01.html#_4-6-3-使用限制"><!---->4.6.3 使用限制<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/mq/rocketmq/RocketMQ-02.html"><!---->二、RocketMQ入门第二天<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/mq/rocketmq/RocketMQ-03.html"><!---->三、RocketMQ入门第三天<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-mq" style=""></span><span class="vp-sidebar-title">kafka</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-es" style=""></span><span class="vp-sidebar-title">分布式搜索es</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-nacos" style=""></span><span class="vp-sidebar-title">配置中心和注册中心nacos</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-seata" style=""></span><span class="vp-sidebar-title">分布式事务seata</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-sentinel" style=""></span><span class="vp-sidebar-title">服务监控和保护sentinel</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-dubbo" style=""></span><span class="vp-sidebar-title">阿里微服务调用中心dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-zookeeper" style=""></span><span class="vp-sidebar-title">注册中心zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-distributed" style=""></span><span class="vp-sidebar-title">分布式</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-tool" style=""></span><span class="vp-sidebar-title">容器与开发工具</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-project" style=""></span><span class="vp-sidebar-title">项目</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-vue" style=""></span><span class="vp-sidebar-title">前端技术</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-note" style=""></span><span class="vp-sidebar-title">其他</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->一、RocketMQ入门第一天</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">liuyangfang</span></span><span property="author" content="liuyangfang"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-06T09:49:10.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 72 分钟</span><meta property="timeRequired" content="PT72M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category5 clickable" role="navigation">中间件</span><span class="page-category-item category0 clickable" role="navigation">mq</span><span class="page-category-item category0 clickable" role="navigation">阿里</span><span class="page-category-item category0 clickable" role="navigation">RocketMQ</span><!--]--><meta property="articleSection" content="中间件,mq,阿里,RocketMQ"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag5 clickable" role="navigation">中间件</span><span class="page-tag-item tag0 clickable" role="navigation">mq</span><span class="page-tag-item tag0 clickable" role="navigation">阿里</span><span class="page-tag-item tag0 clickable" role="navigation">RocketMQ</span><!--]--><meta property="keywords" content="中间件,mq,阿里,RocketMQ"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_1-1-为什么要用mq">1.1 为什么要用MQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_1-2-mq的优点和缺点">1.2 MQ的优点和缺点</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_1-3-各种mq产品的比较">1.3 各种MQ产品的比较</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_2-1-准备工作">2.1 准备工作</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-1-1-下载rocketmq">2.1.1 下载RocketMQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-2-2-环境要求">2.2.2 环境要求</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_2-2-安装rocketmq">2.2 安装RocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-2-1-安装步骤">2.2.1 安装步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-2-2-目录介绍">2.2.2 目录介绍</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_2-3-启动rocketmq">2.3 启动RocketMQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_2-4-测试rocketmq">2.4 测试RocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-4-1-发送消息">2.4.1 发送消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-4-2-接收消息">2.4.2 接收消息</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_2-5-关闭rocketmq">2.5 关闭RocketMQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_2-6-基于docker方式搭建rocketmq">2.6 基于Docker方式搭建RocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-6-1-去https-hub-docker-com-搜索docker镜像">2.6.1 去https://hub.docker.com 搜索Docker镜像</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_2-6-2-基于5-1-0版本构建">2.6.2 基于5.1.0版本构建</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3、创建topic">3、创建Topic</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4、安装rocketmq-console">4、安装rocketmq-console</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_3-1-各角色介绍">3.1 各角色介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_3-2-集群搭建方式">3.2 集群搭建方式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-2-1-集群特点">3.2.1 集群特点</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-2-3-集群模式">3.2.3 集群模式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_3-3-双主双从集群搭建">3.3 双主双从集群搭建</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-1-总体架构">3.3.1 总体架构</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-2-集群工作流程">3.3.2 集群工作流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-3-服务器环境">3.3.3 服务器环境</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-4-host添加信息">3.3.4 Host添加信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-5-防火墙配置">3.3.5 防火墙配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-6-环境变量配置">3.3.6 环境变量配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-7-创建消息存储路径">3.3.7 创建消息存储路径</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-8-broker配置文件">3.3.8 broker配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-9-修改启动脚本文件">3.3.9 修改启动脚本文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-10-服务启动">3.3.10 服务启动</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-11-查看进程状态">3.3.11 查看进程状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-3-12-查看日志">3.3.12 查看日志</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_3-4-mqadmin管理工具">3.4 mqadmin管理工具</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-4-1-使用方式">3.4.1 使用方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-4-2-命令介绍">3.4.2 命令介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-4-3-注意事项">3.4.3 注意事项</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_3-5-集群监控平台搭建">3.5 集群监控平台搭建</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-5-1-概述">3.5.1 概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_3-5-2-下载并编译打包">3.5.2 下载并编译打包</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_4-1-基本样例">4.1 基本样例</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-1-1-消息发送">4.1.1 消息发送</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-1-2-消费消息">4.1.2 消费消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-1-3-工具类的封装">4.1.3 工具类的封装</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_4-2-顺序消息">4.2 顺序消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-2-1-顺序消息生产">4.2.1 顺序消息生产</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-2-2-顺序消费消息">4.2.2 顺序消费消息</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_4-3-延时消息">4.3 延时消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-3-1-启动消息消费者">4.3.1 启动消息消费者</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-3-2-发送延时消息">4.3.2 发送延时消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-3-3-验证">4.3.3 验证</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-3-4-使用限制">4.3.4 使用限制</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_4-4-批量消息">4.4 批量消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-4-1-发送批量消息">4.4.1 发送批量消息</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_4-5-过滤消息">4.5 过滤消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-5-1-sql基本语法">4.5.1 SQL基本语法</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-5-2-消息生产者">4.5.2 消息生产者</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-5-3-消息消费者">4.5.3 消息消费者</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#_4-6-事务消息">4.6 事务消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-6-1-流程分析">4.6.1 流程分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-6-2-发送事务消息">4.6.2 发送事务消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#_4-6-3-使用限制">4.6.3 使用限制</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="_1-mq介绍" tabindex="-1"><a class="header-anchor" href="#_1-mq介绍" aria-hidden="true">#</a> 1. MQ介绍</h1><h2 id="_1-1-为什么要用mq" tabindex="-1"><a class="header-anchor" href="#_1-1-为什么要用mq" aria-hidden="true">#</a> 1.1 为什么要用MQ</h2><p>消息队列是一种“先进先出”的数据结构</p><figure><img src="/assets/queue1-4098ec8b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>其应用场景主要包含以下3个方面</p><ul><li>应用解耦</li></ul><p>系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。</p><figure><img src="/assets/解耦1-a5463bfc.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>使用消息队列解耦合，系统的耦合性就会提高了。比如物流系统发生故障，需要几分钟才能来修复，在这段时间内，物流系统要处理的数据被缓存到消息队列中，用户的下单操作正常完成。当物流系统回复后，补充处理存在消息队列中的订单消息即可，终端系统感知不到物流系统发生过几分钟故障。</p><figure><img src="/assets/解耦2-2b52c87b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>流量削峰</li></ul><figure><img src="/assets/mq-5-2bf10c8f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>应用系统如果遇到系统请求流量的瞬间猛增，有可能会将系统压垮。有了消息队列可以将大量请求缓存起来，分散到很长一段时间处理，这样可以大大提到系统的稳定性和用户体验。</p><figure><img src="/assets/mq-6-348f4851.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>一般情况，为了保证系统的稳定性，如果系统负载超过阈值，就会阻止用户请求，这会影响用户体验，而如果使用消息队列将请求缓存起来，等待系统处理完毕后通知用户下单完毕，这样总不能下单体验要好。</p><p><u>处于经济考量目的：</u></p><p>业务系统正常时段的QPS如果是1000，流量最高峰是10000，为了应对流量高峰配置高性能的服务器显然不划算，这时可以使用消息队列对峰值流量削峰</p><ul><li>数据分发</li></ul><figure><img src="/assets/mq-1-93d512df.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>通过消息队列可以让数据在多个系统更加之间进行流通。数据的产生方不需要关心谁来使用数据，只需要将数据发送到消息队列，数据使用方直接在消息队列中直接获取数据即可</p><figure><img src="/assets/mq-2-50f6aa1e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_1-2-mq的优点和缺点" tabindex="-1"><a class="header-anchor" href="#_1-2-mq的优点和缺点" aria-hidden="true">#</a> 1.2 MQ的优点和缺点</h2><p>优点：解耦、削峰、数据分发</p><p>缺点包含以下几点：</p><ul><li><p>系统可用性降低</p><p>系统引入的外部依赖越多，系统稳定性越差。一旦MQ宕机，就会对业务造成影响。</p><p>如何保证MQ的高可用？</p></li><li><p>系统复杂度提高</p><p>MQ的加入大大增加了系统的复杂度，以前系统间是同步的远程调用，现在是通过MQ进行异步调用。</p><p>如何保证消息没有被重复消费？怎么处理消息丢失情况？那么保证消息传递的顺序性？</p></li><li><p>一致性问题</p><p>A系统处理完业务，通过MQ给B、C、D三个系统发消息数据，如果B系统、C系统处理成功，D系统处理失败。</p><p>如何保证消息数据处理的一致性？</p></li></ul><h2 id="_1-3-各种mq产品的比较" tabindex="-1"><a class="header-anchor" href="#_1-3-各种mq产品的比较" aria-hidden="true">#</a> 1.3 各种MQ产品的比较</h2><p>常见的MQ产品包括Kafka、ActiveMQ、RabbitMQ、RocketMQ。</p><figure><img src="/assets/MQ比较-4974f098.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="_2-rocketmq快速入门" tabindex="-1"><a class="header-anchor" href="#_2-rocketmq快速入门" aria-hidden="true">#</a> 2. RocketMQ快速入门</h1><p>RocketMQ是阿里巴巴2016年MQ中间件，使用Java语言开发，在阿里内部，RocketMQ承接了例如“双11”等高并发场景的消息流转，能够处理万亿级别的消息。</p><h2 id="_2-1-准备工作" tabindex="-1"><a class="header-anchor" href="#_2-1-准备工作" aria-hidden="true">#</a> 2.1 准备工作</h2><h3 id="_2-1-1-下载rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-1-1-下载rocketmq" aria-hidden="true">#</a> 2.1.1 下载RocketMQ</h3><p>RocketMQ最新版本：4.5.1</p><p><a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip" target="_blank" rel="noopener noreferrer">下载地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_2-2-2-环境要求" tabindex="-1"><a class="header-anchor" href="#_2-2-2-环境要求" aria-hidden="true">#</a> 2.2.2 环境要求</h3><ul><li><p>Linux64位系统</p></li><li><p>JDK1.8(64位)</p></li><li><p>源码安装需要安装Maven 3.2.x</p></li></ul><h2 id="_2-2-安装rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-2-安装rocketmq" aria-hidden="true">#</a> 2.2 安装RocketMQ</h2><h3 id="_2-2-1-安装步骤" tabindex="-1"><a class="header-anchor" href="#_2-2-1-安装步骤" aria-hidden="true">#</a> 2.2.1 安装步骤</h3><p>本教程以二进制包方式安装</p><ol><li>解压安装包</li><li>进入安装目录</li></ol><h3 id="_2-2-2-目录介绍" tabindex="-1"><a class="header-anchor" href="#_2-2-2-目录介绍" aria-hidden="true">#</a> 2.2.2 目录介绍</h3><ul><li>bin：启动脚本，包括shell脚本和CMD脚本</li><li>conf：实例配置文件 ，包括broker配置文件、logback配置文件等</li><li>lib：依赖jar包，包括Netty、commons-lang、FastJSON等</li></ul><h2 id="_2-3-启动rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-3-启动rocketmq" aria-hidden="true">#</a> 2.3 启动RocketMQ</h2><ol><li>启动NameServer</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.启动NameServer</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&amp;</span>
<span class="token comment"># 2.查看启动日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/logs/rocketmqlogs/namesrv.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>启动Broker</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.启动Broker</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqbroker <span class="token parameter variable">-n</span> localhost:9876 <span class="token operator">&amp;</span>
<span class="token comment"># 2.查看启动日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/logs/rocketmqlogs/broker.log 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>问题描述：</p><p>RocketMQ默认的虚拟机内存较大，启动Broker如果因为内存不足失败，需要编辑如下两个配置文件，修改JVM内存大小</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 编辑runbroker.sh和runserver.sh修改默认JVM大小</span>
<span class="token function">vi</span> runbroker.sh
<span class="token function">vi</span> runserver.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>参考设置：</li></ul><p><code>JAVA_OPT=&quot;${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</code></p><h2 id="_2-4-测试rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-4-测试rocketmq" aria-hidden="true">#</a> 2.4 测试RocketMQ</h2><h3 id="_2-4-1-发送消息" tabindex="-1"><a class="header-anchor" href="#_2-4-1-发送消息" aria-hidden="true">#</a> 2.4.1 发送消息</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.设置环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token comment"># 2.使用安装包的Demo发送消息</span>
<span class="token function">sh</span> bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-2-接收消息" tabindex="-1"><a class="header-anchor" href="#_2-4-2-接收消息" aria-hidden="true">#</a> 2.4.2 接收消息</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.设置环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token comment"># 2.接收消息</span>
<span class="token function">sh</span> bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-5-关闭rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-5-关闭rocketmq" aria-hidden="true">#</a> 2.5 关闭RocketMQ</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.关闭NameServer</span>
<span class="token function">sh</span> bin/mqshutdown namesrv
<span class="token comment"># 2.关闭Broker</span>
<span class="token function">sh</span> bin/mqshutdown broker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-6-基于docker方式搭建rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-6-基于docker方式搭建rocketmq" aria-hidden="true">#</a> 2.6 基于Docker方式搭建RocketMQ</h2><h3 id="_2-6-1-去https-hub-docker-com-搜索docker镜像" tabindex="-1"><a class="header-anchor" href="#_2-6-1-去https-hub-docker-com-搜索docker镜像" aria-hidden="true">#</a> 2.6.1 去<code>https://hub.docker.com</code> 搜索Docker镜像</h3><p><a href="https://hub.docker.com/r/apache/rocketmq/tags" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/apache/rocketmq/tags<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_2-6-2-基于5-1-0版本构建" tabindex="-1"><a class="header-anchor" href="#_2-6-2-基于5-1-0版本构建" aria-hidden="true">#</a> 2.6.2 基于5.1.0版本构建</h3><h4 id="_1、拉取镜像" tabindex="-1"><a class="header-anchor" href="#_1、拉取镜像" aria-hidden="true">#</a> 1、拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull apache/rocketmq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2、启动服务" tabindex="-1"><a class="header-anchor" href="#_2、启动服务" aria-hidden="true">#</a> 2、启动服务</h4><p>RocketMQ需要启动两个服务：namesrv和broker</p><h5 id="_2-1、启动namesrc服务" tabindex="-1"><a class="header-anchor" href="#_2-1、启动namesrc服务" aria-hidden="true">#</a> 2.1、启动namesrc服务</h5><h6 id="_2-1-1-创建目录" tabindex="-1"><a class="header-anchor" href="#_2-1-1-创建目录" aria-hidden="true">#</a> 2.1.1 创建目录</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/rocketmq/namesrv/logs
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/rocketmq/namesrv/store
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /data/rocketmq/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-1-2-启动容器" tabindex="-1"><a class="header-anchor" href="#_2-1-2-启动容器" aria-hidden="true">#</a> 2.1.2 启动容器</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">--name</span> rmqnamesrv <span class="token parameter variable">-p</span> <span class="token number">9876</span>:9876 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /data/rocketmq/namesrv/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /data/rocketmq/namesrv/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;MAX_POSSIBLE_HEAP=100000000&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m&quot;</span> <span class="token punctuation">\</span>
apache/rocketmq <span class="token function">sh</span> mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-1-3-参数含义" tabindex="-1"><a class="header-anchor" href="#_2-1-3-参数含义" aria-hidden="true">#</a> 2.1.3 参数含义</h6><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-d</code></td><td>以守护进程的方式启动</td></tr><tr><td><code>--restart=always</code></td><td>docker重启时候容器自动重启</td></tr><tr><td><code>--name rmqnamesrv</code></td><td>把容器的名字设置为rmqnamesrv</td></tr><tr><td><code>-p 9876:9876</code></td><td>把容器内的端口9876挂载到宿主机9876上面</td></tr><tr><td><code>-v /data/rocketmq/namesrv/logs:/root/logs</code></td><td>把容器内的<code>/root/logs</code>日志目录挂载到宿主机的 <code>/data/rocketmq/namesrv/logs</code></td></tr><tr><td><code>-v /data/rocketmq/namesrv/store:/root/store</code></td><td>把容器内的/root/store数据存储目录挂载到宿主机的 <code>/data/rocketmq/namesrv/store</code></td></tr><tr><td>rmqnamesrv</td><td>容器的名字</td></tr><tr><td>-e “MAX_POSSIBLE_HEAP=100000000”</td><td>设置容器的最大堆内存为100000000</td></tr><tr><td>rocket/rocketmq</td><td>使用的镜像名称</td></tr><tr><td>sh mqnamesrv</td><td>启动namesrv服务</td></tr></tbody></table><h5 id="_2-2、启动broker服务" tabindex="-1"><a class="header-anchor" href="#_2-2、启动broker服务" aria-hidden="true">#</a> 2.2、启动broker服务</h5><h6 id="_2-2-1-创建目录" tabindex="-1"><a class="header-anchor" href="#_2-2-1-创建目录" aria-hidden="true">#</a> 2.2.1 创建目录</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span>  /data/rocketmq/broker/logs   /data/rocketmq/broker/store /data/rocketmq/conf
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /data/rocketmq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-2-2-创建文件" tabindex="-1"><a class="header-anchor" href="#_2-2-2-创建文件" aria-hidden="true">#</a> 2.2.2 创建文件</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /data/rocketmq/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将内容放入broker.conf文件中</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 所属集群名称，如果节点较多可以配置多个</span>
<span class="token key attr-name">brokerClusterName</span> <span class="token punctuation">=</span> <span class="token value attr-value">DefaultCluster</span>
<span class="token comment">#broker名称，master和slave使用相同的名称，表明他们的主从关系</span>
<span class="token key attr-name">brokerName</span> <span class="token punctuation">=</span> <span class="token value attr-value">broker-a</span>
<span class="token comment">#0表示Master，大于0表示不同的slave</span>
<span class="token key attr-name">brokerId</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token comment">#表示几点做消息删除动作，默认是凌晨4点</span>
<span class="token key attr-name">deleteWhen</span> <span class="token punctuation">=</span> <span class="token value attr-value">04</span>
<span class="token comment">#在磁盘上保留消息的时长，单位是小时</span>
<span class="token key attr-name">fileReservedTime</span> <span class="token punctuation">=</span> <span class="token value attr-value">48</span>
<span class="token comment">#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；</span>
<span class="token key attr-name">brokerRole</span> <span class="token punctuation">=</span> <span class="token value attr-value">ASYNC_MASTER</span>
<span class="token comment">#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；</span>
<span class="token key attr-name">flushDiskType</span> <span class="token punctuation">=</span> <span class="token value attr-value">ASYNC_FLUSH</span>
<span class="token comment"># 设置broker节点所在服务器的内网ip地址即可</span>
<span class="token key attr-name">brokerIP1</span> <span class="token punctuation">=</span> <span class="token value attr-value">192.168.125.135</span>
<span class="token comment"># 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full</span>
<span class="token key attr-name">diskMaxUsedSpaceRatio</span><span class="token punctuation">=</span><span class="token value attr-value">95</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：配置文件这个ip后面千万不能有空格，否则就会在客户端发送<a href="https://so.csdn.net/so/search?q=mq&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">mq<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>时连接不上topic</p><p>报错：No route info of this topic, kxm</p><figure><img src="/assets/image-20230406103940931-de6b9031.png" alt="image-20230406103940931" tabindex="0" loading="lazy"><figcaption>image-20230406103940931</figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span>  <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker <span class="token punctuation">\</span>
<span class="token parameter variable">--link</span> rmqnamesrv:namesrv <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10911</span>:10911 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10909</span>:10909 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span>  /data/rocketmq/broker/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span>  /data/rocketmq/broker/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span>  /data/rocketmq/conf/broker.conf:/opt/rocketmq-4.9.4/conf/broker.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;NAMESRV_ADDR=namesrv:9876&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;MAX_POSSIBLE_HEAP=200000000&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;autoCreateTopicEnable=true&quot;</span> <span class="token punctuation">\</span>
apache/rocketmq <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /opt/rocketmq-4.9.4/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-2-3-参数说明" tabindex="-1"><a class="header-anchor" href="#_2-2-3-参数说明" aria-hidden="true">#</a> 2.2.3 参数说明</h6><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>--link rmqnamesrv:namesrv</td><td>和rmqnamesrv容器通信</td></tr><tr><td>-p 10911:10911</td><td>把容器的非vip通道端口挂载到宿主机</td></tr><tr><td>-p 10909:10909</td><td>把容器的vip通道端口挂载到宿主机</td></tr><tr><td>-e “NAMESRV_ADDR=namesrv:9876”</td><td>指定namesrv的地址为本机namesrv的ip地址:9876</td></tr><tr><td>sh mqbroker -c /opt/rocketmq-4.9.4/conf/broker.conf</td><td>指定配置文件启动broker节点</td></tr><tr><td>-e &quot;JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m&quot;</td><td>设置启动内存大小</td></tr><tr><td>autoCreateTopicEnable=true</td><td>自动创建主题</td></tr></tbody></table><h6 id="_2-2-4-opt-rocketmq-4-9-4-conf-broker-conf-这个中的rocketmq的4-9-4版本是如何确定的-从这里看" tabindex="-1"><a class="header-anchor" href="#_2-2-4-opt-rocketmq-4-9-4-conf-broker-conf-这个中的rocketmq的4-9-4版本是如何确定的-从这里看" aria-hidden="true">#</a> 2.2.4 <code>/opt/rocketmq-4.9.4/conf/broker.conf</code> 这个中的rocketmq的4.9.4版本是如何确定的，从这里看</h6><figure><img src="/assets/image-20230406105210337-6f4a642f.png" alt="image-20230406105210337" tabindex="0" loading="lazy"><figcaption>image-20230406105210337</figcaption></figure><figure><img src="/assets/image-20230406105253117-40dc93f0.png" alt="image-20230406105253117" tabindex="0" loading="lazy"><figcaption>image-20230406105253117</figcaption></figure><h5 id="_2-3-开放端口号" tabindex="-1"><a class="header-anchor" href="#_2-3-开放端口号" aria-hidden="true">#</a> 2.3 开放端口号</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">9876</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">10911</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">10909</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
firewall-cmd <span class="token parameter variable">--permanent</span> --list-port
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、创建topic" tabindex="-1"><a class="header-anchor" href="#_3、创建topic" aria-hidden="true">#</a> 3、创建Topic</h3><figure><img src="/assets/image-20230406105613268-6571d308.png" alt="image-20230406105613268" tabindex="0" loading="lazy"><figcaption>image-20230406105613268</figcaption></figure><p>使用docker ps 查看rocketmq broker容器</p><p>使用 <code>docker exec -it rmqbroker /bin/bash</code> 进入容器中 （rmqbroker 是容器名字，参见上图）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rmqbroker /bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>容器中，使用 <code>sh mqadmin topicList -n 内网ip:9876</code> 查看存在的topic</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> mqadmin topicList <span class="token parameter variable">-n</span> <span class="token number">192.168</span>.125.135:9876
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406103940931-de6b9031.png" alt="image-20230406103940931" tabindex="0" loading="lazy"><figcaption>image-20230406103940931</figcaption></figure><p><strong>结果</strong></p><figure><img src="/assets/image-20230406105910540-cbe66b94.png" alt="image-20230406105910540" tabindex="0" loading="lazy"><figcaption>image-20230406105910540</figcaption></figure><p>创建topic , 内网ip 替换成自己的ip ， topicname替换成自己的topic名字</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> mqadmin updateTopic <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:10911 <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9876 <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>topicname<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> mqadmin updateTopic <span class="token parameter variable">-b</span> <span class="token number">192.168</span>.125.135:10911 <span class="token parameter variable">-n</span> <span class="token number">192.168</span>.125.135:9876 <span class="token parameter variable">-t</span> my_test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406110350759-c29a63da.png" alt="image-20230406110350759" tabindex="0" loading="lazy"><figcaption>image-20230406110350759</figcaption></figure><p><strong>安装成功</strong></p><h3 id="_4、安装rocketmq-console" tabindex="-1"><a class="header-anchor" href="#_4、安装rocketmq-console" aria-hidden="true">#</a> 4、安装<code>rocketmq-console</code></h3><h4 id="_4-1-拉取镜像" tabindex="-1"><a class="header-anchor" href="#_4-1-拉取镜像" aria-hidden="true">#</a> 4.1 拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull styletang/rocketmq-console-ng
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_4-2-安装" tabindex="-1"><a class="header-anchor" href="#_4-2-安装" aria-hidden="true">#</a> 4.2 安装</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmq-console <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.125.135:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8888</span>:8080 <span class="token punctuation">\</span>
styletang/rocketmq-console-ng

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-开放端口号" tabindex="-1"><a class="header-anchor" href="#_4-3-开放端口号" aria-hidden="true">#</a> 4.3 开放端口号</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8888</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
firewall-cmd <span class="token parameter variable">--permanent</span> --list-port
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-安装成功" tabindex="-1"><a class="header-anchor" href="#_4-4-安装成功" aria-hidden="true">#</a> 4.4 安装成功</h4><figure><img src="/assets/image-20230406111821130-10637cc2.png" alt="image-20230406111821130" tabindex="0" loading="lazy"><figcaption>image-20230406111821130</figcaption></figure><h1 id="_3-rocketmq集群搭建" tabindex="-1"><a class="header-anchor" href="#_3-rocketmq集群搭建" aria-hidden="true">#</a> 3. RocketMQ集群搭建</h1><h2 id="_3-1-各角色介绍" tabindex="-1"><a class="header-anchor" href="#_3-1-各角色介绍" aria-hidden="true">#</a> 3.1 各角色介绍</h2><ul><li>Producer：消息的发送者；举例：发信者</li><li>Consumer：消息接收者；举例：收信者</li><li>Broker：暂存和传输消息；举例：邮局</li><li>NameServer：管理Broker；举例：各个邮局的管理机构</li><li>Topic：区分消息的种类；一个发送者可以发送消息给一个或者多个Topic；一个消息的接收者可以订阅一个或者多个Topic消息</li><li>Message Queue：相当于是Topic的分区；用于并行发送和接收消息</li></ul><figure><img src="/assets/RocketMQ角色-b8eca656.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_3-2-集群搭建方式" tabindex="-1"><a class="header-anchor" href="#_3-2-集群搭建方式" aria-hidden="true">#</a> 3.2 集群搭建方式</h2><h3 id="_3-2-1-集群特点" tabindex="-1"><a class="header-anchor" href="#_3-2-1-集群特点" aria-hidden="true">#</a> 3.2.1 集群特点</h3><ul><li><p>NameServer是一个几乎无状态节点，可集群部署，节点之间无任何信息同步。</p></li><li><p>Broker部署相对复杂，Broker分为Master与Slave，一个Master可以对应多个Slave，但是一个Slave只能对应一个Master，Master与Slave的对应关系通过指定相同的BrokerName，不同的BrokerId来定义，BrokerId为0表示Master，非0表示Slave。Master也可以部署多个。每个Broker与NameServer集群中的所有节点建立长连接，定时注册Topic信息到所有NameServer。</p></li><li><p>Producer与NameServer集群中的其中一个节点（随机选择）建立长连接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master建立长连接，且定时向Master发送心跳。Producer完全无状态，可集群部署。</p></li><li><p>Consumer与NameServer集群中的其中一个节点（随机选择）建立长连接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master、Slave建立长连接，且定时向Master、Slave发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅消息，订阅规则由Broker配置决定。</p></li></ul><h3 id="_3-2-3-集群模式" tabindex="-1"><a class="header-anchor" href="#_3-2-3-集群模式" aria-hidden="true">#</a> 3.2.3 集群模式</h3><h4 id="_1-单master模式" tabindex="-1"><a class="header-anchor" href="#_1-单master模式" aria-hidden="true">#</a> 1）单Master模式</h4><p>这种方式风险较大，一旦Broker重启或者宕机时，会导致整个服务不可用。不建议线上环境使用,可以用于本地测试。</p><h4 id="_2-多master模式" tabindex="-1"><a class="header-anchor" href="#_2-多master模式" aria-hidden="true">#</a> 2）多Master模式</h4><p>一个集群无Slave，全是Master，例如2个Master或者3个Master，这种模式的优缺点如下：</p><ul><li>优点：配置简单，单个Master宕机或重启维护对应用无影响，在磁盘配置为RAID10时，即使机器宕机不可恢复情况下，由于RAID10磁盘非常可靠，消息也不会丢（异步刷盘丢失少量消息，同步刷盘一条不丢），性能最高；</li><li>缺点：单台机器宕机期间，这台机器上未被消费的消息在机器恢复之前不可订阅，消息实时性会受到影响。</li></ul><h4 id="_3-多master多slave模式-异步" tabindex="-1"><a class="header-anchor" href="#_3-多master多slave模式-异步" aria-hidden="true">#</a> 3）多Master多Slave模式（异步）</h4><p>每个Master配置一个Slave，有多对Master-Slave，HA采用异步复制方式，主备有短暂消息延迟（毫秒级），这种模式的优缺点如下：</p><ul><li>优点：即使磁盘损坏，消息丢失的非常少，且消息实时性不会受影响，同时Master宕机后，消费者仍然可以从Slave消费，而且此过程对应用透明，不需要人工干预，性能同多Master模式几乎一样；</li><li>缺点：Master宕机，磁盘损坏情况下会丢失少量消息。</li></ul><h4 id="_4-多master多slave模式-同步" tabindex="-1"><a class="header-anchor" href="#_4-多master多slave模式-同步" aria-hidden="true">#</a> 4）多Master多Slave模式（同步）</h4><p>每个Master配置一个Slave，有多对Master-Slave，HA采用同步双写方式，即只有主备都写成功，才向应用返回成功，这种模式的优缺点如下：</p><ul><li>优点：数据与服务都无单点故障，Master宕机情况下，消息无延迟，服务可用性与数据可用性都非常高；</li><li>缺点：性能比异步复制模式略低（大约低10%左右），发送单个消息的RT会略高，且目前版本在主节点宕机后，备机不能自动切换为主机。</li></ul><h2 id="_3-3-双主双从集群搭建" tabindex="-1"><a class="header-anchor" href="#_3-3-双主双从集群搭建" aria-hidden="true">#</a> 3.3 双主双从集群搭建</h2><h3 id="_3-3-1-总体架构" tabindex="-1"><a class="header-anchor" href="#_3-3-1-总体架构" aria-hidden="true">#</a> 3.3.1 总体架构</h3><p>消息高可用采用2m-2s（同步双写）方式</p><figure><img src="/assets/RocketMQ集群-54d90065.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-3-2-集群工作流程" tabindex="-1"><a class="header-anchor" href="#_3-3-2-集群工作流程" aria-hidden="true">#</a> 3.3.2 集群工作流程</h3><ol><li>启动NameServer，NameServer起来后监听端口，等待Broker、Producer、Consumer连上来，相当于一个路由控制中心。</li><li>Broker启动，跟所有的NameServer保持长连接，定时发送心跳包。心跳包中包含当前Broker信息(IP+端口等)以及存储所有Topic信息。注册成功后，NameServer集群中就有Topic跟Broker的映射关系。</li><li>收发消息前，先创建Topic，创建Topic时需要指定该Topic要存储在哪些Broker上，也可以在发送消息时自动创建Topic。</li><li>Producer发送消息，启动时先跟NameServer集群中的其中一台建立长连接，并从NameServer中获取当前发送的Topic存在哪些Broker上，轮询从队列列表中选择一个队列，然后与队列所在的Broker建立长连接从而向Broker发消息。</li><li>Consumer跟Producer类似，跟其中一台NameServer建立长连接，获取当前订阅Topic存在哪些Broker上，然后直接跟Broker建立连接通道，开始消费消息。</li></ol><h3 id="_3-3-3-服务器环境" tabindex="-1"><a class="header-anchor" href="#_3-3-3-服务器环境" aria-hidden="true">#</a> 3.3.3 服务器环境</h3><table><thead><tr><th><strong>序号</strong></th><th><strong>IP</strong></th><th><strong>角色</strong></th><th><strong>架构模式</strong></th></tr></thead><tbody><tr><td>1</td><td>192.168.25.135</td><td>nameserver、brokerserver</td><td>Master1、Slave2</td></tr><tr><td>2</td><td>192.168.25.138</td><td>nameserver、brokerserver</td><td>Master2、Slave1</td></tr></tbody></table><h3 id="_3-3-4-host添加信息" tabindex="-1"><a class="header-anchor" href="#_3-3-4-host添加信息" aria-hidden="true">#</a> 3.3.4 Host添加信息</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置如下:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameserver</span>
<span class="token number">192.168</span>.25.135 rocketmq-nameserver1
<span class="token number">192.168</span>.25.138 rocketmq-nameserver2
<span class="token comment"># broker</span>
<span class="token number">192.168</span>.25.135 rocketmq-master1
<span class="token number">192.168</span>.25.135 rocketmq-slave2
<span class="token number">192.168</span>.25.138 rocketmq-master2
<span class="token number">192.168</span>.25.138 rocketmq-slave1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后, 重启网卡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-5-防火墙配置" tabindex="-1"><a class="header-anchor" href="#_3-3-5-防火墙配置" aria-hidden="true">#</a> 3.3.5 防火墙配置</h3><p>宿主机需要远程访问虚拟机的rocketmq服务和web服务，需要开放相关的端口号，简单粗暴的方式是直接关闭防火墙</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 关闭防火墙</span>
systemctl stop firewalld.service 
<span class="token comment"># 查看防火墙的状态</span>
firewall-cmd <span class="token parameter variable">--state</span> 
<span class="token comment"># 禁止firewall开机启动</span>
systemctl disable firewalld.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者为了安全，只开放特定的端口号，RocketMQ默认使用3个端口：9876 、10911 、11011 。如果防火墙没有关闭的话，那么防火墙就必须开放这些端口：</p><ul><li><code>nameserver</code> 默认使用 9876 端口</li><li><code>master</code> 默认使用 10911 端口</li><li><code>slave</code> 默认使用11011 端口</li></ul><p>执行以下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 开放name server默认端口</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">9876</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 开放master默认端口</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">10911</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 开放slave默认端口 (当前集群模式可不开启)</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">11011</span>/tcp <span class="token parameter variable">--permanent</span> 
<span class="token comment"># 重启防火墙</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-6-环境变量配置" tabindex="-1"><a class="header-anchor" href="#_3-3-6-环境变量配置" aria-hidden="true">#</a> 3.3.6 环境变量配置</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在profile文件的末尾加入如下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#set rocketmq</span>
<span class="token assign-left variable">ROCKETMQ_HOME</span><span class="token operator">=</span>/usr/local/rocketmq/rocketmq-all-4.4.0-bin-release
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ROCKETMQ_HOME</span>/bin
<span class="token builtin class-name">export</span> ROCKETMQ_HOME <span class="token environment constant">PATH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输入:wq! 保存并退出， 并使得配置立刻生效：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-7-创建消息存储路径" tabindex="-1"><a class="header-anchor" href="#_3-3-7-创建消息存储路径" aria-hidden="true">#</a> 3.3.7 创建消息存储路径</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /usr/local/rocketmq/store
<span class="token function">mkdir</span> /usr/local/rocketmq/store/commitlog
<span class="token function">mkdir</span> /usr/local/rocketmq/store/consumequeue
<span class="token function">mkdir</span> /usr/local/rocketmq/store/index
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-8-broker配置文件" tabindex="-1"><a class="header-anchor" href="#_3-3-8-broker配置文件" aria-hidden="true">#</a> 3.3.8 broker配置文件</h3><h4 id="_1-master1" tabindex="-1"><a class="header-anchor" href="#_1-master1" aria-hidden="true">#</a> 1）master1</h4><p>服务器：192.168.25.135</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-a.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-a
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SYNC_MASTER
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>SYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-slave2" tabindex="-1"><a class="header-anchor" href="#_2-slave2" aria-hidden="true">#</a> 2）slave2</h4><p>服务器：192.168.25.135</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-b-s.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-b
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11011</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SLAVE
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>ASYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-master2" tabindex="-1"><a class="header-anchor" href="#_3-master2" aria-hidden="true">#</a> 3）master2</h4><p>服务器：192.168.25.138</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-b.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-b
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SYNC_MASTER
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>SYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-slave1" tabindex="-1"><a class="header-anchor" href="#_4-slave1" aria-hidden="true">#</a> 4）slave1</h4><p>服务器：192.168.25.138</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-a-s.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-a
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11011</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SLAVE
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>ASYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-9-修改启动脚本文件" tabindex="-1"><a class="header-anchor" href="#_3-3-9-修改启动脚本文件" aria-hidden="true">#</a> 3.3.9 修改启动脚本文件</h3><h4 id="_1-runbroker-sh" tabindex="-1"><a class="header-anchor" href="#_1-runbroker-sh" aria-hidden="true">#</a> 1）<a href="http://runbroker.sh" target="_blank" rel="noopener noreferrer">runbroker.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/local/rocketmq/bin/runbroker.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>需要根据内存大小进行适当的对JVM参数进行调整：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#===================================================</span>
<span class="token comment"># 开发环境配置 JVM Configuration</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms256m -Xmx256m -Xmn128m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>####2）<a href="http://runserver.sh" target="_blank" rel="noopener noreferrer">runserver.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /usr/local/rocketmq/bin/runserver.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-10-服务启动" tabindex="-1"><a class="header-anchor" href="#_3-3-10-服务启动" aria-hidden="true">#</a> 3.3.10 服务启动</h3><h4 id="_1-启动nameserve集群" tabindex="-1"><a class="header-anchor" href="#_1-启动nameserve集群" aria-hidden="true">#</a> 1）启动NameServe集群</h4><p>分别在192.168.25.135和192.168.25.138启动NameServer</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqnamesrv <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-启动broker集群" tabindex="-1"><a class="header-anchor" href="#_2-启动broker集群" aria-hidden="true">#</a> 2）启动Broker集群</h4><ul><li>在192.168.25.135上启动master1和slave2</li></ul><p>master1：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-syncbroker-a.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>slave2：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-sync/broker-b-s.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在192.168.25.138上启动master2和slave2</li></ul><p>master2</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-sync/broker-b.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>slave1</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-sync/broker-a-s.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-11-查看进程状态" tabindex="-1"><a class="header-anchor" href="#_3-3-11-查看进程状态" aria-hidden="true">#</a> 3.3.11 查看进程状态</h3><p>启动后通过JPS查看启动进程</p><figure><img src="/assets/jps1-83850453.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-3-12-查看日志" tabindex="-1"><a class="header-anchor" href="#_3-3-12-查看日志" aria-hidden="true">#</a> 3.3.12 查看日志</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看nameServer日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-500f</span> ~/logs/rocketmqlogs/namesrv.log
<span class="token comment"># 查看broker日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-500f</span> ~/logs/rocketmqlogs/broker.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-4-mqadmin管理工具" tabindex="-1"><a class="header-anchor" href="#_3-4-mqadmin管理工具" aria-hidden="true">#</a> 3.4 mqadmin管理工具</h2><h3 id="_3-4-1-使用方式" tabindex="-1"><a class="header-anchor" href="#_3-4-1-使用方式" aria-hidden="true">#</a> 3.4.1 使用方式</h3><p>进入RocketMQ安装位置，在bin目录下执行<code>./mqadmin {command} {args}</code></p><h3 id="_3-4-2-命令介绍" tabindex="-1"><a class="header-anchor" href="#_3-4-2-命令介绍" aria-hidden="true">#</a> 3.4.2 命令介绍</h3><h4 id="_1-topic相关" tabindex="-1"><a class="header-anchor" href="#_1-topic相关" aria-hidden="true">#</a> 1）Topic相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="132" style="height:99.0pt;"><td rowspan="8" height="593" class="xl68" width="163" style="border-bottom:1.0pt;height:444.0pt;border-top:none;width:122pt;">updateTopic</td><td rowspan="8" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">创建更新Topic配置</td><td class="xl65" width="149" style="width:112pt;">-b</td><td class="xl66" width="159" style="width:119pt;">Broker 地址，表示 topic 所在 Broker，只支持单台Broker，地址为ip:port</td></tr><tr height="132" style="height:99.0pt;"><td height="132" class="xl65" width="149" style="height:99.0pt;width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">cluster 名称，表示 topic 所在集群（集群可通过 clusterList 查询）</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h-</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer服务地址，格式 ip:port</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl65" width="149" style="height:57.0pt;width:112pt;">-p</td><td class="xl66" width="159" style="width:119pt;">指定新topic的读写权限( W=2|R=4|WR=6 )</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-r</td><td class="xl66" width="159" style="width:119pt;">可读队列数（默认为 8）</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-w</td><td class="xl66" width="159" style="width:119pt;">可写队列数（默认为 8）</td></tr><tr height="95" style="height:71.0pt;"><td height="95" class="xl65" width="149" style="height:71.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称（名称只能使用字符 ^[a-zA-Z0-9_-]+$ ）</td></tr><tr height="132" style="height:99.0pt;"><td rowspan="4" height="307" class="xl68" width="163" style="border-bottom:1.0pt;height:230.0pt;border-top:none;width:122pt;">deleteTopic</td><td rowspan="4" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">删除Topic</td><td class="xl65" width="149" style="width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">cluster 名称，表示删除某集群下的某个 topic （集群 可通过 clusterList 查询）</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="95" style="height:71.0pt;"><td height="95" class="xl65" width="149" style="height:71.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称（名称只能使用字符 ^[a-zA-Z0-9_-]+$ ）</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="287" class="xl68" width="163" style="border-bottom:1.0pt;height:215.0pt;border-top:none;width:122pt;">topicList</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 列表信息</td><td class="xl65" width="149" style="width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="207" style="height:155.0pt;"><td height="207" class="xl65" width="149" style="height:155.0pt;width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">不配置-c只返回topic列表，增加-c返回clusterName, topic, consumerGroup信息，即topic的所属集群和订阅关系，没有参数</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" class="xl68" width="163" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicRoute</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 路由信息</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" class="xl68" width="163" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicStatus</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 消息队列offset</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" class="xl68" width="163" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicClusterList</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 所在集群列表</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="6" height="518" class="xl68" width="163" style="border-bottom:1.0pt;height:380pt;border-top:none;width:122pt;">updateTopicPerm</td><td rowspan="6" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">更新 Topic 读写权限</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="132" style="height:99.0pt;"><td height="132" class="xl65" width="149" style="height:99.0pt;width:112pt;">-b</td><td class="xl66" width="159" style="width:119pt;">Broker 地址，表示 topic 所在 Broker，只支持单台Broker，地址为ip:port</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl65" width="149" style="height:57.0pt;width:112pt;">-p</td><td class="xl66" width="159" style="width:119pt;">指定新 topic 的读写权限( W=2|R=4|WR=6 )</td></tr><tr height="207" style="height:155.0pt;"><td height="207" class="xl65" width="149" style="height:155.0pt;width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">cluster 名称，表示 topic 所在集群（集群可通过 clusterList 查询），-b优先，如果没有-b，则对集群中所有Broker执行命令</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="5" height="199" class="xl68" width="163" style="border-bottom:1.0pt;height:149.0pt;border-top:none;width:122pt;">updateOrderConf</td><td rowspan="5" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">从NameServer上创建、删除、获取特定命名空间的kv配置，目前还未启用</td><td class="xl65" width="149" style="width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic，键</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-v</td><td class="xl66" width="159" style="width:119pt;">orderConf，值</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-m</td><td class="xl66" width="159" style="width:119pt;">method，可选get、put、delete</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="198" class="xl68" width="163" style="border-bottom:1.0pt;height:140pt;border-top:none;width:122pt;">allocateMQ</td><td rowspan="4" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">以平均负载算法计算消费者列表负载消息队列的负载结果</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="95" style="height:71.0pt;"><td height="95" class="xl65" width="149" style="height:71.0pt;width:112pt;">-i</td><td class="xl66" width="159" style="width:119pt;">ipList，用逗号分隔，计算这些ip去负载Topic的消息队列</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="142" class="xl68" width="163" style="border-bottom:1.0pt solid black;height:106.0pt;border-top:1.0pt;width:122pt;">statsAll</td><td rowspan="4" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">打印Topic订阅关系、TPS、积累量、24h读写总量等信息</td><td class="xl65" width="149" style="width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-a</td><td class="xl66" width="159" style="width:119pt;">是否只打印活跃topic</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">指定topic</td></tr></table> #### 2）集群相关 <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="207" style="height:155.0pt;"><td rowspan="4" height="326" class="xl67" width="177" style="border-bottom:1.0pt;height:244.0pt;border-top:none;width:133pt;"><span style="mso-spacerun:yes;"></span>clusterList</td><td rowspan="4" class="xl70" width="175" style="border-bottom:1.0pt;border-top:none;width:131pt;">查看集群信息，集群、BrokerName、BrokerId、TPS等信息</td><td class="xl65" width="177" style="width:133pt;">-m</td><td class="xl66" width="185" style="width:139pt;">打印更多信息 (增加打印出如下信息 #InTotalYest, #OutTotalYest, #InTotalToday ,#OutTotalToday)</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="177" style="height:17.0pt;width:133pt;">-h</td><td class="xl66" width="185" style="width:139pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="177" style="height:43.0pt;width:133pt;">-n</td><td class="xl66" width="185" style="width:139pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-i</td><td class="xl66" width="185" style="width:139pt;">打印间隔，单位秒</td></tr><tr height="95" style="height:71.0pt;"><td rowspan="8" height="391" class="xl67" width="177" style="border-bottom:1.0pt;height:292.0pt;border-top:none;width:133pt;">clusterRT</td><td rowspan="8" class="xl70" width="175" style="border-bottom:1.0pt;border-top:none;width:131pt;">发送消息检测集群各Broker RT。消息发往${BrokerName} Topic。</td><td class="xl65" width="177" style="width:133pt;">-a</td><td class="xl66" width="185" style="width:139pt;">amount，每次探测的总数，RT = 总时间 / amount</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-s</td><td class="xl66" width="185" style="width:139pt;">消息大小，单位B</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="177" style="height:17.0pt;width:133pt;">-c</td><td class="xl66" width="185" style="width:139pt;">探测哪个集群</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl65" width="177" style="height:57.0pt;width:133pt;">-p</td><td class="xl66" width="185" style="width:139pt;">是否打印格式化日志，以|分割，默认不打印</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="177" style="height:17.0pt;width:133pt;">-h</td><td class="xl66" width="185" style="width:139pt;">打印帮助</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-m</td><td class="xl66" width="185" style="width:139pt;">所属机房，打印使用</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-i</td><td class="xl66" width="185" style="width:139pt;">发送间隔，单位秒</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="177" style="height:43.0pt;width:133pt;">-n</td><td class="xl66" width="185" style="width:139pt;">NameServer 服务地址，格式 ip:port</td></tr></table><p>####3）Broker相关</p><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="6" height="206" class="xl69" width="191" style="border-bottom:1.0pt;height:154.0pt;border-top:none;width:143pt;">updateBrokerConfig</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">更新 Broker 配置文件，会修改Broker.conf</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，格式为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">cluster 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl68" width="87" style="width:65pt;">key 值</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-v</td><td class="xl68" width="87" style="width:65pt;">value 值</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="3" height="137" class="xl69" width="191" style="border-bottom:1.0pt;height:103.0pt;border-top:none;width:143pt;">brokerStatus</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">查看 Broker 统计信息、运行状态（你想要的信息几乎都在里面）</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="6" height="256" class="xl69" width="191" style="border-bottom:1.0pt;height:192.0pt;border-top:none;width:143pt;">brokerConsumeStats</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">Broker中各个消费者的消费情况，按Message Queue维度返回Consume Offset，Broker Offset，Diff，TImestamp等信息</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">请求超时时间</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-l</td><td class="xl68" width="87" style="width:65pt;">diff阈值，超过阈值才打印</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">是否为顺序topic，一般为false</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="2" height="114" class="xl69" width="191" style="border-bottom:1.0pt;height:86.0pt;border-top:none;width:143pt;">getBrokerConfig</td><td rowspan="2" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">获取Broker配置</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="3" height="137" class="xl69" width="191" style="border-bottom:1.0pt;height:103.0pt;border-top:none;width:143pt;">wipeWritePerm</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">从NameServer上清除 Broker写权限</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="4" height="160" class="xl69" width="191" style="border-bottom:1.0pt;height:120.0pt;border-top:none;width:143pt;">cleanExpiredCQ</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">清理Broker上过期的Consume Queue，如果手动减少对列数可能产生过期队列</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="88" style="mso-height-source:userset;height:66.0pt;"><td rowspan="4" height="191" class="xl69" width="191" style="border-bottom:1.0pt;height:143.0pt;border-top:none;width:143pt;">cleanUnusedTopic</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">清理Broker上不使用的Topic，从内存中释放Topic的Consume Queue，如果手动删除Topic会产生不使用的Topic</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="5" height="199" class="xl69" width="191" style="border-bottom:1.0pt;height:149.0pt;border-top:none;width:143pt;">sendMsgStatus</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">向Broker发消息，返回发送状态和RT</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">BrokerName，注意不同于Broker地址</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">消息大小，单位B</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">发送次数</td></tr></table> #### 4）消息相关 <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="128" style="height:96.0pt;"><td rowspan="3" height="208" class="xl69" width="87" style="border-bottom:1.0pt;height:156.0pt;border-top:none;width:65pt;">queryMsgById</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据offsetMsgId查询msg，如果使用开源控制台，应使用offsetMsgId，此命令还有其他参数，具体作用请阅读QueryMsgByIdSubCommand。</td><td class="xl67" width="87" style="width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">msgId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="126" class="xl69" width="87" style="border-bottom:1.0pt;height:94.0pt;border-top:none;width:65pt;">queryMsgByKey</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据消息 Key 查询消息</td><td class="xl67" width="87" style="width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">msgKey</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">Topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="225" style="height:169.0pt;"><td rowspan="6" height="390" class="xl69" width="87" style="border-bottom:1.0pt;height:292.0pt;border-top:none;width:65pt;">queryMsgByOffset</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据 Offset 查询消息</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 名称，（这里需要注意 填写的是 Broker 的名称，不是 Broker 的地址，Broker 名称可以在 clusterList 查到）</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-i</td><td class="xl68" width="87" style="width:65pt;">query 队列 id</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">offset 值</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="47"><td rowspan="6" height="209" class="xl69" width="87" style="border-bottom:1.0pt;height:156.0pt;border-top:none;width:65pt;">queryMsgByUniqueKey</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据msgId查询，msgId不同于offsetMsgId，区别详见常见运维问题。-g，-d配合使用，查到消息后尝试让特定的消费者消费消息并返回消费结果</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">uniqe msg id</td></tr><tr height="36" style="height:27.0pt;"><td height="36" class="xl67" width="87" style="height:27.0pt;width:65pt;">-g</td><td class="xl67" width="87" style="width:65pt;">consumerGroup</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-d</td><td class="xl67" width="87" style="width:65pt;">clientId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="5" height="149" class="xl69" width="87" style="border-bottom:1.0pt
  height:111.0pt;border-top:none;width:65pt;">checkMsgSendRT</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">检测向topic发消息的RT，功能类似clusterRT</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-a</td><td class="xl68" width="87" style="width:65pt;">探测次数</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">消息大小</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="8" height="218" class="xl69" width="87" style="border-bottom:1.0pt;height:162.0pt;border-top:none;width:65pt;">sendMessage</td><td rowspan="8" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">发送一条消息，可以根据配置发往特定Message Queue，或普通发送。</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-p</td><td class="xl68" width="87" style="width:65pt;">body，消息体</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">keys</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl67" width="87" style="width:65pt;">tags</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl67" width="87" style="width:65pt;">BrokerName</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">queueId</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="10" height="312" class="xl69" width="87" style="border-bottom:1.0pt;height:232.0pt;border-top:none;width:65pt;">consumeMessage</td><td rowspan="10" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">消费消息。可以根据offset、开始&amp;结束时间戳、消息队列消费消息，配置不同执行不同消费逻辑，详见ConsumeMessageCommand。</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl67" width="87" style="width:65pt;">BrokerName</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">从offset开始消费</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">queueId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">开始时间戳，格式详见-h</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">结束时间戳</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">消费多少条消息</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="8" height="282" class="xl69" width="87" style="border-bottom:1.0pt;height:210.0pt;border-top:none;width:65pt;">printMsg</td><td rowspan="8" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">从Broker消费消息并打印，可选时间段</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">字符集，例如UTF-8</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">subExpress，过滤表达式</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">开始时间戳，格式参见-h</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-e</td><td class="xl68" width="87" style="width:65pt;">结束时间戳</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">是否打印消息体</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="12" height="390" class="xl69" width="87" style="border-bottom:1.0pt;height:290.0pt;border-top:none;width:65pt;">printMsgByQueue</td><td rowspan="12" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">类似printMsg，但指定Message Queue</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">queueId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-a</td><td class="xl67" width="87" style="width:65pt;">BrokerName</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">字符集，例如UTF-8</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">subExpress，过滤表达式</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">开始时间戳，格式参见-h</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-e</td><td class="xl68" width="87" style="width:65pt;">结束时间戳</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-p</td><td class="xl68" width="87" style="width:65pt;">是否打印消息</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">是否打印消息体</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-f</td><td class="xl68" width="87" style="width:65pt;">是否统计tag数量并打印</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="7" height="410" class="xl69" width="87" style="border-bottom:1.0pt;height:307.0pt;border-top:none;width:65pt;">resetOffsetByTime</td><td rowspan="7" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">按时间戳重置offset，Broker和consumer都会重置</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">重置为此时间戳对应的offset</td></tr><tr height="188" style="height:141.0pt;"><td height="188" class="xl67" width="87" style="height:141.0pt;width:65pt;">-f</td><td class="xl68" width="87" style="width:65pt;">是否强制重置，如果false，只支持回溯offset，如果true，不管时间戳对应offset与consumeOffset关系</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">是否重置c++客户端offset</td></tr></table><h4 id="_5-消费者、消费组相关" tabindex="-1"><a class="header-anchor" href="#_5-消费者、消费组相关" aria-hidden="true">#</a> 5）消费者、消费组相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="4" height="158" class="xl69" width="87" style="border-bottom:1.0pt;height:110pt;border-top:none;width:65pt;">consumerProgress</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">查看订阅组消费状态，可以查看具体的client IP的消息积累量</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者所属组名</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">是否打印client IP</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="105" style="mso-height-source:userset;height:79.0pt;"><td rowspan="5" height="260" class="xl69" width="87" style="border-bottom:1.0pt;height:195.0pt;border-top:none;width:65pt;">consumerStatus</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">查看消费者状态，包括同一个分组中是否都是相同的订阅，分析Process Queue是否堆积，返回消费者jstack结果，内容较多，使用者参见ConsumerStatusSubCommand</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="36" style="height:27.0pt;"><td height="36" class="xl67" width="87" style="height:27.0pt;width:65pt;">-g</td><td class="xl67" width="87" style="width:65pt;">consumer group</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">clientId</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">是否执行jstack</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="5" height="181" class="xl69" width="87" style="border-bottom:1.0pt
  height:135.0pt;border-top:none;width:65pt;">getConsumerStatus</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">获取 Consumer 消费进度</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者所属组名</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">查询主题</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-i</td><td class="xl68" width="87" style="width:65pt;">Consumer 客户端 ip</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="13" height="761" class="xl69" width="87" style="border-bottom:1.0pt
  height:569.0pt;border-top:none;width:65pt;">updateSubGroup</td><td rowspan="13" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">更新或创建订阅关系</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker地址</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">分组是否允许消费</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-m</td><td class="xl68" width="87" style="width:65pt;">是否从最小offset开始消费</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">是否是广播模式</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-q</td><td class="xl68" width="87" style="width:65pt;">重试队列数量</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-r</td><td class="xl68" width="87" style="width:65pt;">最大重试次数</td></tr><tr height="207" style="height:155.0pt;"><td height="207" class="xl67" width="87" style="height:155.0pt;width:65pt;">-i</td><td class="xl68" width="87" style="width:65pt;">当slaveReadEnable开启时有效，且还未达到从slave消费时建议从哪个BrokerId消费，可以配置备机id，主动从备机消费</td></tr><tr height="132" style="height:99.0pt;"><td height="132" class="xl67" width="87" style="height:99.0pt;width:65pt;">-w</td><td class="xl68" width="87" style="width:65pt;">如果Broker建议从slave消费，配置决定从哪个slave消费，配置BrokerId，例如1</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl67" width="87" style="height:57.0pt;width:65pt;">-a</td><td class="xl68" width="87" style="width:65pt;">当消费者数量变化时是否通知其他消费者负载均衡</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="5" height="165" class="xl69" width="87" style="border-bottom:1.0pt
  height:123.0pt;border-top:none;width:65pt;">deleteSubGroup</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">从Broker删除订阅关系</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker地址</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组名称</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="6" height="172" class="xl69" width="87" style="border-bottom:1.0pt
  height:120pt;border-top:none;width:65pt;">cloneGroupOffset</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">在目标群组中使用源群组的offset</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">源消费者组</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">目标消费者组</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">暂未使用</td></tr></table><h4 id="_6-连接相关" tabindex="-1"><a class="header-anchor" href="#_6-连接相关" aria-hidden="true">#</a> 6）连接相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="3" height="119" class="xl69" width="87" style="border-bottom:1.0pt
  height:89.0pt;border-top:none;width:65pt;">consumerConnec tion</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">查询 Consumer 的网络连接</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者所属组名</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="4" height="142" class="xl69" width="87" style="border-bottom:1.0pt
  height:106.0pt;border-top:none;width:65pt;">producerConnec tion</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">查询 Producer 的网络连接</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">生产者所属组名</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">主题名称</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr></table><h4 id="_7-nameserver相关" tabindex="-1"><a class="header-anchor" href="#_7-nameserver相关" aria-hidden="true">#</a> 7）NameServer相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="21" style="height:16.0pt;"><td rowspan="5" height="143" class="xl69" width="87" style="border-bottom:1.0pt
  height:100pt;border-top:none;width:65pt;">updateKvConfig</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">更新NameServer的kv配置，目前还未使用</td><td class="xl75" width="87" style="width:65pt;">-s</td><td class="xl76" width="87" style="width:65pt;">命名空间</td></tr><tr height="21" style="height:16.0pt;"><td height="21" class="xl75" width="87" style="height:16.0pt;width:65pt;">-k</td><td class="xl75" width="87" style="width:65pt;">key</td></tr><tr height="21" style="height:16.0pt;"><td height="21" class="xl75" width="87" style="height:16.0pt;width:65pt;">-v</td><td class="xl75" width="87" style="width:65pt;">value</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="126" class="xl69" width="87" style="border-bottom:1.0pt
  height:94.0pt;border-top:none;width:65pt;">deleteKvConfig</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">删除NameServer的kv配置</td><td class="xl67" width="87" style="width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">命名空间</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">key</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="2" height="80" class="xl69" width="87" style="border-bottom:1.0pt
  height:60.0pt;border-top:none;width:65pt;">getNamesrvConfig</td><td rowspan="2" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">获取NameServer配置</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="4" height="126" class="xl69" width="87" style="border-bottom:1.0pt
  height:94.0pt;border-top:none;width:65pt;">updateNamesrvConfig</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">修改NameServer配置</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">key</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-v</td><td class="xl67" width="87" style="width:65pt;">value</td></tr></table><h4 id="_8-其他" tabindex="-1"><a class="header-anchor" href="#_8-其他" aria-hidden="true">#</a> 8）其他</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="2" height="80" class="xl69" width="87" style="border-bottom:1.0pt
  height:60.0pt;border-top:none;width:65pt;">startMonitoring</td><td rowspan="2" class="xl71" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">开启监控进程，监控消息误删、重试队列消息数等</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr></table><h3 id="_3-4-3-注意事项" tabindex="-1"><a class="header-anchor" href="#_3-4-3-注意事项" aria-hidden="true">#</a> 3.4.3 注意事项</h3><ul><li>几乎所有命令都需要配置-n表示NameServer地址，格式为ip:port</li><li>几乎所有命令都可以通过-h获取帮助</li><li>如果既有Broker地址（-b）配置项又有clusterName（-c）配置项，则优先以Broker地址执行命令；如果不配置Broker地址，则对集群中所有主机执行命令</li></ul><h2 id="_3-5-集群监控平台搭建" tabindex="-1"><a class="header-anchor" href="#_3-5-集群监控平台搭建" aria-hidden="true">#</a> 3.5 集群监控平台搭建</h2><h3 id="_3-5-1-概述" tabindex="-1"><a class="header-anchor" href="#_3-5-1-概述" aria-hidden="true">#</a> 3.5.1 概述</h3><p><code>RocketMQ</code>有一个对其扩展的开源项目<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，这个项目中有一个子模块叫<code>rocketmq-console</code>，这个便是管理控制台项目了，先将<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>拉到本地，因为我们需要自己对<code>rocketmq-console</code>进行编译打包运行。</p><figure><img src="/assets/rocketmq-console-cb07b261.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-5-2-下载并编译打包" tabindex="-1"><a class="header-anchor" href="#_3-5-2-下载并编译打包" aria-hidden="true">#</a> 3.5.2 下载并编译打包</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/apache/rocketmq-externals
<span class="token builtin class-name">cd</span> rocketmq-console
mvn clean package <span class="token parameter variable">-Dmaven.test.skip</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：打包前在<code>rocketmq-console</code>中配置<code>namesrv</code>集群地址：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">rocketmq.config.namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.25.135:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.25.138:9876
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动rocketmq-console：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> rocketmq-console-ng-1.0.0.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动成功后，我们就可以通过浏览器访问<code>http://localhost:8080</code>进入控制台界面了，如下图：</p><figure><img src="/assets/rocketmq-console2-d823c2cb.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>集群状态：</p><figure><img src="/assets/rocketmq-console3-0d09acfe.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="_4-消息发送样例" tabindex="-1"><a class="header-anchor" href="#_4-消息发送样例" aria-hidden="true">#</a> 4. 消息发送样例</h1><ul><li>导入MQ客户端依赖</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-client --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>消息发送者步骤分析r</li></ul><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>1.创建消息生产者producer，并制定生产者组名
2.指定Nameserver地址
3.启动producer
4.创建消息对象，指定主题Topic、Tag和消息体
5.发送消息
6.关闭生产者producer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>消息消费者步骤分析</li></ul><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>1.创建消费者Consumer，制定消费者组名
2.指定Nameserver地址
3.订阅主题Topic和Tag
4.设置回调函数，处理消息
5.启动消费者consumer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-1-基本样例" tabindex="-1"><a class="header-anchor" href="#_4-1-基本样例" aria-hidden="true">#</a> 4.1 基本样例</h2><h3 id="_4-1-1-消息发送" tabindex="-1"><a class="header-anchor" href="#_4-1-1-消息发送" aria-hidden="true">#</a> 4.1.1 消息发送</h3><h4 id="_1-发送同步消息" tabindex="-1"><a class="header-anchor" href="#_1-发送同步消息" aria-hidden="true">#</a> 1）发送同步消息</h4><p>这种可靠性同步地发送方式使用的比较广泛，比如：重要的消息通知，短信通知。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
    	producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	    <span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
    	    <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
        	<span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
        	<span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送消息到一个Broker</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过sendResult返回消息是否成功送达</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-发送异步消息" tabindex="-1"><a class="header-anchor" href="#_2-发送异步消息" aria-hidden="true">#</a> 2）发送异步消息</h4><p>异步消息通常用在对响应时间敏感的业务场景，即发送端不能容忍长时间地等待Broker的响应。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
            	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID188&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// SendCallback接收异步返回结果的回调</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                            sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-单向发送消息" tabindex="-1"><a class="header-anchor" href="#_3-单向发送消息" aria-hidden="true">#</a> 3）单向发送消息</h4><p>这种方式主要用在不特别关心发送结果的场景，例如日志发送。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
        	<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送单向消息，没有任何返回结果</span>
        	producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-2-消费消息" tabindex="-1"><a class="header-anchor" href="#_4-1-2-消费消息" aria-hidden="true">#</a> 4.1.2 消费消息</h3><h4 id="_1-负载均衡模式" tabindex="-1"><a class="header-anchor" href="#_1-负载均衡模式" aria-hidden="true">#</a> 1）负载均衡模式</h4><p>消费者采用负载均衡方式消费消息，多个消费者共同消费队列消息，每个消费者处理的消息不同</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例化消息生产者,指定组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定Namesrv地址信息.</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 订阅Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//负载均衡模式消费</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                        <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> 
                              <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动消息者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-广播模式" tabindex="-1"><a class="header-anchor" href="#_2-广播模式" aria-hidden="true">#</a> 2）广播模式</h4><p>消费者采用广播的方式消费消息，每个消费者消费的消息都是相同的</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例化消息生产者,指定组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定Namesrv地址信息.</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 订阅Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//广播模式消费</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">BROADCASTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                        <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> 
                              <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动消息者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-3-工具类的封装" tabindex="-1"><a class="header-anchor" href="#_4-1-3-工具类的封装" aria-hidden="true">#</a> 4.1.3 工具类的封装</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>lyf<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQPushConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">MessageSelector</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>heartbeat<span class="token punctuation">.</span></span><span class="token class-name">MessageModel</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> lyf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@classname</span> RocketMqUtil
 * <span class="token keyword">@description</span>
 * <span class="token keyword">@date</span> 2023/4/6 16:27
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RocketMqUtil</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 私有构造器
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMqUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 创建生产者
     *
     * <span class="token keyword">@param</span> <span class="token parameter">producerConsumer</span> 传入的函数
     * <span class="token keyword">@param</span> <span class="token parameter">group</span>            消息组
     * <span class="token keyword">@param</span> <span class="token parameter">nameServerAddr</span>   NameServer的地址
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">MQClientException</span></span> MQClientException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createMqProducer</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DefaultMQProducer</span><span class="token punctuation">&gt;</span></span> producerConsumer<span class="token punctuation">,</span> <span class="token class-name">String</span> group<span class="token punctuation">,</span> <span class="token class-name">String</span> nameServerAddr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1 实例化消息的生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span>nameServerAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4 发送消息</span>
        producerConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>producer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5 释放资源</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 创建消费者
     *
     * <span class="token keyword">@param</span> <span class="token parameter">pushConsumer</span>  消费函数
     * <span class="token keyword">@param</span> <span class="token parameter">group</span>         消费者组
     * <span class="token keyword">@param</span> <span class="token parameter">nameServer</span>    NameServer地址
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>         主题
     * <span class="token keyword">@param</span> <span class="token parameter">subExpression</span> 订阅的标签
     * <span class="token keyword">@param</span> <span class="token parameter">messageModel</span>  消费模式，支持轮询和广播
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">MQClientException</span></span> MQClientException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createMqConsumer</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">&gt;</span></span> pushConsumer<span class="token punctuation">,</span>
                                        <span class="token class-name">String</span> group<span class="token punctuation">,</span>
                                        <span class="token class-name">String</span> nameServer<span class="token punctuation">,</span>
                                        <span class="token class-name">String</span> topic<span class="token punctuation">,</span>
                                        <span class="token class-name">MessageModel</span> messageModel<span class="token punctuation">,</span>
                                        <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> subExpression<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1 实例化消息生产者，指定组名</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2 指定Namesrv的地址信息</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span>nameServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3 订阅topic</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">MessageSelector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">MessageSelector</span><span class="token punctuation">)</span> subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> subExpression<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;subExpression 参数异常&quot;</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 4 设置消费模式</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span>messageModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4 消费消息</span>
        pushConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5 启动消费者</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;consumer started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-2-顺序消息" tabindex="-1"><a class="header-anchor" href="#_4-2-顺序消息" aria-hidden="true">#</a> 4.2 顺序消息</h2><p>消息有序指的是可以按照消息的发送顺序来消费(FIFO)。RocketMQ可以严格的保证消息有序，可以分为分区有序或者全局有序。</p><p>顺序消费的原理解析，在默认的情况下消息发送会采取Round Robin轮询方式把消息发送到不同的queue(分区队列)；而消费消息的时候从多个queue上拉取消息，这种情况发送和消费是不能保证顺序。但是如果控制发送的顺序消息只依次发送到同一个queue中，消费的时候只从这个queue上依次拉取，则就保证了顺序。当发送和消费参与的queue只有一个，则是全局有序；如果多个queue参与，则为分区有序，即相对每个queue，消息都是有序的。</p><p>下面用订单进行分区有序的示例。一个订单的顺序流程是：创建、付款、推送、完成。订单号相同的消息会被先后发送到同一个队列中，消费时，同一个OrderId获取到的肯定是同一个队列。</p><h3 id="_4-2-1-顺序消息生产" tabindex="-1"><a class="header-anchor" href="#_4-2-1-顺序消息生产" aria-hidden="true">#</a> 4.2.1 顺序消息生产</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* Producer，发送顺序消息
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

       <span class="token comment">// 订单列表</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> dateStr <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 加个时间前缀</span>
           <span class="token class-name">String</span> body <span class="token operator">=</span> dateStr <span class="token operator">+</span> <span class="token string">&quot; Hello RocketMQ &quot;</span> <span class="token operator">+</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token annotation punctuation">@Override</span>
               <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token class-name">Long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>  <span class="token comment">//根据订单id选择发送queue</span>
                   <span class="token keyword">long</span> index <span class="token operator">=</span> id <span class="token operator">%</span> mqs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">return</span> mqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//订单id</span>

           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SendResult status:%s, queueId:%d, body:%s&quot;</span><span class="token punctuation">,</span>
               sendResult<span class="token punctuation">.</span><span class="token function">getSendStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               sendResult<span class="token punctuation">.</span><span class="token function">getMessageQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * 订单的步骤
    */</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OrderStep</span> <span class="token punctuation">{</span>
       <span class="token keyword">private</span> <span class="token keyword">long</span> orderId<span class="token punctuation">;</span>
       <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

       <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> orderId<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token keyword">long</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>orderId <span class="token operator">=</span> orderId<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token string">&quot;OrderStep{&quot;</span> <span class="token operator">+</span>
               <span class="token string">&quot;orderId=&quot;</span> <span class="token operator">+</span> orderId <span class="token operator">+</span>
               <span class="token string">&quot;, desc=&#39;&quot;</span> <span class="token operator">+</span> desc <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
               <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * 生成模拟订单数据
    */</span>
   <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">OrderStep</span> orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;推送&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> orderList<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-2-顺序消费消息" tabindex="-1"><a class="header-anchor" href="#_4-2-2-顺序消费消息" aria-hidden="true">#</a> 4.2.2 顺序消费消息</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 顺序消息消费，带事务方式（应用可控制Offset什么时候提交）
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerInOrder</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> 
           <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token doc-comment comment">/**
        * 设置Consumer第一次启动是从队列头部开始消费还是队列尾部开始消费<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        * 如果非第一次启动，那么按照上次消费的位置继续消费
        */</span>
       consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span><span class="token constant">CONSUME_FROM_FIRST_OFFSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagA || TagC || TagD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerOrderly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

           <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeOrderlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               context<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token comment">// 可以看到每个queue有唯一的consume线程来消费, 订单对每个queue(分区)有序</span>
                   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumeThread=&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;queueId=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, content:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>

               <span class="token keyword">try</span> <span class="token punctuation">{</span>
                   <span class="token comment">//模拟业务逻辑处理中...</span>
                   <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-3-延时消息" tabindex="-1"><a class="header-anchor" href="#_4-3-延时消息" aria-hidden="true">#</a> 4.3 延时消息</h2><p>比如电商里，提交了一个订单就可以发送一个延时消息，1h后去检查这个订单的状态，如果还是未付款就取消订单释放库存。</p><h3 id="_4-3-1-启动消息消费者" tabindex="-1"><a class="header-anchor" href="#_4-3-1-启动消息消费者" aria-hidden="true">#</a> 4.3.1 启动消息消费者</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageConsumer</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实例化消费者</span>
      <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleConsumer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 订阅Topics</span>
      consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 注册消息监听者</span>
      consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@Override</span>
          <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// Print approximate delay time period</span>
                  <span class="token comment">// ps: 这里的getStoreTimestamp指的是存储的时间戳</span>
                  <span class="token comment">// 如果想看消息的初始时间戳的话，那么应该是getBornTimestamp</span>
                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Receive message[msgId=&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> message<span class="token punctuation">.</span><span class="token function">getStoreTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms later&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 启动消费者</span>
      consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-2-发送延时消息" tabindex="-1"><a class="header-anchor" href="#_4-3-2-发送延时消息" aria-hidden="true">#</a> 4.3.2 发送延时消息</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageProducer</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实例化一个生产者来产生延时消息</span>
      <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 启动生产者</span>
      producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello scheduled message &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 设置延时等级3,这个消息将在10s之后发送(现在只支持固定的几个时间,详看delayTimeLevel)</span>
          message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 发送消息</span>
          producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
       <span class="token comment">// 关闭生产者</span>
      producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-3-验证" tabindex="-1"><a class="header-anchor" href="#_4-3-3-验证" aria-hidden="true">#</a> 4.3.3 验证</h3><p>您将会看到消息的消费比存储时间晚10秒</p><h3 id="_4-3-4-使用限制" tabindex="-1"><a class="header-anchor" href="#_4-3-4-使用限制" aria-hidden="true">#</a> 4.3.4 使用限制</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// org/apache/rocketmq/store/config/MessageStoreConfig.java</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> messageDelayLevel <span class="token operator">=</span> <span class="token string">&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>现在RocketMq并不支持任意时间的延时，需要设置几个固定的延时等级，从1s到2h分别对应着等级1到18</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>RocketMQ5.0支持自定义时间的延迟时间</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDelayTimeSec</span><span class="token punctuation">(</span><span class="token keyword">long</span> sec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">putProperty</span><span class="token punctuation">(</span><span class="token class-name">MessageConst</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_TIMER_DELAY_SEC</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDelayTimeMs</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeMs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">putProperty</span><span class="token punctuation">(</span><span class="token class-name">MessageConst</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_TIMER_DELAY_MS</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>timeMs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="_4-4-批量消息" tabindex="-1"><a class="header-anchor" href="#_4-4-批量消息" aria-hidden="true">#</a> 4.4 批量消息</h2><p>批量发送消息能显著提高传递小消息的性能。限制是这些批量消息应该有相同的topic，相同的waitStoreMsgOK，而且不能是延时消息。此外，这一批消息的总大小不应超过4MB。</p><h3 id="_4-4-1-发送批量消息" tabindex="-1"><a class="header-anchor" href="#_4-4-1-发送批量消息" aria-hidden="true">#</a> 4.4.1 发送批量消息</h3><p>如果您每次只发送不超过4MB的消息，则很容易使用批处理，样例如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token string">&quot;BatchTest&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 0&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID002&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
   producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//处理error</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果消息的总长度可能大于4MB时，这时候最好把消息进行分割</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListSplitter</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SIZE_LIMIT</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">int</span> currIndex<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> messages<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span> 
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> currIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   	<span class="token annotation punctuation">@Override</span> 
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">int</span> nextIndex <span class="token operator">=</span> currIndex<span class="token punctuation">;</span>
       <span class="token keyword">int</span> totalSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> nextIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> nextIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Message</span> message <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">int</span> tmpSize <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
           <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               tmpSize <span class="token operator">+=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           tmpSize <span class="token operator">=</span> tmpSize <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 增加日志的开销20字节</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">&gt;</span> <span class="token constant">SIZE_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//单个消息超过了最大的限制</span>
               <span class="token comment">//忽略,否则会阻塞分裂的进程</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>nextIndex <span class="token operator">-</span> currIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">//假如下一个子列表没有元素,则添加这个子列表然后退出循环,否则只是退出循环</span>
                  nextIndex<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">+</span> totalSize <span class="token operator">&gt;</span> <span class="token constant">SIZE_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               totalSize <span class="token operator">+=</span> tmpSize<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>

       <span class="token punctuation">}</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> subList <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>currIndex<span class="token punctuation">,</span> nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
       currIndex <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
       <span class="token keyword">return</span> subList<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-1-1-如何使用" tabindex="-1"><a class="header-anchor" href="#_4-4-1-1-如何使用" aria-hidden="true">#</a> 4.4.1.1 如何使用</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//把大的消息分裂成若干个小的消息</span>
<span class="token class-name">ListSplitter</span> splitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>splitter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span>  listItem <span class="token operator">=</span> splitter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>listItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//处理error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-5-过滤消息" tabindex="-1"><a class="header-anchor" href="#_4-5-过滤消息" aria-hidden="true">#</a> 4.5 过滤消息</h2><p>在大多数情况下，TAG是一个简单而有用的设计，其可以来选择您想要的消息。例如：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;CID_EXAMPLE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TAGA || TAGB || TAGC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>消费者将接收包含TAGA或TAGB或TAGC的消息。但是限制是一个消息只能有一个标签，这对于复杂的场景可能不起作用。在这种情况下，可以使用SQL表达式筛选消息。SQL特性可以通过发送消息时的属性来进行计算。在RocketMQ定义的语法下，可以实现一些简单的逻辑。下面是一个例子：</p><div class="language-te line-numbers-mode" data-ext="te"><pre class="language-te"><code>------------
| message  |
|----------|  a &gt; 5 AND b = &#39;abc&#39;
| a = 10   |  --------------------&gt; Gotten
| b = &#39;abc&#39;|
| c = true |
------------
------------
| message  |
|----------|   a &gt; 5 AND b = &#39;abc&#39;
| a = 1    |  --------------------&gt; Missed
| b = &#39;abc&#39;|
| c = true |
------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-1-sql基本语法" tabindex="-1"><a class="header-anchor" href="#_4-5-1-sql基本语法" aria-hidden="true">#</a> 4.5.1 SQL基本语法</h3><p>RocketMQ只定义了一些基本语法来支持这个特性。你也可以很容易地扩展它。</p><ul><li>数值比较，比如：<strong>&gt;，&gt;=，&lt;，&lt;=，BETWEEN，=；</strong></li><li>字符比较，比如：<strong>=，&lt;&gt;，IN；</strong></li><li><strong>IS NULL</strong> 或者 <strong>IS NOT NULL；</strong></li><li>逻辑符号 <strong>AND，OR，NOT；</strong></li></ul><p>常量支持类型为：</p><ul><li>数值，比如：<strong>123，3.1415；</strong></li><li>字符，比如：<strong>&#39;abc&#39;，必须用单引号包裹起来；</strong></li><li><strong>NULL</strong>，特殊的常量</li><li>布尔值，<strong>TRUE</strong> 或 <strong>FALSE</strong></li></ul><p>只有使用push模式的消费者才能用使用SQL92标准的sql语句，接口如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span>finalString topic<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">MessageSelector</span> messageSelector<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-5-2-消息生产者" tabindex="-1"><a class="header-anchor" href="#_4-5-2-消息生产者" aria-hidden="true">#</a> 4.5.2 消息生产者</h3><p>发送消息时，你能通过<code>putUserProperty</code>来设置消息的属性</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
   tag<span class="token punctuation">,</span>
   <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置一些属性</span>
msg<span class="token punctuation">.</span><span class="token function">putUserProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-3-消息消费者" tabindex="-1"><a class="header-anchor" href="#_4-5-3-消息消费者" aria-hidden="true">#</a> 4.5.3 消息消费者</h3><p>用MessageSelector.bySql来使用sql筛选消息</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只有订阅的消息有这个属性a, a &gt;=0 and a &lt;= 3</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MessageSelector</span><span class="token punctuation">.</span><span class="token function">bySql</span><span class="token punctuation">(</span><span class="token string">&quot;a between 0 and 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-5-3-1-异常the-broker-does-not-support-consumer-to-filter-message-by-sql92" tabindex="-1"><a class="header-anchor" href="#_4-5-3-1-异常the-broker-does-not-support-consumer-to-filter-message-by-sql92" aria-hidden="true">#</a> 4.5.3.1 异常<code>The broker does not support consumer to filter message by SQL92</code></h4><div class="language-verilog line-numbers-mode" data-ext="verilog"><pre class="language-verilog"><code>Exception in thread <span class="token string">&quot;main&quot;</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>MQClientException<span class="token punctuation">:</span> CODE<span class="token punctuation">:</span> <span class="token number">1</span>  DESC<span class="token punctuation">:</span> The broker does <span class="token keyword">not</span> support consumer to filter message by SQL92
For more information<span class="token punctuation">,</span> please visit the url<span class="token punctuation">,</span> https<span class="token punctuation">:</span><span class="token comment">//rocketmq.apache.org/docs/bestPractice/06FAQ</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>MQClientAPIImpl<span class="token punctuation">.</span><span class="token function">checkClientInBroker</span><span class="token punctuation">(</span>MQClientAPIImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">2806</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>MQClientInstance<span class="token punctuation">.</span><span class="token function">checkClientInBroker</span><span class="token punctuation">(</span>MQClientInstance<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">443</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>DefaultMQPushConsumerImpl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>DefaultMQPushConsumerImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">989</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>DefaultMQPushConsumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>DefaultMQPushConsumer<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">737</span><span class="token punctuation">)</span>
	at cn<span class="token punctuation">.</span>lyf<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>RocketMqUtil<span class="token punctuation">.</span><span class="token function">createMqConsumer</span><span class="token punctuation">(</span>RocketMqUtil<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">88</span><span class="token punctuation">)</span>
	at cn<span class="token punctuation">.</span>lyf<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>FilterMessageDemo<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>FilterMessageDemo<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406175608649-9ebb5bfc.png" alt="image-20230406175608649" tabindex="0" loading="lazy"><figcaption>image-20230406175608649</figcaption></figure><h4 id="_4-5-3-2-解决办法" tabindex="-1"><a class="header-anchor" href="#_4-5-3-2-解决办法" aria-hidden="true">#</a> 4.5.3.2 解决办法</h4><h5 id="_1-编辑broker-conf文件" tabindex="-1"><a class="header-anchor" href="#_1-编辑broker-conf文件" aria-hidden="true">#</a> 1 编辑broker.conf文件</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /data/rocketmq/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-添加属性" tabindex="-1"><a class="header-anchor" href="#_2-添加属性" aria-hidden="true">#</a> 2 添加属性</h5><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 添加RocketMQ对SQL92的支持</span>
<span class="token key attr-name">enablePropertyFilter</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406180026145-80f91dab.png" alt="image-20230406180026145" tabindex="0" loading="lazy"><figcaption>image-20230406180026145</figcaption></figure><h5 id="_3-重启rocketmq" tabindex="-1"><a class="header-anchor" href="#_3-重启rocketmq" aria-hidden="true">#</a> 3 重启RocketMQ</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看当前运行容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
<span class="token comment"># 重启RocketMQ brocker</span>
<span class="token function">docker</span> restart rmqbroker

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-再次启动消费者" tabindex="-1"><a class="header-anchor" href="#_4-再次启动消费者" aria-hidden="true">#</a> 4 再次启动消费者</h5><figure><img src="/assets/image-20230406180229308-069c6d6c.png" alt="image-20230406180229308" tabindex="0" loading="lazy"><figcaption>image-20230406180229308</figcaption></figure><h2 id="_4-6-事务消息" tabindex="-1"><a class="header-anchor" href="#_4-6-事务消息" aria-hidden="true">#</a> 4.6 事务消息</h2><h3 id="_4-6-1-流程分析" tabindex="-1"><a class="header-anchor" href="#_4-6-1-流程分析" aria-hidden="true">#</a> 4.6.1 流程分析</h3><figure><img src="/assets/事务消息-af8dff93.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>上图说明了事务消息的大致方案，其中分为两个流程：正常事务消息的发送及提交、事务消息的补偿流程。</p><h4 id="_1-事务消息发送及提交" tabindex="-1"><a class="header-anchor" href="#_1-事务消息发送及提交" aria-hidden="true">#</a> 1）事务消息发送及提交</h4><p>(1) 发送消息（half消息）。</p><p>(2) 服务端响应消息写入结果。</p><p>(3) 根据发送结果执行本地事务（如果写入失败，此时half消息对业务不可见，本地逻辑不执行）。</p><p>(4) 根据本地事务状态执行Commit或者Rollback（Commit操作生成消息索引，消息对消费者可见）</p><h4 id="_2-事务补偿" tabindex="-1"><a class="header-anchor" href="#_2-事务补偿" aria-hidden="true">#</a> 2）事务补偿</h4><p>(1) 对没有Commit/Rollback的事务消息（pending状态的消息），从服务端发起一次“回查”</p><p>(2) Producer收到回查消息，检查回查消息对应的本地事务的状态</p><p>(3) 根据本地事务状态，重新Commit或者Rollback</p><p>其中，补偿阶段用于解决消息Commit或者Rollback发生超时或者失败的情况。</p><h4 id="_3-事务消息状态" tabindex="-1"><a class="header-anchor" href="#_3-事务消息状态" aria-hidden="true">#</a> 3）事务消息状态</h4><p>事务消息共有三种状态，提交状态、回滚状态、中间状态：</p><ul><li>TransactionStatus.CommitTransaction: 提交事务，它允许消费者消费此消息。</li><li>TransactionStatus.RollbackTransaction: 回滚事务，它代表该消息将被删除，不允许被消费。</li><li>TransactionStatus.Unknown: 中间状态，它代表需要检查消息队列来确定状态。</li></ul><h3 id="_4-6-2-发送事务消息" tabindex="-1"><a class="header-anchor" href="#_4-6-2-发送事务消息" aria-hidden="true">#</a> 4.6.2 发送事务消息</h3><h4 id="_1-创建事务性生产者" tabindex="-1"><a class="header-anchor" href="#_1-创建事务性生产者" aria-hidden="true">#</a> 1) 创建事务性生产者</h4><p>使用 <code>TransactionMQProducer</code>类创建生产者，并指定唯一的 <code>ProducerGroup</code>，就可以设置自定义线程池来处理这些检查请求。执行本地事务后、需要根据执行结果对消息队列进行回复。回传的事务状态在请参考前一节。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建事务监听器</span>
        <span class="token class-name">TransactionListener</span> transactionListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionListenerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建消息生产者</span>
        <span class="token class-name">TransactionMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;group6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.25.135:9876;192.168.25.138:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//生产者这是监听器</span>
        producer<span class="token punctuation">.</span><span class="token function">setTransactionListener</span><span class="token punctuation">(</span>transactionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//启动消息生产者</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TransactionTopic&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//producer.shutdown();</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-实现事务的监听接口" tabindex="-1"><a class="header-anchor" href="#_2-实现事务的监听接口" aria-hidden="true">#</a> 2）实现事务的监听接口</h4><p>当发送半消息成功时，我们使用 <code>executeLocalTransaction</code> 方法来执行本地事务。它返回前一节中提到的三个事务状态之一。<code>checkLocalTranscation</code> 方法用于检查本地事务状态，并回应消息队列的检查请求。它也是返回前一节中提到的三个事务状态之一。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransactionListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行本地事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQ检查消息Tag【&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;】的本地事务执行结果&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-3-使用限制" tabindex="-1"><a class="header-anchor" href="#_4-6-3-使用限制" aria-hidden="true">#</a> 4.6.3 使用限制</h3><ol><li>事务消息不支持延时消息和批量消息。</li><li>为了避免单个消息被检查太多次而导致半队列消息累积，我们默认将单个消息的检查次数限制为 15 次，但是用户可以通过 Broker 配置文件的 <code>transactionCheckMax</code>参数来修改此限制。如果已经检查某条消息超过 N 次的话（ N = <code>transactionCheckMax</code> ） 则 Broker 将丢弃此消息，并在默认情况下同时打印错误日志。用户可以通过重写 <code>AbstractTransactionCheckListener</code> 类来修改这个行为。</li><li>事务消息将在 Broker 配置文件中的参数 transactionMsgTimeout 这样的特定时间长度之后被检查。当发送事务消息时，用户还可以通过设置用户属性 CHECK_IMMUNITY_TIME_IN_SECONDS 来改变这个限制，该参数优先于 <code>transactionMsgTimeout</code> 参数。</li><li>事务性消息可能不止一次被检查或消费。</li><li>提交给用户的目标主题消息可能会失败，目前这依日志的记录而定。它的高可用性通过 RocketMQ 本身的高可用性机制来保证，如果希望确保事务消息不丢失、并且事务完整性得到保证，建议使用同步的双重写入机制。</li><li>事务消息的生产者 ID 不能与其他类型消息的生产者 ID 共享。与其他类型的消息不同，事务消息允许反向查询、MQ服务器能通过它们的生产者 ID 查询到消费者。</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/lyf110/lyf110.github.io/edit/main/docs/middleware/mq/rocketmq/RocketMQ-01.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><!----><a class="vp-link nav-link next" href="/middleware/mq/rocketmq/RocketMQ-02.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">二、RocketMQ入门第二天<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">主题 <a href="https://theme-hope.vuejs.press/zh/">vuepress-theme-hope</a> | Apache License 2.0 Licensed</div><div class="vp-copyright">Copyright © 2023-present liu yang fang</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-5f6064b2.js" defer></script>
  </body>
</html>
