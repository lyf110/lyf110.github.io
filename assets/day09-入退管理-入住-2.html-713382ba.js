import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e as t}from"./app-5f6064b2.js";const p="/assets/image-20240407192427942-277-b9477028.png",e="/assets/image-20240407192427942-278-ccced5af.png",o="/assets/image-20240407192427942-279-1bd8aa66.png",c="/assets/image-20240407192427942-280-f04cd755.png",i="/assets/image-20240407192427942-281-12c55c16.png",l="/assets/image-20240407192427942-282-e8493e20.png",u="/assets/image-20240407192427942-283-b4fe74b2.png",r="/assets/image-20240407192427943-284-05840a30.png",k="/assets/image-20240407192427947-285-af14f4da.png",d="/assets/image-20240407192427947-286-cb22217c.png",v="/assets/image-20240407192427947-287-a1920534.png",m="/assets/image-20240407192427947-288-ee36b352.png",b="/assets/image-20240407192427947-289-90695a87.png",g="/assets/image-20240407192427947-290-a3d471c9.png",y="/assets/image-20240407192427936-275-66bfe548.png",q={},f=t('<h1 id="协同-入住申请" tabindex="-1"><a class="header-anchor" href="#协同-入住申请" aria-hidden="true">#</a> 协同-入住申请</h1><h2 id="_1-目标" tabindex="-1"><a class="header-anchor" href="#_1-目标" aria-hidden="true">#</a> 1 目标</h2><p>在前一天中，我们已经对入住的整体业务分析完毕了，并且创建了对应的表结构，也开发了其中的一个接口，就是创建申请。今天我们会继续开发入住相关的接口。</p><p>今日的目标：</p><ul><li>独立完成查询我的待办和我的申请接口</li><li>独立完成入住表单详情查询</li><li>独立完成护理主管-评估接口</li><li>独立完成副院长审批中的同意和拒绝的接口开发</li></ul><h2 id="_2-接口分析" tabindex="-1"><a class="header-anchor" href="#_2-接口分析" aria-hidden="true">#</a> 2 接口分析</h2><p>由于接口过多，我们今天会开发5个接口，分别是</p><ul><li></li></ul><p>查询我的待办</p><ul><li></li></ul><p>入住表单查询</p><ul><li></li></ul><p>护理主管-评估老人健康</p><ul><li></li></ul><p>副院长-同意</p><ul><li></li></ul><p>副院长-拒绝</p><h3 id="_2-1-查询我的待办" tabindex="-1"><a class="header-anchor" href="#_2-1-查询我的待办" aria-hidden="true">#</a> 2.1 查询我的待办</h3><p><strong>原型图效果</strong>：</p><figure><img src="'+p+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>接口地址</strong>:<code>/pending_tasks/selectByPage</code></p><p><strong>请求方式</strong>:<code>POST</code></p><p><strong>请求示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;applicat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//申请人</span>
  <span class="token string-property property">&quot;applicatId&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//申请人id</span>
  <span class="token string-property property">&quot;applyStatus&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//申请状态</span>
  <span class="token string-property property">&quot;assigneeId&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//操作人</span>
  <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//申请单号</span>
  <span class="token string-property property">&quot;endTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//结束时间</span>
  <span class="token string-property property">&quot;isHandle&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//是否处理完成(0:未处理,1:已处理)</span>
  <span class="token string-property property">&quot;pageNum&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//当前页</span>
  <span class="token string-property property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//每页条数</span>
  <span class="token string-property property">&quot;reqType&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//请求类型(0:待办，1:我的申请)</span>
  <span class="token string-property property">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//开始时间</span>
  <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//流程状态（1：申请中，2:已完成，3:已关闭）</span>
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token comment">//单据类别（1：退住，2：请假，3：入住）</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>响应示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;records&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4ca81266-6f3f-11ee-94ed-5405db5be13e&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;checkInId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;applicat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;养老顾问&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;applicationTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-10-20 19:53:36&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RZ202310201953351&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;assigneeId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1671403256519078157&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;朱罡烈的入住申请&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-我的申请" tabindex="-1"><a class="header-anchor" href="#_2-2-我的申请" aria-hidden="true">#</a> 2.2 我的申请</h3><p><strong>接口地址</strong>:<code>/applications/selectByPage</code></p><p><strong>请求方式</strong>:<code>POST</code></p><p><strong>请求示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//单据编号</span>
  <span class="token string-property property">&quot;endTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//结束时间</span>
  <span class="token string-property property">&quot;pageNum&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//当前页码</span>
  <span class="token string-property property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//每页显示条数</span>
  <span class="token string-property property">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">//开始时间</span>
  <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//单据状态（申请中、已完成、已关闭）</span>
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">//单据类别</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>响应示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;records&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4ca81266-6f3f-11ee-94ed-5405db5be13e&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;checkInId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;applicat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;养老顾问&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;applicationTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-10-20 19:53:36&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RZ202310201953351&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;assigneeId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1671403256519078157&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;朱罡烈的入住申请&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-入住表单查询" tabindex="-1"><a class="header-anchor" href="#_2-3-入住表单查询" aria-hidden="true">#</a> 2.3 入住表单查询</h3><p><strong>接口地址</strong>:<code>/checkIn</code></p><p><strong>请求方式</strong>:<code>GET</code></p><p><strong>请求数据类型</strong>:<code>application/x-www-form-urlencoded</code></p><p><strong>响应数据类型</strong>:<code>*/*</code></p><p><strong>接口描述</strong>:</p><p><strong>请求参数</strong>:</p><table><thead><tr><th style="text-align:left;">参数名称</th><th style="text-align:left;">参数说明</th><th style="text-align:left;">数据类型</th></tr></thead><tbody><tr><td style="text-align:left;">assigneeId</td><td style="text-align:left;">处理人ID</td><td style="text-align:left;">string</td></tr><tr><td style="text-align:left;">code</td><td style="text-align:left;">入住编码</td><td style="text-align:left;">string</td></tr><tr><td style="text-align:left;">flowStatus</td><td style="text-align:left;">流程状态</td><td style="text-align:left;">int</td></tr><tr><td style="text-align:left;">taskId</td><td style="text-align:left;">任务Id</td><td style="text-align:left;">string</td></tr></tbody></table><p><strong>响应示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;checkIn&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//入住对象</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;createTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-10-20 19:53:35&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;updateTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-10-20 19:53:35&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;checkInCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RZ202310201953351&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;朱罡烈的入住申请&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;elderDto&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;朱罡烈&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;idCardNo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;132123196709071234&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;phone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13678904567&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;56&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;sex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;elderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;141&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;otherApplyInfo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\\&quot;education\\&quot;:\\&quot;硕士\\&quot;,\\&quot;idCardNo\\&quot;:\\&quot;132123196709071234\\&quot;,\\&quot;sex\\&quot;:0,\\&quot;politicStatus\\&quot;:\\&quot;群众\\&quot;,\\&quot;religion\\&quot;:\\&quot;佛教\\&quot;,\\&quot;nationality\\&quot;:\\&quot;汉族\\&quot;,...}&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;counselor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;养老顾问&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;applicat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;养老顾问&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;deptNo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;100001006000000&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;applicatId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1671403256519078161&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;flowStatus&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;isShow&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;memberElderDtos&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小猪&quot;</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;phone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13456655444&quot;</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;refName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;子女&quot;</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;refId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;url1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://itheim.oss-cn-beijing.aliyuncs.com/f0a77cf6-6c25-4b06-b170-a3d60944cfba.png&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;url2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://itheim.oss-cn-beijing.aliyuncs.com/7f94f434-7557-43b2-ad78-6e15031d6625.jpg&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;url3&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://itheim.oss-cn-beijing.aliyuncs.com/c8d80400-433b-4227-8c1f-896df699c2ec.jpg&quot;</span>
          
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;nextApprover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;护理组主管&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;accraditationRecords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">//操作记录</span>
            <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1759&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;createTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-10-20 19:53:36&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;opinion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;同意&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;approverId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1671403256519078161&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;approverName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;养老顾问&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;approverNameRole&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;bussniessId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;currentStep&quot;</span><span class="token operator">:</span> <span class="token string">&quot;发起申请-申请入住&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;nextStep&quot;</span><span class="token operator">:</span> <span class="token string">&quot;护理组组长处理-入住评估&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;auditStatus&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;nextApprover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;护理组主管&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;nextApproverId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1671403256519078157&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;nextApproverRole&quot;</span><span class="token operator">:</span> <span class="token string">&quot;护理组主管&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;stepNo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;handleType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;isShow&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-护理主管-评估" tabindex="-1"><a class="header-anchor" href="#_2-4-护理主管-评估" aria-hidden="true">#</a> 2.4 护理主管-评估</h3><p><strong>接口地址</strong>:<code>/checkIn/review</code></p><p><strong>请求方式</strong>:<code>POST</code></p><p><strong>请求示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span>
  <span class="token comment">//健康评估</span>
  <span class="token string-property property">&quot;reviewInfo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{&#39;diagnoseArr&#39;:[&#39;无疾病&#39;],&#39;woundArr&#39;:[&#39;无&#39;],&#39;lookAfterArr&#39;:[&#39;无&#39;]]}&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//能力评估</span>
  <span class="token string-property property">&quot;reviewInfo1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{&#39;radio1&#39;:0,&#39;radio1Score&#39;:1,&#39;radio2&#39;:2,&#39;radio2Score&#39;:3,&#39;radio3&#39;:3}&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//评估报告</span>
  <span class="token string-property property">&quot;reviewInfo2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{&#39;alteration&#39;:[&#39;已诊断疾病超过3项&#39;],&#39;selfScore&#39;:8,&#39;spiritScore&#39;:10,}&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//任务ID</span>
  <span class="token string-property property">&quot;taskId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4ca81266-6f3f-11ee-94ed-5405db5be13e&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>响应示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-副院长-同意" tabindex="-1"><a class="header-anchor" href="#_2-5-副院长-同意" aria-hidden="true">#</a> 2.5 副院长-同意</h3><p><strong>接口地址</strong>:<code>/checkIn/submit</code></p><p><strong>请求方式</strong>:<code>PUT</code></p><p><strong>请求参数</strong>:</p><table><thead><tr><th style="text-align:left;">参数名称</th><th style="text-align:left;">参数说明</th><th style="text-align:left;">数据类型</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">入住Id</td><td style="text-align:left;">long</td></tr><tr><td style="text-align:left;">message</td><td style="text-align:left;">审批意见</td><td style="text-align:left;">string</td></tr><tr><td style="text-align:left;">taskId</td><td style="text-align:left;">任务Id</td><td style="text-align:left;">string</td></tr></tbody></table><p><strong>响应示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-副院长-拒绝" tabindex="-1"><a class="header-anchor" href="#_2-6-副院长-拒绝" aria-hidden="true">#</a> 2.6 副院长-拒绝</h3><p><strong>接口地址</strong>:<code>/checkIn/reject</code></p><p><strong>请求方式</strong>:<code>PUT</code></p><p><strong>请求参数</strong>:</p><table><thead><tr><th style="text-align:left;">参数名称</th><th style="text-align:left;">参数说明</th><th style="text-align:left;">数据类型</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">入住Id</td><td style="text-align:left;">long</td></tr><tr><td style="text-align:left;">message</td><td style="text-align:left;">拒绝原因</td><td style="text-align:left;">string</td></tr><tr><td style="text-align:left;">taskId</td><td style="text-align:left;">任务Id</td><td style="text-align:left;">string</td></tr></tbody></table><p><strong>响应示例</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-接口功能开发" tabindex="-1"><a class="header-anchor" href="#_3-接口功能开发" aria-hidden="true">#</a> 3 接口功能开发</h2><h3 id="_3-1-代码结构调整" tabindex="-1"><a class="header-anchor" href="#_3-1-代码结构调整" aria-hidden="true">#</a> 3.1 代码结构调整</h3><p>为了更方便的维护工作流的代码，我们专门创建一个业务类来管理工作流的代码逻辑</p><p>新增一个ActFlowCommService类，定义两个方法，这两个方法，就是我们之前在CheckInServiceImpl中定义的方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">PageResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">PendingTasksDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">CheckIn</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">PendingTasks</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> sjqn
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ActFlowCommService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 查询下一个审核人
     * <span class="token keyword">@param</span> <span class="token parameter">processDefinitionKey</span>   流程定义key
     * <span class="token keyword">@param</span> <span class="token parameter">businessKey</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getNextAssignee</span><span class="token punctuation">(</span><span class="token class-name">String</span> processDefinitionKey<span class="token punctuation">,</span> <span class="token class-name">String</span> businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 启动流程实例，并且自动执行首页点
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>  业务id
     * <span class="token keyword">@param</span> <span class="token parameter">user</span>  当前登录用户
     * <span class="token keyword">@param</span> <span class="token parameter">processDefinitionKey</span>    流程定义的key
     * <span class="token keyword">@param</span> <span class="token parameter">variables</span>  流程变量参数
     * <span class="token keyword">@param</span> <span class="token parameter">isAuto</span>  是否自动完成
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> processDefinitionKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isAuto<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> sjqn
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActFlowCommServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ActFlowCommService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TaskService</span> taskService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">HistoryService</span> historyService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 查询下一个审核人
     * <span class="token keyword">@param</span> <span class="token parameter">processDefinitionKey</span>   流程定义key
     * <span class="token keyword">@param</span> <span class="token parameter">businessKey</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getNextAssignee</span><span class="token punctuation">(</span><span class="token class-name">String</span> processDefinitionKey<span class="token punctuation">,</span> <span class="token class-name">String</span> businessKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span>processDefinitionKey<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceBusinessKey</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * 启动流程实例，并且自动执行首页点
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>                   业务id
     * <span class="token keyword">@param</span> <span class="token parameter">user</span>                 当前登录用户
     * <span class="token keyword">@param</span> <span class="token parameter">processDefinitionKey</span> 流程定义的key
     * <span class="token keyword">@param</span> <span class="token parameter">variables</span>            流程变量参数
     * <span class="token keyword">@param</span> <span class="token parameter">isAuto</span>               是否自动完成
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> processDefinitionKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isAuto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//启动流程实例</span>
        <span class="token class-name">String</span> businessKey <span class="token operator">=</span> processDefinitionKey <span class="token operator">+</span><span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bussinessKey&quot;</span><span class="token punctuation">,</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span>processDefinitionKey<span class="token punctuation">,</span>businessKey<span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//查询任务，执行任务</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span>processDefinitionKey<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceBusinessKey</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断是否是首节点</span>
        list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getFormKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isAuto<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//执行任务</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                variables2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;processStatus&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                variables2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ops&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>variables2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改CheckInServiceImpl，注入ActFlowCommService进行方法调用</p><figure><img src="`+e+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-2-查询我的待办-我的申请" tabindex="-1"><a class="header-anchor" href="#_3-2-查询我的待办-我的申请" aria-hidden="true">#</a> 3.2 查询我的待办&amp;我的申请</h3><h4 id="_3-2-1-思路分析" tabindex="-1"><a class="header-anchor" href="#_3-2-1-思路分析" aria-hidden="true">#</a> 3.2.1 思路分析</h4><figure><img src="'+o+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-2-2-接口定义" tabindex="-1"><a class="header-anchor" href="#_3-2-2-接口定义" aria-hidden="true">#</a> 3.2.2 接口定义</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pending_tasks&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">&quot;待办&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PendingTasksController</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/selectByPage&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;查询待办&quot;</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">&quot;传入退住对象&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">selectByPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PendingTasksDto</span> pendingTasksDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数DTO：PendingTasksDto</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luckon<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiModel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiModelProperty</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span><span class="token string">&quot;待办DTO&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PendingTasksDto</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 申请单号
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请单号&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 申请人
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请人&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> applicat<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 申请人id
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请人id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> applicatId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 单据类别
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;单据类别&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> type<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 状态
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;流程状态&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 申请状态
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请状态&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> applyStatus<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 开始时间
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;开始时间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> startTime<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 结束时间
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;结束时间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> endTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 当前页
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;当前页&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageNum<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 每页条数
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;每页条数&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageSize<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 操作人
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;操作人&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> assigneeId<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 请求类型(0:待办，1:我的申请)
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;请求类型&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> reqType<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 是否处理完成
     * 0:未处理
     * 1:已处理
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;是否处理完成(0:未处理,1:已处理)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> isHandle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回实体：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luckon<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiModelProperty</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PendingTasks</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 主键
    */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> checkInId<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 申请人
    */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请人&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> applicat<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 申请人id
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请人角色名称&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> applicatId<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 申请时间
    */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;申请时间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> applicationTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 编号
    */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;编号&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 状态（1：申请中，2:已完成,3:已关闭）
    */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;状态&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 操作人ID
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;操作人ID&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> assigneeId<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 操作人
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;操作人&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> assignee<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 标题
    */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;标题&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
    * 类型（1：退住，2：请假，3：入住）
    */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;类型&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> type<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 完成时间
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;完成时间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> finishTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 是否处理完成
     * 0:未处理
     * 1:已处理
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;是否处理完成(0:未处理,1:已处理)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> isHandle<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 审核步骤
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;审核步骤&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> stepNo<span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * 流程状态
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;流程状态&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> flowStatus<span class="token punctuation">;</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-业务层开发" tabindex="-1"><a class="header-anchor" href="#_3-2-3-业务层开发" aria-hidden="true">#</a> 3.2.3 业务层开发</h4><p>因为所有的数据都是从activiti的表中进行查询，在之前创建入住的时候，还需要添加几个字段，是为了方便我们进行数据的检索</p><p>需要在启动流程实例中添加三个流程变量参数</p><ul><li>processTitle   标题</li><li>assignee0Name   申请人姓名</li><li>applicationTime   申请时间</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token class-name">CheckIn</span> checkIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;processTitle&quot;</span><span class="token punctuation">,</span> checkIn<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;assignee0Name&quot;</span><span class="token punctuation">,</span> checkIn<span class="token punctuation">.</span><span class="token function">getApplicat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;applicationTime&quot;</span><span class="token punctuation">,</span> checkIn<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//其他代码省略....</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在ActFlowCommService中定义新的方法，如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 查询待办和我的申请列表
 * <span class="token keyword">@param</span> <span class="token parameter">pendingTasksDto</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token keyword">public</span> <span class="token class-name">PageResponse</span> <span class="token function">getMyTaskList</span><span class="token punctuation">(</span><span class="token class-name">PendingTasksDto</span> pendingTasksDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 分页条件查询待办任务
     *
     * <span class="token keyword">@param</span> <span class="token parameter">pendingTasksDto</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PendingTasks</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMyTaskList</span><span class="token punctuation">(</span><span class="token class-name">PendingTasksDto</span> pendingTasksDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//创建查询条件</span>
    <span class="token class-name">HistoricTaskInstanceQuery</span> taskQuery <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricTaskInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//是否是已处理</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getIsHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getIsHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            taskQuery<span class="token punctuation">.</span><span class="token function">finished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            taskQuery<span class="token punctuation">.</span><span class="token function">unfinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//做一系列判断来进行查询</span>
    taskQuery<span class="token punctuation">.</span><span class="token function">taskNameLike</span><span class="token punctuation">(</span><span class="token string">&quot;%处理&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    taskQuery<span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getAssigneeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//时间范围查询</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskQuery<span class="token punctuation">.</span><span class="token function">taskCreatedAfter</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskCreatedBefore</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//单据类别</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskQuery<span class="token punctuation">.</span><span class="token function">processVariableValueEquals</span><span class="token punctuation">(</span><span class="token string">&quot;processType&quot;</span><span class="token punctuation">,</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//单据code</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskQuery<span class="token punctuation">.</span><span class="token function">processVariableValueEquals</span><span class="token punctuation">(</span><span class="token string">&quot;processCode&quot;</span><span class="token punctuation">,</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//任务状态</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskQuery<span class="token punctuation">.</span><span class="token function">processVariableValueEquals</span><span class="token punctuation">(</span><span class="token string">&quot;processStatus&quot;</span><span class="token punctuation">,</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取总条数</span>
    <span class="token keyword">long</span> count <span class="token operator">=</span> taskQuery<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//分页查询</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricTaskInstance</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskQuery<span class="token punctuation">.</span><span class="token function">includeProcessVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByHistoricTaskInstanceStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listPage</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PendingTasks</span><span class="token punctuation">&gt;</span></span> pendingTasksList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//封装返回数据</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HistoricTaskInstance</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> processVariables <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getProcessVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PendingTasks</span> pendingTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;processCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;processType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;processTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setApplicat</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;assignee0Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;processStatus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setAssigneeId</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LocalDateTime</span> applicationTime <span class="token operator">=</span> <span class="token class-name">LocalDateTimeUtil</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;applicationTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasks<span class="token punctuation">.</span><span class="token function">setApplicationTime</span><span class="token punctuation">(</span>applicationTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//TODO 完成时间</span>

        pendingTasksList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pendingTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">PageResponse</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>pendingTasksList<span class="token punctuation">,</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token punctuation">(</span>count <span class="token operator">+</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> pendingTasksDto<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-4-控制层开发" tabindex="-1"><a class="header-anchor" href="#_3-2-4-控制层开发" aria-hidden="true">#</a> 3.2.4 控制层开发</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pending_tasks&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">&quot;待办&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PendingTasksController</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ActFlowCommService</span> actFlowCommService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/selectByPage&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;查询待办&quot;</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">&quot;传入退住对象&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PendingTasks</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PendingTasksDto</span> pendingTasksDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//只查询有当前登录人的任务</span>
        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserThreadLocal</span><span class="token punctuation">.</span><span class="token function">getMgtUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pendingTasksDto<span class="token punctuation">.</span><span class="token function">setAssigneeId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PageResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PendingTasks</span><span class="token punctuation">&gt;</span></span> pendingTasksPageResponse <span class="token operator">=</span> actFlowCommService<span class="token punctuation">.</span><span class="token function">myTaskInfoList</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span>pendingTasksPageResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-5-测试" tabindex="-1"><a class="header-anchor" href="#_3-2-5-测试" aria-hidden="true">#</a> 3.2.5 测试</h4><p>可以在页面中直接查看待办的数据</p><figure><img src="`+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-3-我的申请" tabindex="-1"><a class="header-anchor" href="#_3-3-我的申请" aria-hidden="true">#</a> 3.3 我的申请</h3><figure><img src="'+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-3-1-接口定义" tabindex="-1"><a class="header-anchor" href="#_3-3-1-接口定义" aria-hidden="true">#</a> 3.3.1 接口定义</h4><p>新增ApplicationsController类，直接调用actFlowCommService中myTaskInfoList方法即可</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BeanUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">PageResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">ResponseResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">ApplicationsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">PendingTasksDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">PendingTasks</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ActFlowCommService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">UserThreadLocal</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zzyl<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">ApplicationsVo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
* applications 控制器实现
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
*
* <span class="token keyword">@author</span> itheima
*/</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/applications&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">&quot;我的申请&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationsController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ActFlowCommService</span> actFlowCommService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/selectByPage&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;查询我的申请&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationsVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ApplicationsDto</span> applicationsDto<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">Long</span> mgtUserId <span class="token operator">=</span> <span class="token class-name">UserThreadLocal</span><span class="token punctuation">.</span><span class="token function">getMgtUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationsDto<span class="token punctuation">.</span><span class="token function">setApplicatId</span><span class="token punctuation">(</span>mgtUserId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PendingTasksDto</span> pendingTasksDto <span class="token operator">=</span> <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>applicationsDto<span class="token punctuation">,</span> <span class="token class-name">PendingTasksDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PageResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PendingTasks</span><span class="token punctuation">&gt;</span></span> pendingTasksPageResponse <span class="token operator">=</span> actFlowCommService<span class="token punctuation">.</span><span class="token function">getMyTaskList</span><span class="token punctuation">(</span>pendingTasksDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>pendingTasksPageResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-业务层" tabindex="-1"><a class="header-anchor" href="#_3-3-2-业务层" aria-hidden="true">#</a> 3.3.2 业务层</h4><p>在ActFlowCommServiceImpl类中的myTaskInfoList方法，修改代码，如果存在申请人id,则查询申请人，不然就是待办数据</p><figure><img src="`+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-4-入住表单查询" tabindex="-1"><a class="header-anchor" href="#_3-4-入住表单查询" aria-hidden="true">#</a> 3.4 入住表单查询</h3><h4 id="_3-4-1-思路分析" tabindex="-1"><a class="header-anchor" href="#_3-4-1-思路分析" aria-hidden="true">#</a> 3.4.1 思路分析</h4><figure><img src="'+u+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>参数说明：</p><ul><li>db-flowStatus  数据库中存储的入住流程状态</li><li>flowStatus   前端传递过来的流程状态</li><li>taskId  当前登录人的任务id</li></ul><h4 id="_3-4-2-接口定义" tabindex="-1"><a class="header-anchor" href="#_3-4-2-接口定义" aria-hidden="true">#</a> 3.4.2 接口定义</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住表单查询&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TasVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCheckIn</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住编码&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;处理人ID&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> assigneeId<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;流程状态&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> flowStatus<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;任务Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TasVo</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luckon<span class="token punctuation">.</span>vo<span class="token punctuation">.</span>retreat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>luckon<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>luckon<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">CheckInVo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiModelProperty</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> sjqn
 * <span class="token keyword">@date</span> 2023/6/20
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TasVo</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 入住信息
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">CheckInVo</span> checkIn<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 类型 1退住 2请假 3入住
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> type<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> nextApprover<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 审批记录
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccraditationRecord</span><span class="token punctuation">&gt;</span></span> accraditationRecords<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 是否展示退住数据
     * 0:其他用户，审核中
     * 1:当前为审核人，可以正常查看数据
     */</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;是否展示入住数据&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> isShow<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-3-业务层开发" tabindex="-1"><a class="header-anchor" href="#_3-4-3-业务层开发" aria-hidden="true">#</a> 3.4.3 业务层开发</h4><p>在CheckInService中新增方法，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 查询入住信息
     * <span class="token keyword">@param</span>      * <span class="token keyword">@param</span> status
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TasVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCheckIn</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> assigneeId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> flowStatus<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>业务层代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 查询入住信息
     *
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>
     * <span class="token keyword">@param</span> <span class="token parameter">assigneeId</span>
     * <span class="token keyword">@param</span> <span class="token parameter">flowStatus</span>
     * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TasVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCheckIn</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> assigneeId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> flowStatus<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//根据code查询入住单</span>
    <span class="token class-name">CheckIn</span> checkIn <span class="token operator">=</span> checkInMapper<span class="token punctuation">.</span><span class="token function">selectByCheckInCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CheckInVo</span> checkInVo <span class="token operator">=</span> <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">,</span> <span class="token class-name">CheckInVo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//封装数据，方便前端展示</span>
    <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>checkInVo<span class="token punctuation">.</span><span class="token function">getOtherApplyInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JSONObject</span> otherApplyInfo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;otherApplyInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        checkInVo<span class="token punctuation">.</span><span class="token function">setOtherApplyInfo</span><span class="token punctuation">(</span>otherApplyInfo<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberElderDto</span><span class="token punctuation">&gt;</span></span> memberElderDtos <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;memberElderDtos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MemberElderDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        checkInVo<span class="token punctuation">.</span><span class="token function">setMemberElderDtos</span><span class="token punctuation">(</span>memberElderDtos<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ElderDto</span> elderDto1 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;elderDto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ElderDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        checkInVo<span class="token punctuation">.</span><span class="token function">setElderDto</span><span class="token punctuation">(</span>elderDto1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//取出url信息</span>
        checkInVo<span class="token punctuation">.</span><span class="token function">setUrl1</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;url1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        checkInVo<span class="token punctuation">.</span><span class="token function">setUrl2</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;url2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        checkInVo<span class="token punctuation">.</span><span class="token function">setUrl3</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;url3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//如果flowStatus小于0，重新赋值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flowStatus <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flowStatus <span class="token operator">=</span> checkIn<span class="token punctuation">.</span><span class="token function">getFlowStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//isShow字段：0 只展示操作记录，1：展示详细数据集操作记录</span>
    <span class="token class-name">Integer</span> isShow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//查询当前流程在第几步</span>
        isShow <span class="token operator">=</span> actFlowCommService<span class="token punctuation">.</span><span class="token function">isCurrentUserAndStep</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> flowStatus<span class="token punctuation">,</span> checkIn<span class="token punctuation">.</span><span class="token function">getFlowStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">TasVo</span> tasVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TasVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 默认显示入住申请基本信息数据</span>
    checkInVo<span class="token punctuation">.</span><span class="token function">setIsShow</span><span class="token punctuation">(</span>isShow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tasVo<span class="token punctuation">.</span><span class="token function">setCheckIn</span><span class="token punctuation">(</span>checkInVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tasVo<span class="token punctuation">.</span><span class="token function">setIsShow</span><span class="token punctuation">(</span>isShow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//流程类型：入住</span>
    tasVo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//审批记录数据</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccraditationRecord</span><span class="token punctuation">&gt;</span></span> accraditationRecordList
        <span class="token operator">=</span> accraditationRecordMapper<span class="token punctuation">.</span><span class="token function">getAccraditationRecordByBuisId</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PendingTasksConstant</span><span class="token punctuation">.</span><span class="token constant">TASK_TYPE_CHECK_IN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tasVo<span class="token punctuation">.</span><span class="token function">setAccraditationRecords</span><span class="token punctuation">(</span>accraditationRecordList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>tasVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了方便封装老人的数据，我们可以在新增退住的时候，把老人的数据封装到<strong>其他信息</strong>字符串中保存到数据库中，修改申请入住代码，如下：</p><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+k+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 判断当前操作的是第几步
     * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>
     * <span class="token keyword">@param</span> <span class="token parameter">flowStatus</span>
     * <span class="token keyword">@param</span> <span class="token parameter">dbFlowStatus</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">isCurrentUserAndStep</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> flowStatus<span class="token punctuation">,</span> <span class="token class-name">Integer</span> dbFlowStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//当前任务人的节点</span>
    <span class="token class-name">HistoricTaskInstance</span> historicTaskInstance <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricTaskInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskId</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> formKey <span class="token operator">=</span> historicTaskInstance<span class="token punctuation">.</span><span class="token function">getFormKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//如果前端传递的流程状态跟数据库一致，当前操作人的任务节点与状态一致</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dbFlowStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>flowStatus<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> dbFlowStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">CheckIn<span class="token punctuation">.</span>Status</span><span class="token punctuation">.</span><span class="token constant">APPLICATION</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> formKey<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dbFlowStatus<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-4-控制层开发" tabindex="-1"><a class="header-anchor" href="#_3-4-4-控制层开发" aria-hidden="true">#</a> 3.4.4 控制层开发</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住表单查询&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TasVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCheckIn</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住编码&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;处理人ID&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> assigneeId<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;流程状态&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> flowStatus<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;任务Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> checkInService<span class="token punctuation">.</span><span class="token function">getCheckIn</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> assigneeId<span class="token punctuation">,</span> flowStatus<span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-5-测试" tabindex="-1"><a class="header-anchor" href="#_3-4-5-测试" aria-hidden="true">#</a> 3.4.5 测试</h4><p>护理组长登录之后，查看待办列表，点击”处理”按钮后，可以查看之前录入的数据</p><figure><img src="`+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-5-护理主管-评估" tabindex="-1"><a class="header-anchor" href="#_3-5-护理主管-评估" aria-hidden="true">#</a> 3.5 护理主管-评估</h3><h4 id="_3-5-1-思路分析" tabindex="-1"><a class="header-anchor" href="#_3-5-1-思路分析" aria-hidden="true">#</a> 3.5.1 思路分析</h4><figure><img src="'+v+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-5-2-接口定义" tabindex="-1"><a class="header-anchor" href="#_3-5-2-接口定义" aria-hidden="true">#</a> 3.5.2 接口定义</h4><p>在CheckInController中新增接口，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/review&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;评估&quot;</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">&quot;传入入住对象&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">review</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住对象&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token class-name">CheckInDto</span> checkInDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-3-业务层开发" tabindex="-1"><a class="header-anchor" href="#_3-5-3-业务层开发" aria-hidden="true">#</a> 3.5.3 业务层开发</h4><p>在CheckInService中新增方法，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 评估
 * <span class="token keyword">@param</span> <span class="token parameter">checkInDto</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token class-name">ResponseResult</span> <span class="token function">review</span><span class="token punctuation">(</span><span class="token class-name">CheckInDto</span> checkInDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 评估
     * <span class="token keyword">@param</span> <span class="token parameter">checkInDto</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">review</span><span class="token punctuation">(</span><span class="token class-name">CheckInDto</span> checkInDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CheckIn</span> checkIn <span class="token operator">=</span> checkInMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>checkInDto<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkIn<span class="token punctuation">.</span><span class="token function">setFlowStatus</span><span class="token punctuation">(</span><span class="token class-name">CheckIn<span class="token punctuation">.</span>FlowStatus</span><span class="token punctuation">.</span><span class="token constant">APPROVAL</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//保存健康评估数据</span>
    checkIn<span class="token punctuation">.</span><span class="token function">setReviewInfo</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>checkInDto<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkInMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//  操作记录</span>
    <span class="token comment">//从当前线程中获取用户数据</span>
    <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token class-name">UserThreadLocal</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//完成流程</span>
    actFlowCommService<span class="token punctuation">.</span><span class="token function">completeProcess</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> checkInDto<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//记录操作记录</span>
    <span class="token class-name">Long</span> nextAssignee <span class="token operator">=</span> actFlowCommService<span class="token punctuation">.</span><span class="token function">getNextAssignee</span><span class="token punctuation">(</span><span class="token string">&quot;checkIn-new&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;checkIn-new:&quot;</span> <span class="token operator">+</span> checkIn<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">RecordVo</span> recoreVo <span class="token operator">=</span> <span class="token function">getRecordVo</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">,</span> user<span class="token punctuation">,</span> <span class="token class-name">AccraditationRecordConstant</span><span class="token punctuation">.</span><span class="token constant">AUDIT_STATUS_PASS</span><span class="token punctuation">,</span>
                                    <span class="token string">&quot;同意&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;护理部组长处理-入住评估&quot;</span><span class="token punctuation">,</span>
                                    <span class="token string">&quot;院长处理-入住审批&quot;</span><span class="token punctuation">,</span> nextAssignee
                                    <span class="token punctuation">,</span> <span class="token class-name">AccraditationRecordConstant</span><span class="token punctuation">.</span><span class="token constant">RECORD_HANDLE_TYPE_PROCESSED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    accraditationRecordService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>recoreVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在ActFlowCommService中定义新的方法来完成任务</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 完成任务
     * <span class="token keyword">@param</span> <span class="token parameter">title</span>  标题
     * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>  任务id
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span>  用户id
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>   流程变量ops的值  1为同意，2为拒绝，3为驳回
     * <span class="token keyword">@param</span> <span class="token parameter">status</span>  审核状态  1，申请中  2 已完成   3  已关闭
     */</span>
<span class="token keyword">void</span> <span class="token function">completeProcess</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">Integer</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 完成任务
     * <span class="token keyword">@param</span> <span class="token parameter">title</span>  标题
     * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>  任务id
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span>  用户id
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>   流程变量ops的值  1为同意，2为拒绝，3为驳回
     * <span class="token keyword">@param</span> <span class="token parameter">status</span>  审核状态  1，申请中  2 已完成   3  已关闭
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completeProcess</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">Integer</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//任务Id 查询任务对象</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskId</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//完成办理</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;processStatus&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;finishTime&quot;</span><span class="token punctuation">,</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;processTitle&quot;</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ops&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-4-控制层开发" tabindex="-1"><a class="header-anchor" href="#_3-5-4-控制层开发" aria-hidden="true">#</a> 3.5.4 控制层开发</h4><p>补全完善控制层代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/review&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;评估&quot;</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">&quot;传入入住对象&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CheckInVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">review</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住对象&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token class-name">CheckInDto</span> checkInDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> checkInService<span class="token punctuation">.</span><span class="token function">review</span><span class="token punctuation">(</span>checkInDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-5-测试" tabindex="-1"><a class="header-anchor" href="#_3-5-5-测试" aria-hidden="true">#</a> 3.5.5 测试</h4><p>使用护理组长账号登录，处理待办，提交表单，在数据库中查看是否保存成功</p><h4 id="_3-5-6-补全入住表单查询" tabindex="-1"><a class="header-anchor" href="#_3-5-6-补全入住表单查询" aria-hidden="true">#</a> 3.5.6 补全入住表单查询</h4><p>因为现在我们在入住表中新增了评估的内容，那么当用户会看之前的数据，比如评估的内容，我们就需要在表单中进行展示这部分内容，如下图</p><figure><img src="`+m+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如果想要回显这些数据，我们就需要修改刚才开发的<strong>入住表单查询</strong>的这个业务逻辑</p><p>修改CheckInServiceImpl的getCheckIn方法，添加如下代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//查询入住评估内容</span>
<span class="token class-name">JSONObject</span> reviewInfoJsonObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>checkInVo<span class="token punctuation">.</span><span class="token function">getReviewInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>reviewInfoJsonObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> reviewInfo <span class="token operator">=</span> reviewInfoJsonObj<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;reviewInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> reviewInfo1 <span class="token operator">=</span> reviewInfoJsonObj<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;reviewInfo1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> reviewInfo2 <span class="token operator">=</span> reviewInfoJsonObj<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;reviewInfo2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkInVo<span class="token punctuation">.</span><span class="token function">setReviewInfo</span><span class="token punctuation">(</span>reviewInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkInVo<span class="token punctuation">.</span><span class="token function">setReviewInfo1</span><span class="token punctuation">(</span>reviewInfo1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkInVo<span class="token punctuation">.</span><span class="token function">setReviewInfo2</span><span class="token punctuation">(</span>reviewInfo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：我们在回看入住评估信息的时候，可以正常显示评估的数据</p><h4 id="_3-5-6-修复数据展示-状态控制" tabindex="-1"><a class="header-anchor" href="#_3-5-6-修复数据展示-状态控制" aria-hidden="true">#</a> 3.5.6 修复数据展示（状态控制）</h4><p>参数说明：</p><ul><li></li></ul><p>taskId   从前端传递过来，当前登录人的任务，可能是历史任务（执行过的），也可能是未执行的任务</p><ul><li></li></ul><p>flowStatus  从前端传递过来，用户在页面点击的流程节点</p><ul><li></li></ul><p>dbFlowStatus  后端存储的流程状态，指的是当前待执行的节点</p><blockquote><p>举例：当前数据库中待执行的节点为2（院长审批）</p></blockquote><blockquote><ul><li></li></ul></blockquote><p>院长查看表单</p><blockquote><ul><li></li></ul></blockquote><p>点击入住审批，可以查看表单数据，可以编辑数据，进行审核   taskId对应的formKey等于dbFlowStatus ,返回的isShow为1</p><blockquote><ul><li></li></ul></blockquote><p>点击入住评估或者申请入住，可以查看表单数据，但是不能编辑，因为： dbFlowStatus不等于flowStatus，返回的isShow为1</p><blockquote><ul><li></li></ul></blockquote><p>护理主管查看表单：</p><blockquote><ul><li></li></ul></blockquote><p>点击入住审批，只能查看操作记录，不能编辑数据   taskId对应的formKey不等于dbFlowStatus，返回的isShow为0</p><blockquote><ul><li></li></ul></blockquote><p>点击入住评估或者申请入住，可以查看表单数据，但是不能编辑，因为： dbFlowStatus不等于flowStatus，返回的isShow为1</p><blockquote><ul><li></li></ul></blockquote><p>养老顾问查看表单：</p><blockquote><ul><li></li></ul></blockquote><p>点击入住审批，只能查看操作记录，不能编辑数据   taskId对应的formKey不等于dbFlowStatus，返回的isShow为0</p><blockquote><ul><li></li></ul></blockquote><p>点击入住评估或者申请入住，可以查看表单数据，但是不能编辑，因为： dbFlowStatus不等于flowStatus，返回的isShow为1</p><p>在getCheckIn方法中添加如下逻辑</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>flowStatus <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    flowStatus <span class="token operator">=</span> checkIn<span class="token punctuation">.</span><span class="token function">getFlowStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    isShow <span class="token operator">=</span> actFlowCommService<span class="token punctuation">.</span><span class="token function">isCurrentUserAndStep</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span>flowStatus<span class="token punctuation">,</span>checkIn<span class="token punctuation">.</span><span class="token function">getFlowStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改isCurrentUserAndStep方法，添加参数、添加如下逻辑</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">isCurrentUserAndStep</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">,</span><span class="token class-name">Integer</span> flowStatus<span class="token punctuation">,</span> <span class="token class-name">Integer</span> dbFlowStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HistoricTaskInstance</span> historicTaskInstance <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricTaskInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskId</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> formKey <span class="token operator">=</span> historicTaskInstance<span class="token punctuation">.</span><span class="token function">getFormKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//前端传递的流程状态与数据库中一致，有两种情况，是不是当前人的任务，如果是，则返回1，不是返回0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flowStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dbFlowStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>formKey<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dbFlowStatus<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-副院长-同意" tabindex="-1"><a class="header-anchor" href="#_3-6-副院长-同意" aria-hidden="true">#</a> 3.6 副院长-同意</h3><p>当护理组长提交了数据之后，现在使用副院长账号登录，在待办列表中可以查看需要待办的数据</p><p>副院长的主要职责就是审核单子，有三种情况，分别是：同意、拒绝、驳回</p><figure><img src="`+b+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这三种情况，分别对应了不同的接口，处理逻辑也是不一样的，我们先来实现第一个：审批通过（同意）</p><h4 id="_3-6-1-思路分析" tabindex="-1"><a class="header-anchor" href="#_3-6-1-思路分析" aria-hidden="true">#</a> 3.6.1 思路分析</h4><figure><img src="'+g+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-6-2-接口定义" tabindex="-1"><a class="header-anchor" href="#_3-6-2-接口定义" aria-hidden="true">#</a> 3.6.2 接口定义</h4><p>在CheckInController中新增接口，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/submit&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;同意&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">submitCheckIn</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;审批意见&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;任务Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-3-业务层开发" tabindex="-1"><a class="header-anchor" href="#_3-6-3-业务层开发" aria-hidden="true">#</a> 3.6.3 业务层开发</h4><p>在CheckInService中新增方法，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 同意入住申请
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token class-name">ResponseResult</span> <span class="token function">submitCheckIn</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> info<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 同意入住申请
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@param</span> <span class="token parameter">message</span>
     * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">submitCheckIn</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 流程状态 操作记录</span>
    <span class="token class-name">CheckIn</span> checkIn <span class="token operator">=</span> checkInMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置流程状态</span>
    checkIn<span class="token punctuation">.</span><span class="token function">setFlowStatus</span><span class="token punctuation">(</span><span class="token class-name">CheckIn<span class="token punctuation">.</span>FlowStatus</span><span class="token punctuation">.</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkInMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//  操作记录</span>
    <span class="token comment">//从当前线程中获取用户数据</span>
    <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token class-name">UserThreadLocal</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//完成任务</span>
    actFlowCommService<span class="token punctuation">.</span><span class="token function">completeProcess</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> taskId<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 养老顾问</span>
    <span class="token class-name">CheckIn</span> checkIn1 <span class="token operator">=</span> checkInMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> userId <span class="token operator">=</span> checkIn1<span class="token punctuation">.</span><span class="token function">getApplicatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RecordVo</span> recoreVo <span class="token operator">=</span> <span class="token function">getRecordVo</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">,</span>
                                    user<span class="token punctuation">,</span>
                                    <span class="token class-name">AccraditationRecordConstant</span><span class="token punctuation">.</span><span class="token constant">AUDIT_STATUS_PASS</span><span class="token punctuation">,</span>
                                    message<span class="token punctuation">,</span>
                                    <span class="token string">&quot;院长处理-入住审批&quot;</span><span class="token punctuation">,</span>
                                    <span class="token string">&quot;养老顾问处理-入住配置&quot;</span><span class="token punctuation">,</span>
                                    userId<span class="token punctuation">,</span>
                                    <span class="token class-name">AccraditationRecordConstant</span><span class="token punctuation">.</span><span class="token constant">RECORD_HANDLE_TYPE_AUDIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    accraditationRecordService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>recoreVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-4-控制层开发" tabindex="-1"><a class="header-anchor" href="#_3-6-4-控制层开发" aria-hidden="true">#</a> 3.6.4 控制层开发</h4><p>补全完善控制层代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/submit&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;同意&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">submitCheckIn</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;审批意见&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;任务Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> checkInService<span class="token punctuation">.</span><span class="token function">submitCheckIn</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> message<span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-5-测试" tabindex="-1"><a class="header-anchor" href="#_3-6-5-测试" aria-hidden="true">#</a> 3.6.5 测试</h4><p>当审核成功以后，副院长可以在已处理列表中进行查看，分配给下一个处理人为：申请人（养老顾问）</p><h3 id="_3-7-副院长-拒绝" tabindex="-1"><a class="header-anchor" href="#_3-7-副院长-拒绝" aria-hidden="true">#</a> 3.7 副院长-拒绝</h3><p>在副院长审核的时候，假如副院长感觉数据有问题，也可以拒绝审批，拒绝审批的是另外的一个接口</p><h4 id="_3-7-1-思路分析" tabindex="-1"><a class="header-anchor" href="#_3-7-1-思路分析" aria-hidden="true">#</a> 3.7.1 思路分析</h4><p>先打开，我们之前定义的流程，里面定义了两个网关，当拒绝的时候，ops为2</p><p>流程是：先走第一个网关，然后走第二个网关，最后结束流程即可</p><figure><img src="`+y+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-7-2-接口定义" tabindex="-1"><a class="header-anchor" href="#_3-7-2-接口定义" aria-hidden="true">#</a> 3.7.2 接口定义</h4><p>在CheckInController中新增接口，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/reject&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;审核拒绝&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">auditReject</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;拒绝原因&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;任务Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-7-3-业务层开发" tabindex="-1"><a class="header-anchor" href="#_3-7-3-业务层开发" aria-hidden="true">#</a> 3.7.3 业务层开发</h4><p>在CheckInService中新增方法，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 审核拒绝
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>  入住单code
 * <span class="token keyword">@param</span> <span class="token parameter">reject</span>   拒绝原因
 * <span class="token keyword">@return</span>
 */</span>
<span class="token class-name">ResponseResult</span> <span class="token function">auditReject</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> reject<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 拒绝
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@param</span> <span class="token parameter">message</span>
     * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">auditReject</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//查询入住数据</span>
    <span class="token class-name">CheckIn</span> checkIn <span class="token operator">=</span> checkInMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置流程状态</span>
    checkIn<span class="token punctuation">.</span><span class="token function">setFlowStatus</span><span class="token punctuation">(</span><span class="token class-name">CheckIn<span class="token punctuation">.</span>FlowStatus</span><span class="token punctuation">.</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkIn<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">CheckIn<span class="token punctuation">.</span>Status</span><span class="token punctuation">.</span><span class="token constant">CLOSED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkInMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKey</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//删除老人数据</span>
    <span class="token function">close</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token class-name">UserThreadLocal</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    actFlowCommService<span class="token punctuation">.</span><span class="token function">completeProcess</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> taskId<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">CheckIn<span class="token punctuation">.</span>Status</span><span class="token punctuation">.</span><span class="token constant">CLOSED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//记录操作记录</span>
    <span class="token class-name">RecordVo</span> recoreVo <span class="token operator">=</span> <span class="token function">getRecordVo</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">,</span>
                                    user<span class="token punctuation">,</span>
                                    <span class="token class-name">AccraditationRecordConstant</span><span class="token punctuation">.</span><span class="token constant">AUDIT_STATUS_REJECT</span><span class="token punctuation">,</span>
                                    message<span class="token punctuation">,</span>
                                    <span class="token string">&quot;院长处理-入住审批&quot;</span><span class="token punctuation">,</span>
                                    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                                    <span class="token keyword">null</span><span class="token punctuation">,</span>
                                    <span class="token class-name">AccraditationRecordConstant</span><span class="token punctuation">.</span><span class="token constant">RECORD_HANDLE_TYPE_PROCESSED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    accraditationRecordService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>recoreVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">CheckIn</span> checkIn<span class="token punctuation">)</span><span class="token punctuation">{</span>
    elderService<span class="token punctuation">.</span><span class="token function">deleteByPrimaryKey</span><span class="token punctuation">(</span>checkIn<span class="token punctuation">.</span><span class="token function">getElderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了方便展示任务列表（我的待办和我的申请），在任务已关闭或者已完成之后需要返回完成时间</p><p>第一，修改ActFlowCommServiceImpl中的completeProcess方法，如果审核状态不为空，则需要设置完成时间到流程变量中</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;processStatus&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;finishTime&quot;</span><span class="token punctuation">,</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二，修改ActFlowCommServiceImpl中的getMyTaskList方法，在返回数据中添加如下代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//如果审核状态为已关闭或已完成，则需要返回完成时间</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>pendingTasks<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">PendingTasksConstant</span><span class="token punctuation">.</span><span class="token constant">TASK_STATUS_CLOSED</span><span class="token punctuation">)</span> 
<span class="token operator">||</span> pendingTasks<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">PendingTasksConstant</span><span class="token punctuation">.</span><span class="token constant">TASK_STATUS_FINISHED</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">LocalDateTime</span> finishTime <span class="token operator">=</span> <span class="token class-name">LocalDateTimeUtil</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>processVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;finishTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pendingTasks<span class="token punctuation">.</span><span class="token function">setFinishTime</span><span class="token punctuation">(</span>finishTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-7-4-控制层开发" tabindex="-1"><a class="header-anchor" href="#_3-7-4-控制层开发" aria-hidden="true">#</a> 3.7.4 控制层开发</h4><p>补全完善控制层代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/reject&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;审核拒绝&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">auditReject</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;入住Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;拒绝原因&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span> <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;任务Id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> checkInService<span class="token punctuation">.</span><span class="token function">auditReject</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> message<span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-7-5-测试" tabindex="-1"><a class="header-anchor" href="#_3-7-5-测试" aria-hidden="true">#</a> 3.7.5 测试</h4><p>当拒绝之后，申请人查看数据，当前入住单已经结束，老人数据清空。</p>`,228),h=[f];function w(I,S){return s(),a("div",null,h)}const A=n(q,[["render",w],["__file","day09-入退管理-入住-2.html.vue"]]);export{A as default};
