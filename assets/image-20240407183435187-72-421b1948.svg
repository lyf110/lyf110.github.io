<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="860px" preserveAspectRatio="none" style="width:869px;height:860px;background:#FFFFFF;" version="1.1" viewBox="0 0 869 860" width="869px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="100.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="252" y="272.2266"/><rect fill="#FFFFFF" height="130.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="443.5" y="112.4297"/><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="443.5" y="372.625"/><rect fill="#FFFFFF" height="288.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="443.5" y="473.0234"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="29" x2="29" y1="81.2969" y2="779.3516"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="256.5" x2="256.5" y1="81.2969" y2="779.3516"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="448.5" x2="448.5" y1="81.2969" y2="779.3516"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="836" x2="836" y1="81.2969" y2="779.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="5" y="77.9951">用户端</text><ellipse cx="29" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M29,21.5 L29,48.5 M16,29.5 L42,29.5 M29,48.5 L16,63.5 M29,48.5 L42,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="5" y="791.3467">用户端</text><ellipse cx="29" cy="803.1484" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M29,811.1484 L29,838.1484 M16,819.1484 L42,819.1484 M29,838.1484 L16,853.1484 M29,838.1484 L42,853.1484 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147" x="183.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="190.5" y="69.9951">sl-express-gateway</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147" x="183.5" y="778.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="190.5" y="798.3467">sl-express-gateway</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="216" x="340.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="347.5" y="69.9951">sl-express-ms-web-customer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="216" x="340.5" y="778.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="347.5" y="798.3467">sl-express-ms-web-customer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="53" x="810" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="817" y="69.9951">Redis</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="53" x="810" y="778.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="817" y="798.3467">Redis</text><rect fill="#FFFFFF" height="100.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="252" y="272.2266"/><rect fill="#FFFFFF" height="130.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="443.5" y="112.4297"/><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="443.5" y="372.625"/><rect fill="#FFFFFF" height="288.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="443.5" y="473.0234"/><polygon fill="#181818" points="431.5,108.4297,441.5,112.4297,431.5,116.4297,435.5,112.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="29" x2="437.5" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="36" y="107.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="49" y="107.3638">用户名密码</text><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="495.5" y1="156.6953" y2="156.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="495.5" x2="495.5" y1="156.6953" y2="169.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="454.5" x2="495.5" y1="169.6953" y2="169.6953"/><polygon fill="#181818" points="464.5,165.6953,454.5,169.6953,464.5,173.6953,460.5,169.6953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="460.5" y="144.063">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="473.5" y="136.4966">生成access_token、</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="473.5" y="151.6294">refresh_token</text><polygon fill="#181818" points="824.5,194.8281,834.5,198.8281,824.5,202.8281,828.5,198.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="830.5" y1="198.8281" y2="198.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="460.5" y="193.7622">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="473.5" y="193.7622">存储refresh_token到redis</text><polygon fill="#181818" points="40,239.0938,30,243.0938,40,247.0938,36,243.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="34" x2="447.5" y1="243.0938" y2="243.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="46" y="230.4614">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="59" y="222.895">返回access_token、</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="59" y="238.0278">refresh_token</text><polygon fill="#181818" points="240,268.2266,250,272.2266,240,276.2266,244,272.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="29" x2="246" y1="272.2266" y2="272.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="36" y="267.1606">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="49" y="267.1606">请求数据接口携带access_token</text><line style="stroke:#181818;stroke-width:1.0;" x1="262" x2="304" y1="301.3594" y2="301.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="304" x2="304" y1="301.3594" y2="314.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="263" x2="304" y1="314.3594" y2="314.3594"/><polygon fill="#181818" points="273,310.3594,263,314.3594,273,318.3594,269,314.3594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="269" y="296.2935">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="282" y="296.2935">校验token（一次校验）</text><polygon fill="#181818" points="40,339.4922,30,343.4922,40,347.4922,36,343.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="34" x2="251" y1="343.4922" y2="343.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="46" y="338.4263">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="59" y="338.4263">access_token失效，响应401</text><polygon fill="#181818" points="431.5,368.625,441.5,372.625,431.5,376.625,435.5,372.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="257" x2="437.5" y1="372.625" y2="372.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="264" y="367.5591">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="277" y="367.5591">校验通过，转发请求</text><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="495.5" y1="401.7578" y2="401.7578"/><line style="stroke:#181818;stroke-width:1.0;" x1="495.5" x2="495.5" y1="401.7578" y2="414.7578"/><line style="stroke:#181818;stroke-width:1.0;" x1="454.5" x2="495.5" y1="414.7578" y2="414.7578"/><polygon fill="#181818" points="464.5,410.7578,454.5,414.7578,464.5,418.7578,460.5,414.7578" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="460.5" y="396.6919">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="473.5" y="396.6919">处理业务</text><polygon fill="#181818" points="40,439.8906,30,443.8906,40,447.8906,36,443.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="34" x2="447.5" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46" y="438.8247">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="68" y="438.8247">响应结果</text><polygon fill="#181818" points="431.5,469.0234,441.5,473.0234,431.5,477.0234,435.5,473.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="29" x2="437.5" y1="473.0234" y2="473.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="36" y="467.9575">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="58" y="467.9575">刷新token，携带refresh_token</text><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="495.5" y1="502.1563" y2="502.1563"/><line style="stroke:#181818;stroke-width:1.0;" x1="495.5" x2="495.5" y1="502.1563" y2="515.1563"/><line style="stroke:#181818;stroke-width:1.0;" x1="454.5" x2="495.5" y1="515.1563" y2="515.1563"/><polygon fill="#181818" points="464.5,511.1563,454.5,515.1563,464.5,519.1563,460.5,515.1563" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="460.5" y="497.0903">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="482.5" y="497.0903">校验token（二次校验）</text><polygon fill="#181818" points="824.5,540.2891,834.5,544.2891,824.5,548.2891,828.5,544.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="830.5" y1="544.2891" y2="544.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="460.5" y="539.2231">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="482.5" y="539.2231">token有效，从redis中查询</text><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="495.5" y1="588.5547" y2="588.5547"/><line style="stroke:#181818;stroke-width:1.0;" x1="495.5" x2="495.5" y1="588.5547" y2="601.5547"/><line style="stroke:#181818;stroke-width:1.0;" x1="454.5" x2="495.5" y1="601.5547" y2="601.5547"/><polygon fill="#181818" points="464.5,597.5547,454.5,601.5547,464.5,605.5547,460.5,601.5547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="460.5" y="575.9224">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="482.5" y="568.356">判断redis中存储的refresh_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="482.5" y="583.4888">是否已经使用（三次校验）</text><polygon fill="#181818" points="40,626.6875,30,630.6875,40,634.6875,36,630.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="34" x2="442.5" y1="630.6875" y2="630.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46" y="625.6216">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="68" y="625.6216">token无效，重新登录</text><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="495.5" y1="674.9531" y2="674.9531"/><line style="stroke:#181818;stroke-width:1.0;" x1="495.5" x2="495.5" y1="674.9531" y2="687.9531"/><line style="stroke:#181818;stroke-width:1.0;" x1="454.5" x2="495.5" y1="687.9531" y2="687.9531"/><polygon fill="#181818" points="464.5,683.9531,454.5,687.9531,464.5,691.9531,460.5,687.9531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="460.5" y="662.3208">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="482.5" y="654.7544">token有效，重新生成access_token、</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="482.5" y="669.8872">refresh_token</text><polygon fill="#181818" points="824.5,713.0859,834.5,717.0859,824.5,721.0859,828.5,717.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="453.5" x2="830.5" y1="717.0859" y2="717.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="460.5" y="712.02">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337" x="482.5" y="712.02">删除旧的refresh_token，存储新的refresh_token到redis</text><polygon fill="#181818" points="40,757.3516,30,761.3516,40,765.3516,36,761.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="34" x2="447.5" y1="761.3516" y2="761.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46" y="748.7192">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="68" y="741.1528">返回新的access_token、</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="68" y="756.2856">refresh_token</text></g></svg>