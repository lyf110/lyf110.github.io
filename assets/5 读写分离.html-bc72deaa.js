import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as n,e as t}from"./app-5f6064b2.js";const e="/assets/image65-b0b8bbf4.jpeg",p="/assets/image66-564900c3.jpeg",o="/assets/image67-1bb9eead.jpeg",l="/assets/image68-45100d28.jpeg",c="/assets/image69-cf1fbd9f.jpeg",i="/assets/image70-7822df37.jpeg",u="/assets/image71-e9307f09.jpeg",r="/assets/image72-c7164a96.jpeg",d="/assets/image73-e03f1b02.jpeg",k="/assets/image74-e7f1b063.jpeg",m="/assets/image75-bfe44fb3.jpeg",v="/assets/image76-ea19cdbb.jpeg",g="/assets/image77-14fa0ac9.jpeg",h="/assets/image78-95eddeb6.jpeg",b="/assets/image79-98521fa3.jpeg",q="/assets/image80-be133ac0.jpeg",y={},f=t('<h1 id="_5-读写分离" tabindex="-1"><a class="header-anchor" href="#_5-读写分离" aria-hidden="true">#</a> 5. 读写分离</h1><h2 id="_4-1-介绍" tabindex="-1"><a class="header-anchor" href="#_4-1-介绍" aria-hidden="true">#</a> 4.1 介绍</h2><p>读写分离,简单地说是把对数据库的读和写操作分开,以对应不同的数据库服务器。主数据库提供写操作，从数据库提供读操作，这样能有效地减轻单台数据库的压力。</p><p>通过MyCat即可轻易实现上述功能，不仅可以支持MySQL，也可以支持Oracle和SQL Server。</p><figure><img src="'+e+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_4-2-一主一从" tabindex="-1"><a class="header-anchor" href="#_4-2-一主一从" aria-hidden="true">#</a> 4.2 一主一从</h2><h3 id="_4-2-1-原理" tabindex="-1"><a class="header-anchor" href="#_4-2-1-原理" aria-hidden="true">#</a> 4.2.1 原理</h3><p>MySQL的主从复制，是基于二进制日志（binlog）实现的。</p><figure><img src="'+p+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_4-2-2-准备" tabindex="-1"><a class="header-anchor" href="#_4-2-2-准备" aria-hidden="true">#</a> 4.2.2 准备</h3><table><thead><tr><th>主机</th><th>角色</th><th>用户名</th><th>密码</th></tr></thead><tbody><tr><td>192.168.200.211</td><td>master</td><td>root</td><td>1234</td></tr><tr><td>192.168.200.212</td><td>slave</td><td>root</td><td>1234</td></tr></tbody></table><blockquote><p>备注：主从复制的搭建，可以考虑前面课程中的 主从复制 章节讲解的步骤操作。</p></blockquote><h2 id="_4-3-一主一从读写分离" tabindex="-1"><a class="header-anchor" href="#_4-3-一主一从读写分离" aria-hidden="true">#</a> 4.3 一主一从读写分离</h2><p>MyCat控制后台数据库的读写分离和负载均衡由<code>schema.xml</code>文件<code>datahost</code>标签的balance属性控制。</p><h3 id="_4-3-1-schema-xml配置" tabindex="-1"><a class="header-anchor" href="#_4-3-1-schema-xml配置" aria-hidden="true">#</a> 4.3.1 schema.xml配置</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- 配置逻辑库 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ITCAST_RW<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn7<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn7<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dhost7<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>itcast<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dhost7<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>master1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.211:3306?
		useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slave1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.212:3306?
			useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述配置的具体关联对应情况如下：</p><figure><img src="`+o+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>writeHost代表的是写操作对应的数据库，readHost代表的是读操作对应的数据库。 所以我们要想 实现读写分离，就得配置writeHost关联的是主库，readHost关联的是从库。</p><p>而仅仅配置好了writeHost以及readHost还不能完成读写分离，还需要配置一个非常重要的负责均衡 的参数 balance，取值有4种，具体含义如下：</p><table><thead><tr><th>参数值</th><th>含义</th></tr></thead><tbody><tr><td>0</td><td>不开启读写分离机制，所有的读操作都发送到当前可用的writehost上</td></tr><tr><td>1</td><td>全部的readHost 与 备用的writeHost 都参与select 语句的负载均衡（主要针对双主双从模式）</td></tr><tr><td>2</td><td>所有的读写操作都随机在 writeHost，readHost上分发</td></tr><tr><td>3</td><td>所有的读请求随机分发到writeHost对应的readHost上执行，writeHost不负担读压力</td></tr></tbody></table><p>所以，在一主一从模式的读写分离中，balance配置1或3都是可以完成读写分离的。</p><h3 id="_4-3-2-server-xml配置" tabindex="-1"><a class="header-anchor" href="#_4-3-2-server-xml配置" aria-hidden="true">#</a> 4.3.2 server.xml配置</h3><p>配置root用户可以访问SHOPPING、ITCAST 以及 ITCAST_RW逻辑库。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultAccount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>SHOPPING,ITCAST,ITCAST_RW<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 表级 DML 权限设置 --&gt;</span>
    <span class="token comment">&lt;!--&lt;privileges check=&quot;true&quot;&gt;
        &lt;schema name=&quot;DB01&quot; dml=&quot;0110&quot;&gt;
            &lt;table name=&quot;TB_ORDER&quot; dml=&quot;1110&quot;&gt;&lt;/table&gt;
        &lt;/schema&gt;
    &lt;/privileges&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-3-测试" tabindex="-1"><a class="header-anchor" href="#_4-3-3-测试" aria-hidden="true">#</a> 4.3.3 测试</h3><p>配置完毕MyCat后，重新启动MyCat。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/mycat stop
bin/mycat start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后观察，在执行增删改操作时，对应的主库及从库的数据变化。 在执行查询操作时，检查主库及从库对应的数据变化。</p><p>在测试中，我们可以发现当主节点Master宕机之后，业务系统就只能够读，而不能写入数据了。</p><figure><img src="`+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>那如何解决这个问题呢？这个时候我们就得通过另外一种主从复制结构来解决了，也就是我们接下来讲 解的双主双从。</p><h2 id="_4-4-双主双从" tabindex="-1"><a class="header-anchor" href="#_4-4-双主双从" aria-hidden="true">#</a> 4.4 双主双从</h2><h3 id="_4-4-1-介绍" tabindex="-1"><a class="header-anchor" href="#_4-4-1-介绍" aria-hidden="true">#</a> 4.4.1 介绍</h3><p>一个主机 Master1 用于处理所有写请求，它的从机 Slave1 和另一台主机 Master2 还有它的从机 Slave2 负责所有读请求。当 Master1 主机宕机后，Master2 主机负责写请求，Master1 、 Master2 互为备机。架构图如下:</p><figure><img src="'+c+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_4-4-2-准备" tabindex="-1"><a class="header-anchor" href="#_4-4-2-准备" aria-hidden="true">#</a> 4.4.2 准备</h3><p>我们需要准备5台服务器，具体的服务器及软件安装情况如下：</p><table><thead><tr><th>编号</th><th>IP</th><th>预装软件</th><th>角色</th></tr></thead><tbody><tr><td>1</td><td>192.168.200.210</td><td>MyCat、MySQL</td><td>MyCat中间件服务器</td></tr><tr><td>2</td><td>192.168.200.211</td><td>MySQL</td><td>M1</td></tr><tr><td>3</td><td>192.168.200.212</td><td>MySQL</td><td>S1</td></tr><tr><td>4</td><td>192.168.200.213</td><td>MySQL</td><td>M2</td></tr><tr><td>5</td><td>192.168.200.214</td><td>MySQL</td><td>S2</td></tr></tbody></table><blockquote><p>关闭以上所有服务器的防火墙：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h3 id="_4-4-3-搭建" tabindex="-1"><a class="header-anchor" href="#_4-4-3-搭建" aria-hidden="true">#</a> 4.4.3 搭建</h3><h4 id="_4-4-3-1-主库配置" tabindex="-1"><a class="header-anchor" href="#_4-4-3-1-主库配置" aria-hidden="true">#</a> 4.4.3.1 主库配置</h4><h5 id="_1-master1-192-168-200-211" tabindex="-1"><a class="header-anchor" href="#_1-master1-192-168-200-211" aria-hidden="true">#</a> 1). Master1(192.168.200.211)</h5><figure><img src="`+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h6 id="a-修改配置文件-etc-my-cnf" tabindex="-1"><a class="header-anchor" href="#a-修改配置文件-etc-my-cnf" aria-hidden="true">#</a> A. 修改配置文件 /etc/my.cnf</h6><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#mysql 服务ID，保证整个集群环境中唯一，取值范围：1 – 2^32-1，默认为1</span>

<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>

<span class="token comment">#指定同步的数据库</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">db01</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">db02</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">db03</span>

<span class="token comment"># 在作为从数据库的时候，有写入操作也要更新二进制日志文件</span>
log-slave-updates
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="b-重启mysql服务器" tabindex="-1"><a class="header-anchor" href="#b-重启mysql服务器" aria-hidden="true">#</a> B. 重启MySQL服务器</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="c-创建账户并授权" tabindex="-1"><a class="header-anchor" href="#c-创建账户并授权" aria-hidden="true">#</a> C. 创建账户并授权</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">&#39;itcast&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">&#39;Root@123456&#39;</span><span class="token punctuation">;</span>

<span class="token comment">#为 &#39;itcast&#39;@&#39;%&#39; 用户分配主从复制权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">&#39;itcast&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过指令，查看两台主库的二进制日志坐标</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> master <span class="token keyword">status</span> <span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+u+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_2-master2-192-168-200-213" tabindex="-1"><a class="header-anchor" href="#_2-master2-192-168-200-213" aria-hidden="true">#</a> 2). Master2(192.168.200.213)</h5><figure><img src="'+r+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h6 id="a-修改配置文件-etc-my-cnf-1" tabindex="-1"><a class="header-anchor" href="#a-修改配置文件-etc-my-cnf-1" aria-hidden="true">#</a> A. 修改配置文件 /etc/my.cnf</h6><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#mysql 服务ID，保证整个集群环境中唯一，取值范围：1 – 2^32-1，默认为1</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">3</span>

<span class="token comment">#指定同步的数据库</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">db01</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">db02</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">db03</span>

<span class="token comment"># 在作为从数据库的时候，有写入操作也要更新二进制日志文件</span>
log-slave-updates
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="b-重启mysql服务器-1" tabindex="-1"><a class="header-anchor" href="#b-重启mysql服务器-1" aria-hidden="true">#</a> B. 重启MySQL服务器</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="c-创建账户并授权-1" tabindex="-1"><a class="header-anchor" href="#c-创建账户并授权-1" aria-hidden="true">#</a> C. 创建账户并授权</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">&#39;itcast&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">&#39;Root@123456&#39;</span><span class="token punctuation">;</span>

<span class="token comment">#为 &#39;itcast&#39;@&#39;%&#39; 用户分配主从复制权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">&#39;itcast&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过指令，查看两台主库的二进制日志坐标</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span>  master <span class="token keyword">status</span> <span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_4-4-3-2-从库配置" tabindex="-1"><a class="header-anchor" href="#_4-4-3-2-从库配置" aria-hidden="true">#</a> 4.4.3.2 从库配置</h4><h5 id="_1-slave1-192-168-200-212" tabindex="-1"><a class="header-anchor" href="#_1-slave1-192-168-200-212" aria-hidden="true">#</a> 1). Slave1(192.168.200.212)</h5><figure><img src="'+k+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h6 id="a-修改配置文件-etc-my-cnf-2" tabindex="-1"><a class="header-anchor" href="#a-修改配置文件-etc-my-cnf-2" aria-hidden="true">#</a> A. 修改配置文件 /etc/my.cnf</h6><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#mysql 服务ID，保证整个集群环境中唯一，取值范围：1 – 232-1，默认为1</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="b-重新启动mysql服务器" tabindex="-1"><a class="header-anchor" href="#b-重新启动mysql服务器" aria-hidden="true">#</a> B. 重新启动MySQL服务器</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-slave2-192-168-200-214" tabindex="-1"><a class="header-anchor" href="#_2-slave2-192-168-200-214" aria-hidden="true">#</a> 2). Slave2(192.168.200.214)</h5><figure><img src="`+m+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h6 id="a-修改配置文件-etc-my-cnf-3" tabindex="-1"><a class="header-anchor" href="#a-修改配置文件-etc-my-cnf-3" aria-hidden="true">#</a> A. 修改配置文件 /etc/my.cnf</h6><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#mysql 服务ID，保证整个集群环境中唯一，取值范围：1 – 232-1，默认为1</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="b-重新启动mysql服务器-1" tabindex="-1"><a class="header-anchor" href="#b-重新启动mysql服务器-1" aria-hidden="true">#</a> B. 重新启动MySQL服务器</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_4-4-3-3-从库关联主库" tabindex="-1"><a class="header-anchor" href="#_4-4-3-3-从库关联主库" aria-hidden="true">#</a> 4.4.3.3 从库关联主库</h4><h5 id="_1-两台从库配置关联的主库" tabindex="-1"><a class="header-anchor" href="#_1-两台从库配置关联的主库" aria-hidden="true">#</a> 1). 两台从库配置关联的主库</h5><figure><img src="`+v+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>需要注意slave1对应的是master1，slave2对应的是master2。</p></blockquote><h6 id="a-在-slave1-192-168-200-212-上执行" tabindex="-1"><a class="header-anchor" href="#a-在-slave1-192-168-200-212-上执行" aria-hidden="true">#</a> A. 在 slave1(192.168.200.212)上执行</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">&#39;192.168.200.211&#39;</span><span class="token punctuation">,</span> MASTER_USER<span class="token operator">=</span><span class="token string">&#39;itcast&#39;</span><span class="token punctuation">,</span> MASTER_PASSWORD<span class="token operator">=</span><span class="token string">&#39;Root@123456&#39;</span><span class="token punctuation">,</span> MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">&#39;binlog.000002&#39;</span><span class="token punctuation">,</span> MASTER_LOG_POS<span class="token operator">=</span><span class="token number">663</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="b-在-slave2-192-168-200-214-上执行" tabindex="-1"><a class="header-anchor" href="#b-在-slave2-192-168-200-214-上执行" aria-hidden="true">#</a> B. 在 slave2(192.168.200.214)上执行</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">&#39;192.168.200.213&#39;</span><span class="token punctuation">,</span> MASTER_USER<span class="token operator">=</span><span class="token string">&#39;itcast&#39;</span><span class="token punctuation">,</span> MASTER_PASSWORD<span class="token operator">=</span><span class="token string">&#39;Root@123456&#39;</span><span class="token punctuation">,</span> MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">&#39;binlog.000002&#39;</span><span class="token punctuation">,</span> MASTER_LOG_POS<span class="token operator">=</span><span class="token number">663</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="c-启动两台从库主从复制-查看从库状态" tabindex="-1"><a class="header-anchor" href="#c-启动两台从库主从复制-查看从库状态" aria-hidden="true">#</a> C. 启动两台从库主从复制，查看从库状态</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">start</span> slave<span class="token punctuation">;</span>
<span class="token keyword">show</span> slave <span class="token keyword">status</span> \\G<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+g+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_2-两台主库相互复制" tabindex="-1"><a class="header-anchor" href="#_2-两台主库相互复制" aria-hidden="true">#</a> 2). 两台主库相互复制</h5><figure><img src="'+h+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>Master2 复制 Master1， Master1 复制 Master2。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="a-在-master1-192-168-200-211-上执行" tabindex="-1"><a class="header-anchor" href="#a-在-master1-192-168-200-211-上执行" aria-hidden="true">#</a> A. 在 Master1(192.168.200.211)上执行</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">&#39;192.168.200.213&#39;</span><span class="token punctuation">,</span> MASTER_USER<span class="token operator">=</span><span class="token string">&#39;itcast&#39;</span><span class="token punctuation">,</span> MASTER_PASSWORD<span class="token operator">=</span><span class="token string">&#39;Root@123456&#39;</span><span class="token punctuation">,</span> MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">&#39;binlog.000002&#39;</span><span class="token punctuation">,</span> MASTER_LOG_POS<span class="token operator">=</span><span class="token number">663</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="b-在-master2-192-168-200-213-上执行" tabindex="-1"><a class="header-anchor" href="#b-在-master2-192-168-200-213-上执行" aria-hidden="true">#</a> B. 在 Master2(192.168.200.213)上执行</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">&#39;192.168.200.211&#39;</span><span class="token punctuation">,</span> MASTER_USER<span class="token operator">=</span><span class="token string">&#39;itcast&#39;</span><span class="token punctuation">,</span> MASTER_PASSWORD<span class="token operator">=</span><span class="token string">&#39;Root@123456&#39;</span><span class="token punctuation">,</span> MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">&#39;binlog.000002&#39;</span><span class="token punctuation">,</span> MASTER_LOG_POS<span class="token operator">=</span><span class="token number">663</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="c-启动两台从库主从复制-查看从库状态-1" tabindex="-1"><a class="header-anchor" href="#c-启动两台从库主从复制-查看从库状态-1" aria-hidden="true">#</a> C. 启动两台从库主从复制，查看从库状态</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">start</span> slave<span class="token punctuation">;</span>
<span class="token keyword">show</span> slave <span class="token keyword">status</span> \\G<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+b+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>经过上述的三步配置之后，双主双从的复制结构就已经搭建完成了。 接下来，我们可以来测试验证一下。</p><h3 id="_4-4-4-测试" tabindex="-1"><a class="header-anchor" href="#_4-4-4-测试" aria-hidden="true">#</a> 4.4.4 测试</h3><p>分别在两台主库Master1、Master2上执行DDL、DML语句，查看涉及到的数据库服务器的数据同步情况。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> db01<span class="token punctuation">;</span>

<span class="token keyword">use</span> db01<span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> tb_user<span class="token punctuation">(</span>
	id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">,</span>
	name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">default</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>


<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;Trigger&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;Dawn&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;Jack Ma&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;Coco&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&#39;Jerry&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>在Master1中执行DML、DDL操作，看看数据是否可以同步到另外的三台数据库中。</p></li><li><p>在Master2中执行DML、DDL操作，看看数据是否可以同步到另外的三台数据库中。</p></li></ul><p>完成了上述双主双从的结构搭建之后，接下来，我们再来看看如何完成这种双主双从的读写分离。</p><h2 id="_4-5-双主双从读写分离" tabindex="-1"><a class="header-anchor" href="#_4-5-双主双从读写分离" aria-hidden="true">#</a> 4.5 双主双从读写分离</h2><h3 id="_4-5-1-配置" tabindex="-1"><a class="header-anchor" href="#_4-5-1-配置" aria-hidden="true">#</a> 4.5.1 配置</h3><p>MyCat控制后台数据库的读写分离和负载均衡由schema.xml文件datahost标签的balance属性控 制，通过writeType及switchType来完成失败自动切换的。</p><h5 id="_1-schema-xml" tabindex="-1"><a class="header-anchor" href="#_1-schema-xml" aria-hidden="true">#</a> 1). schema.xml</h5><h6 id="a-配置逻辑库" tabindex="-1"><a class="header-anchor" href="#a-配置逻辑库" aria-hidden="true">#</a> A. 配置逻辑库：</h6><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ITCAST_RW2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn7<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="b-配置数据节点" tabindex="-1"><a class="header-anchor" href="#b-配置数据节点" aria-hidden="true">#</a> B. 配置数据节点：</h6><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn7<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dhost7<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>db01<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="c-配置节点主机" tabindex="-1"><a class="header-anchor" href="#c-配置节点主机" aria-hidden="true">#</a> C. 配置节点主机：</h6><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dhost7<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
	
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>master1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.211:3306?
		useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slave1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.212:3306?
			useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
    
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>master2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.213:3306?
		useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slave2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.214:3306?
			useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>具体的对应情况如下：</p><figure><img src="`+q+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>属性说明：</p><blockquote><p>balance=&quot;1&quot;<br> 代表全部的 readHost 与 stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且 M1 与 M2 互为主备)，正常情况下，M2,S1,S2 都参与 select 语句的负载均衡 ;</p><p>writeType<br> 0 : 写操作都转发到第1台writeHost, writeHost1挂了, 会切换到writeHost2上;<br> 1 : 所有的写操作都随机地发送到配置的writeHost上 ;</p><p>switchType<br> -1 : 不自动切换<br> 1 : 自动切换</p></blockquote><h5 id="_2-user-xml" tabindex="-1"><a class="header-anchor" href="#_2-user-xml" aria-hidden="true">#</a> 2). user.xml</h5><p>配置root用户也可以访问到逻辑库 ITCAST_RW2。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultAccount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>SHOPPING,ITCAST,ITCAST_RW2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 表级 DML 权限设置 --&gt;</span>
   <span class="token comment">&lt;!-- &lt;privileges check=&quot;true&quot;&gt;
        &lt;schema name=&quot;DB01&quot; dml=&quot;0110&quot;&gt;
            &lt;table name=&quot;TB_ORDER&quot; dml=&quot;1110&quot;&gt;&lt;/table&gt;
        &lt;/schema&gt;
    &lt;/privileges&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-2-测试" tabindex="-1"><a class="header-anchor" href="#_4-5-2-测试" aria-hidden="true">#</a> 4.5.2 测试</h3><p>登录MyCat，测试查询及更新操作，判定是否能够进行读写分离，以及读写分离的策略是否正确。</p><p>当主库挂掉一个之后，是否能够自动切换。</p>`,124),_=[f];function x(w,S){return s(),n("div",null,_)}const A=a(y,[["render",x],["__file","5 读写分离.html.vue"]]);export{A as default};
