import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as r,c,a,b as e,d as n,e as t}from"./app-5f6064b2.js";const l="/assets/image-20230715232949109-f1a4770b.png",p="/assets/1689434973298-8-d4d7af9b.png",d="/assets/1689434973293-1-47b5649d.png",g="/assets/1689434973294-2-fec53204.png",m="/assets/1689434973294-3-cbbc4f9a.png",h="/assets/1689434973294-4-8c149b57.png",_="/assets/1689434973295-5-9edbf561.png",u="/assets/1689434973295-6-847ca29d.png",f="/assets/1689434973295-7-ee080560.png",b={},x=t('<h1 id="内网穿透说明" tabindex="-1"><a class="header-anchor" href="#内网穿透说明" aria-hidden="true">#</a> 内网穿透说明</h1><h1 id="_0-背景说明" tabindex="-1"><a class="header-anchor" href="#_0-背景说明" aria-hidden="true">#</a> 0.背景说明</h1><p>项目中的支付模块在于第三方支付服务通信时，为了确保支付、退款等业务能及时得到业务执行结果，支持两种业务模式：</p><ul><li>基于第三方的回调通知</li><li>主动轮询</li></ul><p>以上两种模式默认都已开启，但是回调模式依赖于内网穿透，需要大家配置内网穿透信息。当然，如果不配置也可以，此时走轮询模式，查询支付或退款结果可能会有一定的延时（一般延时不超过30秒）。</p><p>接下来，我们介绍一下项目中的内网穿透配置方式。</p><h1 id="_1-注册并开通隧道" tabindex="-1"><a class="header-anchor" href="#_1-注册并开通隧道" aria-hidden="true">#</a> 1.注册并开通隧道</h1><p>项目中采用的内网穿透工具是Cpolar，完全免费：</p>',8),v={href:"https://www.cpolar.com/",target:"_blank",rel:"noopener noreferrer"},k=t('<figure><img src="'+l+'" alt="image-20230715232949109" tabindex="0" loading="lazy"><figcaption>image-20230715232949109</figcaption></figure><p>大家首先登陆该网站，并注册一个账号：</p><figure><img src="'+p+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>注册成功后，会跳转到套餐购买页面：</p><figure><img src="'+d+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>选择免费套装，然后确定：</p><figure><img src="'+g+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>然后，会跳转到控制台页面：</p><figure><img src="'+m+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>注意</strong>，第三步的<strong>authtoken</strong>是你的账户唯一标示，非常重要。<strong>其它几步大家无需操作</strong>，我已经在虚拟机中给大家安装好了cpolar.</p><h1 id="_2-配置cpolar" tabindex="-1"><a class="header-anchor" href="#_2-配置cpolar" aria-hidden="true">#</a> 2.配置cpolar</h1><p>在我给大家提供的虚拟机环境中，已经安装好了cpolar，大家只需要完成token授权即可。</p><p>在虚拟机中执行命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 注意，将后面的token换成你的真实token</span>
cpolar authtoken MGYZYzBmMjTtM2E30C00MZjO<span class="token punctuation">..</span><span class="token punctuation">..</span>xxxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后配置cpolar开启自启：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemcmtl <span class="token builtin class-name">enable</span> cpolar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>接着，启动cpolar</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start cpolar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,18),y={href:"http://192.168.150.101:9500",target:"_blank",rel:"noopener noreferrer"},z=a("figure",null,[a("img",{src:h,alt:"img",tabindex:"0",loading:"lazy"}),a("figcaption",null,"img")],-1),w=a("p",null,"使用你自己的Cpolar账号登录即可。",-1),q=a("p",null,"然后进入控制台， 访问《状态》-《在线隧道状态》，即可看到我提前配置好的隧道以及对应的域名：",-1),C=a("figure",null,[a("img",{src:_,alt:"img",tabindex:"0",loading:"lazy"}),a("figcaption",null,"img")],-1),N={href:"https://20517c0c.r2.vip.cpolar.xn--cnhttp-qv7iqyz7xjyem5m2pmyqas62ip14k",target:"_blank",rel:"noopener noreferrer"},B=t('<blockquote><p>注意，由于我们是免费的隧道，所以每次重启该域名都会变化。</p></blockquote><h1 id="_3-设置穿透域名" tabindex="-1"><a class="header-anchor" href="#_3-设置穿透域名" aria-hidden="true">#</a> 3.设置穿透域名</h1><p>最后，我们还需要把内网穿透域名配置到支付微服务的配置参数（notif-url）中。由于我们是免费的隧道，所以每次重启该域名都会变化，都需要重新配置支付的参数。</p><p>为了便于大家配置，我将这个配置交给了Nacos管理：</p><figure><img src="'+u+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>点击编辑，进入配置：</p><figure><img src="'+f+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>以后，每次重启虚拟机，都应该去cpolar的控制台查看最新的内网穿透域名，然后修改到这里。</p>',8);function E(M,V){const i=o("ExternalLinkIcon");return r(),c("div",null,[x,a("p",null,[a("a",v,[e("https://www.cpolar.com/"),n(i)])]),k,a("p",null,[e("然后，访问Cpolar的控制台页面："),a("a",y,[e("http://192.168.150.101:9500"),n(i)]),e("，会进入一个登录页面：")]),z,w,q,C,a("p",null,[e("上图中，"),a("a",N,[e("https://20517c0c.r2.vip.cpolar.cn这个域名就映射到了http"),n(i)]),e("😕/localhost:10010，也就是本地的网关微服务。也就是说，以后我们访问这个域名就是在访问网关了，只要加上对应的接口路径，即可实现对微服务的访问。")]),B])}const L=s(b,[["render",E],["__file","内网穿透说明.html.vue"]]);export{L as default};
